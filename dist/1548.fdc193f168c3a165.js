"use strict";(self.webpackChunkchat21=self.webpackChunkchat21||[]).push([[1548],{71548:(on,F,f)=>{f.r(F),f.d(F,{AnalyticsModule:()=>an});var E=f(69808),q=f(87341),it=f(15439),o=f.n(it),N=f(96120),D=f(68332),W=f(62801),K=f(26930),x=f(48616),M=f(65260),$=f(66888),t=f(5e3),G=f(54132),L=f(51062),w=f(69089),P=f(94961),B=f(45148),Q=f(41746),k=f(7623),v=f(24376),I=f(93075);function ot(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function rt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function lt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}function gt(a,l){if(1&a&&(t.TgZ(0,"ng-option",25),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e._id),t.xp6(1),t.Oqu(e.name)}}function ct(a,l){if(1&a&&(t.TgZ(0,"ng-option",25),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function dt(a,l){if(1&a&&(t.TgZ(0,"ng-option",25),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}let ht=(()=>{class a{constructor(e,n,s,i,r,g,m){this.analyticsService=e,this.translate=n,this.departmentService=s,this.usersService=i,this.faqKbService=r,this.logger=g,this.auth=m,this.lastdays=7,this.langService=new N.b,this.humanizer=new N.f(this.langService),this.projectUserAndBotsArray=[],this.conversationType=[{id:"",name:"All"},...k.pD],this.lang=this.translate.getBrowserLang(),this.logger.log("LANGUAGE ",this.lang),this.getBrowserLangAndSwitchMonthName()}ngOnInit(){this.selectedDeptId="",this.selectedDaysId=7,this.selectedAgentId="",this.selectedChannelId="",this.durationConvTimeCLOCK(),this.durationConversationTimeCHART(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId),this.getDepartments(),this.getProjectUsersAndBots()}ngOnDestroy(){this.logger.log("[ANALYTICS - DURATACONV] CONVERSATION LENGHT - !!!!! UN - SUBSCRIPTION TO REQUESTS"),this.subscription.unsubscribe()}msToTIME(e){return Math.floor(e/36e5)+"h:"+Math.floor(e%36e5/6e4)+"m:"+Math.round(e%36e4%6e4/1e3)+"s"}msToTime(e){let n=Math.floor(e/36e5),s=Math.floor(e%36e5/6e4);return Math.round(e%36e4%6e4/1e3),s%2!=0?(s+=1,1e3*s*60):s<59?(n+=1,1e3*n*60*60):void this.logger.log("[ANALYTICS - DURATACONV] H:M->",n,s)}stepSize(e){const n=Math.floor(e/36e5);return Math.floor(e%36e5/6e4),Math.round(e%36e4%6e4/1e3),0!==n?1e3*Math.floor(e/4/36e5)*60*60:1e3*Math.floor(e/4/6e4)*60}daysSelect(e){this.selectedDaysId=e,e<=30?this.lastdays=e:90===e||180===e?this.lastdays=e/30:360===e&&(this.lastdays=1),this.barChart.destroy(),this.subscription.unsubscribe(),this.durationConversationTimeCHART(e,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId),this.logger.log("[ANALYTICS - DURATACONV] REQUEST:",e,this.selectedDeptId,this.selectedAgentId)}depSelected(e){this.logger.log("dep",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.durationConversationTimeCHART(this.selectedDaysId,e,this.selectedAgentId,this.selectedChannelId),this.logger.log("[ANALYTICS - DURATACONV] REQUEST:",this.selectedDaysId,e,this.selectedAgentId)}agentSelected(e){this.logger.log("[ANALYTICS - DURATACONV] Selected agent: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.durationConversationTimeCHART(this.selectedDaysId,this.selectedDeptId,e,this.selectedChannelId),this.logger.log("[ANALYTICS - DURATACONV] REQUEST:",this.selectedDaysId,this.selectedDeptId,e)}conversationTypeSelected(e){this.logger.log("[ANALYTICS - CONVS]  Selected channel: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.durationConversationTimeCHART(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,e),this.logger.log("[ANALYTICS - DURATACONV] REQUEST:",this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,e)}getDepartments(){this.departmentService.getDeptsByProjectId().subscribe(e=>{this.logger.log("[ANALYTICS - DURATACONV] - GET DEPTS RESPONSE by analitycs ",e),this.departments=e},e=>{this.logger.error("[ANALYTICS] - GET DEPTS - ERROR: ",e)},()=>{this.logger.log("[ANALYTICS] - GET DEPTS * COMPLETE *")})}getProjectUsersAndBots(){const e=this.usersService.getProjectUsersByProjectId(),n=this.faqKbService.getAllBotByProjectId();(0,Q.$R)(e,n,(s,i)=>({_projectUsers:s,_bots:i})).subscribe(s=>{s&&s._projectUsers&&(this.projectUsersList=s._projectUsers,this.projectUsersList.forEach(i=>{this.projectUserAndBotsArray.push({id:i.id_user._id,name:i.id_user.firstname+" "+i.id_user.lastname})})),s&&s._bots&&(this.bots=s._bots.filter(i=>!1===i.trashed),this.bots.forEach(i=>{this.projectUserAndBotsArray.push({id:"bot_"+i._id,name:i.name+" (bot)"})}))},s=>{this.logger.error("[ANALYTICS - DURATACONV] CONV LENGTH ANALYTICS - GET P-USERS-&-BOTS - ERROR: ",s)},()=>{this.logger.log("[ANALYTICS - DURATACONV] CONV LENGTH ANALYTICS - GET P-USERS-&-BOTS - COMPLETE")})}getBrowserLangAndSwitchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}durationConvTimeCLOCK(){this.subscription=this.analyticsService.getDurationConversationTimeDataCLOCK().subscribe(e=>{let n,s;if(e&&e.length>0)if(this.logger.log("[ANALYTICS - DURATACONV] \xbb\xbb\xbb\xbb res[0].duration_avg ",e[0].duration_avg),this.logger.log("[ANALYTICS - DURATACONV] \xbb\xbb\xbb\xbb typeof res[0].duration_avg ",typeof e[0].duration_avg),e[0].duration_avg)if(null!==e[0].duration_avg||void 0!==e[0].duration_avg){n=this.humanizeDurations(e[0].duration_avg),s=this.humanizeDurations(e[0].duration_avg).split(" "),this.numberDurationCNVtime=this.msToTIME(e[0].duration_avg),this.unitDurationCNVtime=s[1];const i=this.translate.getBrowserLang();let r;this.auth.user_bs&&this.auth.user_bs.value&&(r=localStorage.getItem(this.auth.user_bs.value._id+"_lang"));let g="";i&&!r?g=i:i&&r&&(g=r),this.responseDurationtime=this.humanizer.humanize(e[0].duration_avg,{round:!0,language:g}),this.logger.log("[ANALYTICS - DURATACONV] Waiting time: humanize",this.humanizer.humanize(e[0].duration_avg)),this.logger.log("[ANALYTICS - DURATACONV] waiting time funtion:",n)}else this.setToNa();else this.setToNa(),this.logger.log("[ANALYTICS - DURATACONV] Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - DURATACONV] waiting time funtion:",n);else this.setToNa(),this.logger.log("[ANALYTICS - DURATACONV] Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - DURATACONV] waiting time funtion:",n)},e=>{this.logger.error("[ANALYTICS - DURATACONV] CLOCK REQUEST - ERROR ",e),this.setToNa()},()=>{this.logger.log("[ANALYTICS - DURATACONV] CLOCK REQUEST * COMPLETE *")})}setToNa(){this.numberDurationCNVtime="0",this.unitDurationCNVtime="",this.responseDurationtime="0"}durationConversationTimeCHART(e,n,s,i){this.subscription=this.analyticsService.getDurationConversationTimeDataCHART(e,n,s,i).subscribe(r=>{if(r){this.durationConversationTime=r,this.logger.log("[ANALYTICS - DURATACONV] Duration time",r);const S=[];for(let d=0;d<e;d++)S.push({date:o()().subtract(d,"d").format("D/M/YYYY"),value:0});S.reverse(),this.logger.log("[ANALYTICS - DURATACONV] - REQUESTS CONVERSATION LENGHT BY DAY - MOMENT LAST 30 DATE (init array)",S);const _=[];for(let d in r)null==r[d].duration_avg&&(r[d].duration_avg=0),_.push({date:r[d]._id.day+"/"+r[d]._id.month+"/"+r[d]._id.year,value:r[d].duration_avg});this.logger.log("[ANALYTICS - DURATACONV] Custom Duration Conversation data:",_);const h=S.map(d=>_.find(C=>C.date===d.date)||d);this.logger.log("[ANALYTICS - DURATACONV] - REQUESTS CONVERSATION LENGHT BY DAY - FINAL ARRAY ",h);const c=[],p=[];this.initDay=h[0].date,this.endDay=h[e-1].date,this.logger.log("[ANALYTICS - DURATACONV] INIT",this.initDay,"END",this.endDay),h.forEach(d=>{this.logger.log("[ANALYTICS - DURATACONV] - REQUESTS CONVERSATION LENGHT BY DAY - requestByDay",d),c.push(d.value);const C=d.date.split("/");this.logger.log("[ANALYTICS - DURATACONV] - REQUESTS CONVERSATION LENGHT BY DAY - SPLITTED DATE",C),p.push(C[0]+" "+this.monthNames[C[1]])}),this.xValueDurationConversation=p,this.yValueDurationConversation=c,this.logger.log("[ANALYTICS - DURATACONV] Xlabel-DURATION",this.xValueDurationConversation),this.logger.log("[ANALYTICS - DURATACONV] Ylabel-DURATION",this.yValueDurationConversation)}else this.logger.error("[ANALYTICS - DURATACONV] !!!ERROR!!! while get data from resouces for duration conversation time graph");let g;g=this.selectedDaysId>60?10:this.selectedDaysId;const T=this.getMaxOfArray(this.yValueDurationConversation);this.logger.log("[ANALYTICS - DURATACONV] MS",this.msToTime(T)),this.logger.log("[ANALYTICS - DURATACONV] STEPSIZE",this.stepSize(T)),this.barChart=new D.Chart("durationConversationTimeResponse",{type:"bar",data:{labels:this.xValueDurationConversation,datasets:[{label:"Average duration conversation lenght response in last N days ",data:this.yValueDurationConversation,fill:!1,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0}]},options:{maintainAspectRatio:!1,title:{text:"DURATION CONVERSATION LENGHT RESPONSE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:g,display:!0,minRotation:0,fontColor:"black"},gridLines:{display:!1,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,display:!0,stepSize:this.stepSize(T),callback:function(S,_,h){const c=Math.floor(S/36e5),p=Math.floor(S%36e5/6e4),d=Math.round(S%36e4%6e4/1e3);return(c<10?"0"+c:c)+"h:"+(p<10?"0"+p:p)+"m:"+(d<10?"0"+d:d)+"s"}}}]},tooltips:{callbacks:{label:(S,_)=>{const h=S.yLabel,c=new N.b,p=new N.f(c),d=this.translate.getBrowserLang();let C;this.auth.user_bs&&this.auth.user_bs.value&&(C=localStorage.getItem(this.auth.user_bs.value._id+"_lang"));let u="";return d&&!C?u=d:d&&C&&(u=C),this.translate.instant("AverageLengthOfConversation")+": "+p.humanize(h,{round:!0,language:u,units:["y","mo","w","d","h","m","s"]})}}}}})})}humanizeDurations(e){let n;if(e)return"en"===this.lang?(n=Math.round(e/31104e6))>0?n=1===n?n+" Year":n+" Years":(n=Math.round(e/2592e6))>0?n=1===n?n+" Month":n+" Months":(n=Math.round(e/864e5))>0?n=1===n?n+" Day":n+" Days":(n=Math.round(e/36e5))>0?n+=" Hours":n=(n=Math.round(e/6e4))>0?1===n?n+" Minute":n+" Minutes":(n=Math.round(e/1e3))>0?1===n?n+" Second":n+" Seconds":e+" Millisec":n=(n=Math.round(e/31104e6))>0?1===n?n+" Anno":n+" Anni":(n=Math.round(e/2592e6))>0?1===n?n+" Mese":n+" Mesi":(n=Math.round(e/864e5))>0?1===n?n+" Giorno":n+" Giorni":(n=Math.round(e/36e5))>0?1===n?n+" Ora":n+" Ore":(n=Math.round(e/6e4))>0?1===n?n+" Minuto":n+" Minuti":(n=Math.round(e/1e3))>0?1===n?n+" Secondo":n+" Secondi":e+" Millisecondi",n}getMaxOfArray(e){return Math.max.apply(null,e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(M.y),t.Y36(L.sK),t.Y36(B.n),t.Y36(P.f),t.Y36(w.M),t.Y36(x.m),t.Y36(q.e))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-convsduration"]],decls:102,vars:93,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-md-3"],[1,"card",2,"border-radius","10px","min-height","445px"],[2,"padding-bottom","28px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content","clock"],[1,"numberCLOCK"],[1,"card-footer","request_count_footer",2,"font-size","16px","margin-top","9px","padding-top","21px","padding-bottom","19px"],[2,"display","block"],[1,"col-md-9"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","18px","display","block","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[4,"ngIf"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","23px","padding-right","12px"],[1,"col-sm-3"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],["name","dept",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["name","agent",1,"custom",3,"ngModel","clearable","ngModelChange","change"],["name","conversation-type",1,"custom","ng-select-conversation-type",3,"ngModel","clearable","ngModelChange","change"],[1,"card-content","chart-container",2,"position","relative","margin","auto","min-height","260px"],["id","durationConversationTimeResponse"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"p",8),t._uU(13),t.qZA()(),t.TgZ(14,"div",9),t._uU(15),t.ALo(16,"translate"),t.TgZ(17,"span",10)(18,"b"),t._uU(19),t.qZA()()()()(),t.TgZ(20,"div",11)(21,"div",12)(22,"div",13)(23,"span",14),t._uU(24),t.ALo(25,"translate"),t.YNc(26,ot,3,3,"span",15),t.YNc(27,rt,3,3,"span",15),t.YNc(28,lt,3,3,"span",15),t.TgZ(29,"span",16),t._uU(30),t.TgZ(31,"i",17),t._uU(32," arrow_forward "),t.qZA(),t._uU(33),t.qZA()(),t.TgZ(34,"div",18)(35,"div",19)(36,"div",20)(37,"div",21)(38,"label",22),t._uU(39),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"div",23)(42,"ng-select",24),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(){return n.daysSelect(n.selectedDaysId)}),t.TgZ(43,"ng-option",25),t._uU(44),t.ALo(45,"translate"),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ng-option",25),t._uU(48),t.ALo(49,"translate"),t.ALo(50,"translate"),t.qZA(),t.TgZ(51,"ng-option",25),t._uU(52),t.ALo(53,"translate"),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"ng-option",25),t._uU(56),t.ALo(57,"translate"),t.ALo(58,"translate"),t.qZA(),t.TgZ(59,"ng-option",25),t._uU(60),t.ALo(61,"translate"),t.ALo(62,"translate"),t.qZA(),t.TgZ(63,"ng-option",25),t._uU(64),t.ALo(65,"translate"),t.ALo(66,"translate"),t.qZA()()()()()(),t.TgZ(67,"div",19)(68,"div",20)(69,"div",21)(70,"label",22),t._uU(71),t.ALo(72,"translate"),t.qZA(),t.TgZ(73,"div",23)(74,"ng-select",26),t.NdJ("ngModelChange",function(i){return n.selectedDeptId=i})("change",function(){return n.depSelected(n.selectedDeptId)}),t.TgZ(75,"ng-option",25),t._uU(76),t.ALo(77,"translate"),t.qZA(),t.YNc(78,gt,2,2,"ng-option",27),t.qZA()()()()(),t.TgZ(79,"div",19)(80,"div",20)(81,"div",21)(82,"label",22),t._uU(83),t.ALo(84,"translate"),t.qZA(),t.TgZ(85,"div",23)(86,"ng-select",28),t.NdJ("ngModelChange",function(i){return n.selectedAgentId=i})("change",function(){return n.agentSelected(n.selectedAgentId)}),t.TgZ(87,"ng-option",25),t._uU(88),t.ALo(89,"translate"),t.qZA(),t.YNc(90,ct,2,2,"ng-option",27),t.qZA()()()()(),t.TgZ(91,"div",19)(92,"div",20)(93,"div",21)(94,"label",22),t._uU(95),t.ALo(96,"translate"),t.qZA(),t.TgZ(97,"div",23)(98,"ng-select",29),t.NdJ("ngModelChange",function(i){return n.selectedChannelId=i})("change",function(){return n.conversationTypeSelected(n.selectedChannelId)}),t.YNc(99,dt,2,2,"ng-option",27),t.qZA()()()()()()(),t.TgZ(100,"div",30),t._UZ(101,"canvas",31),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,49,"Analytics.ConvDurationTitle")," "),t.xp6(6),t.hij(" ",t.lcZ(10,51,"Analytics.MedianConvClock")," "),t.xp6(4),t.Oqu(n.numberDurationCNVtime),t.xp6(2),t.hij(" ",t.lcZ(16,53,"Analytics.ResponseDurationtime")," "),t.xp6(4),t.Oqu(n.responseDurationtime),t.xp6(5),t.AsE(" ",t.lcZ(25,55,"Analytics.DailyConvDurationTime")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(40,57,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(45,59,"Analytics.Last")," 7 ",t.lcZ(46,61,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(49,63,"Analytics.Last")," 15 ",t.lcZ(50,65,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(53,67,"Analytics.Last")," 30 ",t.lcZ(54,69,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(57,71,"Analytics.Last")," 3 ",t.lcZ(58,73,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(61,75,"Analytics.Last")," 6 ",t.lcZ(62,77,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(65,79,"Analytics.Last")," 1 ",t.lcZ(66,81,"Analytics.Year"),""),t.xp6(7),t.hij(" ",t.lcZ(72,83,"HistoryPage.FilterByDepartment")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDeptId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(77,85,"HistoryPage.AllDepts")),t.xp6(2),t.Q6J("ngForOf",n.departments),t.xp6(5),t.hij(" ",t.lcZ(84,87,"Agent")," "),t.xp6(3),t.Q6J("ngModel",n.selectedAgentId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(89,89,"HistoryPage.AllAgents")),t.xp6(2),t.Q6J("ngForOf",n.projectUserAndBotsArray),t.xp6(5),t.hij(" ",t.lcZ(96,91,"MessageChannel")," "),t.xp6(3),t.Q6J("ngModel",n.selectedChannelId)("clearable",!1),t.xp6(1),t.Q6J("ngForOf",n.conversationType))},dependencies:[E.sg,E.O5,v.w9,v.jq,I.JJ,I.On,L.X$],styles:['.card-header-custom[_ngcontent-%COMP%] {\n  box-shadow: none !important;\n  margin-left: 0px !important;\n  margin-right: 0px !important;\n  border-bottom: 1px solid #eff3f5 !important;\n}\n\n.request_count_footer[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  color: rgba(0, 0, 0, 0.54);\n  text-align: center;\n}\n\n.chart-wrapper[_ngcontent-%COMP%] {\n  background-color: #ffffff;\n  padding-top: 15px;\n  padding-bottom: 15px;\n  padding-left: 30px;\n  padding-right: 30px;\n  margin-left: -30px;\n  margin-right: -30px;\n  min-height: 345px;\n}\n\n.chart-title[_ngcontent-%COMP%] {\n  padding-bottom: 24px;\n  padding-top: 24px;\n  font-size: 18px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.clock[_ngcontent-%COMP%] {\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 200px;\n  width: 200px;\n  margin: auto;\n}\n\n.numberCLOCK[_ngcontent-%COMP%] {\n  font-size: 16px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-weight: 400;\n}\n\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-dept[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}']}),a})();function pt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function ut(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function At(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}function mt(a,l){if(1&a&&(t.TgZ(0,"ng-option",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",t.lcZ(2,2,e.name)," ")}}let Tt=(()=>{class a{constructor(e,n,s){this.analyticsService=e,this.translate=n,this.logger=s,this.lastdays=7,this.eventsList=[],this.eventsNameList=[],this.staticEventsNameList=[{name:"Page loads",value:"auth_state_changed"},{name:"New Conversations",value:"new_conversation"}],this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - EVENTS] LANGUAGE ",this.lang),this.switchMonthName()}ngOnInit(){this.selected="day",this.selectedDaysId=7,this.selectedEventName=this.staticEventsNameList[0].value,this.initDay=o()().subtract(6,"d").format("D/M/YYYY"),this.endDay=o()().subtract(0,"d").format("D/M/YYYY"),this.logger.log("[ANALYTICS - EVENTS] INIT",this.initDay,"END",this.endDay),this.getEventsName(),this.getEventsByLastNDays(this.selectedDaysId,this.selectedEventName),this.logger.log("[ANALYTICS - EVENTS] EVENTS FOR: ",this.selectedDaysId,this.selectedEventName)}getAggregateValue(){this.analyticsService.getLastMountConversationsCount().subscribe(e=>{this.logger.log("[ANALYTICS - EVENTS] LAST MONTH CONVERSATIONS COUNT: ",e),this.eventsCountLastMonth=e[0].totalCount,this.logger.log("[ANALYTICS - EVENTS]Events Count: ",this.eventsCountLastMonth)},e=>{this.logger.error("[ANALYTICS - EVENTS] Impossible to retrieve monthly count",e),this.eventsCountLastMonth=0})}switchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}daysSelect(e,n){this.logger.log("[ANALYTICS - EVENTS] daysSelect EVENT: ",n),this.selectedDaysId=e,e<=30?this.lastdays=e:90==e||180==e?this.lastdays=e/30:360==e&&(this.lastdays=1),this.lineChart.destroy(),this.getEventsByLastNDays(e,this.selectedEventName)}eventSelected(e){this.logger.log("[ANALYTICS - EVENTS] Selected event: ",e),this.lineChart.destroy(),this.subscription.unsubscribe(),this.getEventsByLastNDays(this.selectedDaysId,e),this.logger.log("[ANALYTICS - EVENTS] EVENTS FOR: ",this.selectedDaysId,e)}getEventsName(){this.analyticsService.getEventsList().subscribe(e=>{this.logger.log("[ANALYTICS - EVENTS] GET EVENTS LIST RESPONSE: ",e),this.eventsList=e;for(let n of this.eventsList)this.eventsNameList.includes(n._id.name)?this.logger.log("[ANALYTICS - EVENTS] Event already exists in array"):(this.eventsNameList.push(n._id.name),this.logger.log("[ANALYTICS - EVENTS] Events Name List: ",this.eventsNameList))})}getEventsByLastNDays(e,n){this.logger.log("[ANALYTICS - EVENTS] Lastdays: ",e),this.subscription=this.analyticsService.getEventByDay(e,n).subscribe(s=>{this.logger.log("[ANALYTICS - EVENTS] BY DAY RESULT: ",s);const i=[];for(let c=0;c<e;c++)i.push({count:0,day:o()().subtract(c,"d").format("D/M/YYYY")});i.reverse(),this.logger.log("\xbb\xbb LASTDAYS MESSAGES - INIT ARRAY: ",i);const r=[],g=[],m=[];if(s)for(let c=0;c<s.length;c++)s[c]&&m.push({count:s[c].count,day:s[c]._id.day+"/"+s[c]._id.month+"/"+s[c]._id.year});this.logger.log("[ANALYTICS - EVENTS] - MESSAGES BY DAY FORMATTED ",m);const T=i.map(c=>m.find(p=>p.day===c.day)||c);this.logger.log("[ANALYTICS - EVENTS] - MESSGES BY DAY - FINAL ARRAY ",T),this.initDay=T[0].day,this.endDay=T[e-1].day,this.logger.log("[ANALYTICS - EVENTS] INIT",this.initDay,"END",this.endDay),T.forEach(c=>{r.push(c.count);const p=c.day.split("/");g.push(p[0]+" "+this.monthNames[p[1]])}),this.logger.log("[ANALYTICS - EVENTS] \xbb\xbb MESSAGES BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",r),this.logger.log("[ANALYTICS - EVENTS] \xbb\xbb MESSAGES BY DAY - LABELS (+ NEW + ARRAY OF DAY)",g);const S=this.getMaxOfArray(r);this.lineChart=new D.Chart("lastdaysEvents",{type:"line",data:{labels:g,datasets:[{label:"Number of messages",data:r,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"TITLE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,maxTicksLimit:this.selectedDaysId>60?10:this.selectedDaysId,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(c,p,d){if(Math.floor(c)===c)return c},display:!0,fontColor:"black",suggestedMax:S+2}}]},tooltips:{callbacks:{label:(c,p)=>{const d=c.yLabel;return this.translate.instant("Analytics.Metrics.Events")+": "+d}}}},plugins:[{beforeDraw:function(c,p){var d=c.chart.ctx;d.height=128,d.font="Roboto"}}]})},s=>{this.logger.error("[ANALYTICS - EVENTS] \xbb\xbb EVENTS BY DAY - ERROR ",s)},()=>{this.logger.log("[ANALYTICS - EVENTS] \xbb\xbb EVENTS BY DAY - * COMPLETE * ")})}getMaxOfArray(e){return Math.max.apply(null,e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(M.y),t.Y36(L.sK),t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-events-analytics"]],decls:64,vars:65,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","12px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[4,"ngIf"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","52px","padding-right","38px"],[1,"col-sm-4"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],["name","event",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"card-content","chart-container",2,"position","relative","margin","auto 12px","height","35vh"],["id","lastdaysEvents"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",1)(7,"div",4)(8,"div",5)(9,"span",6),t._uU(10),t.ALo(11,"translate"),t.YNc(12,pt,3,3,"span",7),t.YNc(13,ut,3,3,"span",7),t.YNc(14,At,3,3,"span",7),t.TgZ(15,"span",8),t._uU(16),t.TgZ(17,"i",9),t._uU(18," arrow_forward "),t.qZA(),t._uU(19),t.qZA()()(),t.TgZ(20,"div",10)(21,"div",11)(22,"div",12)(23,"div",13)(24,"label",14),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"div",15)(28,"ng-select",16),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(i){return n.daysSelect(n.selectedDaysId,i)}),t.TgZ(29,"ng-option",17),t._uU(30),t.ALo(31,"translate"),t.ALo(32,"translate"),t.qZA(),t.TgZ(33,"ng-option",17),t._uU(34),t.ALo(35,"translate"),t.ALo(36,"translate"),t.qZA(),t.TgZ(37,"ng-option",17),t._uU(38),t.ALo(39,"translate"),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"ng-option",17),t._uU(42),t.ALo(43,"translate"),t.ALo(44,"translate"),t.qZA(),t.TgZ(45,"ng-option",17),t._uU(46),t.ALo(47,"translate"),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"ng-option",17),t._uU(50),t.ALo(51,"translate"),t.ALo(52,"translate"),t.qZA()()()()()(),t.TgZ(53,"div",11)(54,"div",12)(55,"div",13)(56,"label",14),t._uU(57),t.ALo(58,"translate"),t.qZA(),t.TgZ(59,"div",15)(60,"ng-select",18),t.NdJ("ngModelChange",function(i){return n.selectedEventName=i})("change",function(){return n.eventSelected(n.selectedEventName)}),t.YNc(61,mt,3,4,"ng-option",19),t.qZA()()()()()(),t.TgZ(62,"div",20),t._UZ(63,"canvas",21),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,33,"Analytics.Events.EventsMonitoring")," "),t.xp6(7),t.AsE(" ",t.lcZ(11,35,"Analytics.Events.EventsChartTitle")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(26,37,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(31,39,"Analytics.Last")," 7 ",t.lcZ(32,41,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(35,43,"Analytics.Last")," 15 ",t.lcZ(36,45,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(39,47,"Analytics.Last")," 30 ",t.lcZ(40,49,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(43,51,"Analytics.Last")," 3 ",t.lcZ(44,53,"Analytics.Months")," "),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(47,55,"Analytics.Last")," 6 ",t.lcZ(48,57,"Analytics.Months")," "),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(51,59,"Analytics.Last")," 1 ",t.lcZ(52,61,"Analytics.Year")," "),t.xp6(7),t.hij(" ",t.lcZ(58,63,"Name")," "),t.xp6(3),t.Q6J("ngModel",n.selectedEventName)("clearable",!1),t.xp6(1),t.Q6J("ngForOf",n.staticEventsNameList))},dependencies:[E.sg,E.O5,v.w9,v.jq,I.JJ,I.On,L.X$],styles:['.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n  padding-top: 5px;\n}\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n.chart-wrapper-visitors[_ngcontent-%COMP%] {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  min-height: 345px;\n  background-color: white;\n}\n.chart-title-visitors[_ngcontent-%COMP%] {\n  padding: 12px 0px;\n  font-size: 18px;\n  display: inline-block;\n  vertical-align: middle;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.number-analytics[_ngcontent-%COMP%] {\n  font-size: 50px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-days[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}']}),a})();function St(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function ft(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function Ct(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}function _t(a,l){if(1&a&&(t.TgZ(0,"ng-option",23),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function yt(a,l){if(1&a&&(t.TgZ(0,"ng-option",23),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}let Et=(()=>{class a{constructor(e,n,s,i,r){this.translate=e,this.analyticsService=n,this.usersService=s,this.faqKbService=i,this.logger=r,this.lastdays=7,this.projectUserAndBotsArray=[],this.conversationType=[{id:"",name:"All"},...k.pD],this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - MSGS] LANGUAGE ",this.lang),this.switchMonthName(),this.getProjectUsersAndBots(),this.getAggregateValue()}ngOnInit(){this.selected="day",this.selectedDaysId=7,this.selectedAgentId="",this.selectedChannelId="",this.initDay=o()().subtract(6,"d").format("D/M/YYYY"),this.endDay=o()().subtract(0,"d").format("D/M/YYYY"),this.logger.log("[ANALYTICS - MSGS] INIT",this.initDay,"END",this.endDay),this.getMessagesByLastNDays(this.selectedDaysId,this.selectedAgentId,this.selectedChannelId)}switchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}getProjectUsersAndBots(){const e=this.usersService.getProjectUsersByProjectId(),n=this.faqKbService.getAllBotByProjectId();(0,Q.$R)(e,n,(s,i)=>({_projectUsers:s,_bots:i})).subscribe(s=>{this.logger.log("[ANALYTICS - MSGS] - GET P-USERS-&-BOTS - PROJECT USERS : ",s._projectUsers),s&&s._projectUsers&&(this.projectUsersList=s._projectUsers,this.projectUsersList.forEach(i=>{this.projectUserAndBotsArray.push({id:i.id_user._id,name:i.id_user.firstname+" "+i.id_user.lastname})})),s&&s._bots&&(this.bots=s._bots.filter(i=>!1===i.trashed),this.bots.forEach(i=>{let r="";"internal"===i.type&&(r="bot_"),this.projectUserAndBotsArray.push({id:r+i._id,name:i.name+" (bot)"})})),this.logger.log("[ANALYTICS - MSGS] - GET P-USERS-&-BOTS - PROJECT-USER & BOTS ARRAY : ",this.projectUserAndBotsArray)},s=>{this.logger.error("[ANALYTICS - MSGS] - GET P-USERS-&-BOTS - ERROR: ",s)},()=>{this.logger.log("[ANALYTICS - MSGS] - GET P-USERS-&-BOTS - COMPLETE")})}ngOnDestroy(){this.logger.log("[ANALYTICS - MSGS] - !!!!! UN - SUBSCRIPTION TO REQUESTS"),this.subscription.unsubscribe()}daysSelect(e,n){this.logger.log("[ANALYTICS - MSGS] daysSelect EVENT: ",n),this.selectedDaysId=e,e<=30?this.lastdays=e:90==e||180==e?this.lastdays=e/30:360==e&&(this.lastdays=1),this.lineChart.destroy(),this.getMessagesByLastNDays(e,this.selectedAgentId,this.selectedChannelId)}agentSelected(e){this.logger.log("[ANALYTICS - MSGS] Selected agent: ",e),this.lineChart.destroy(),this.subscription.unsubscribe(),this.getMessagesByLastNDays(this.selectedDaysId,e,this.selectedChannelId),this.logger.log("[ANALYTICS - MSGS] REQUEST:",this.selectedDaysId,e)}conversationTypeSelected(e){this.logger.log("[ANALYTICS - CONVS]  Selected channel: ",e),this.lineChart.destroy(),this.subscription.unsubscribe(),this.getMessagesByLastNDays(this.selectedDaysId,"",e),this.logger.log("[ANALYTICS - MSGS] REQUEST:",this.selectedDaysId,e)}getAggregateValue(){this.analyticsService.getLastMountMessagesCount().subscribe(e=>{this.logger.log("[ANALYTICS - MSGS] LAST MONTH MESSAGES COUNT: ",e),e&&e[0]?(this.messageCountLastMonth=e[0].totalCount,this.logger.log("[ANALYTICS - MSGS] Message Count: ",this.messageCountLastMonth)):(this.logger.log("[ANALYTICS - MSGS] THRE ARE NOT MSG IN THE LAST MONTH"),this.messageCountLastMonth=0)},e=>{this.logger.error("[ANALYTICS - MSGS] Impossible to retrieve monthly count",e),this.messageCountLastMonth=0})}getMessagesByLastNDays(e,n,s){this.logger.log("[ANALYTICS - MSGS] Lastdays: ",e),this.subscription=this.analyticsService.getMessagesByDay(e,n,s).subscribe(i=>{this.logger.log("[ANALYTICS - MSGS] \xbb\xbb MESSAGES BY DAY RESULT: ",i);const r=[];for(let p=0;p<e;p++)r.push({count:0,day:o()().subtract(p,"d").format("D/M/YYYY")});r.reverse();const g=[],m=[],T=[];for(let p=0;p<i.length;p++)i[p]&&T.push({count:i[p].count,day:i[p]._id.day+"/"+i[p]._id.month+"/"+i[p]._id.year});const S=r.map(p=>T.find(d=>d.day===p.day)||p);this.logger.log("[ANALYTICS - MSGS] - MESSGES BY DAY - FINAL ARRAY ",S),this.initDay=S[0].day,this.endDay=S[e-1].day,this.logger.log("[ANALYTICS - MSGS] INIT",this.initDay,"END",this.endDay),S.forEach(p=>{g.push(p.count);const d=p.day.split("/");m.push(d[0]+" "+this.monthNames[d[1]])}),this.logger.log("[ANALYTICS - MSGS] \xbb\xbb MESSAGES BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",g),this.logger.log("[ANALYTICS - MSGS] \xbb\xbb MESSAGES BY DAY - LABELS (+ NEW + ARRAY OF DAY)",m);const _=this.getMaxOfArray(g);this.lineChart=new D.Chart("lastdaysMessages",{type:"line",data:{labels:m,datasets:[{label:"Number of messages",data:g,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"TITLE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,maxTicksLimit:this.selectedDaysId>60?10:this.selectedDaysId,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(p,d,C){if(Math.floor(p)===p)return p},display:!0,fontColor:"black",suggestedMax:_+2}}]},tooltips:{callbacks:{label:(p,d)=>{const C=p.yLabel;return this.translate.instant("RequestMsgsPage.Messages")+": "+C}}}},plugins:[{beforeDraw:function(p,d){var C=p.chart.ctx;C.height=128,C.font="Roboto"}}]})},i=>{this.logger.error("[ANALYTICS - MSGS] \xbb\xbb MESSAGES BY DAY - ERROR ",i)},()=>{this.logger.log("[ANALYTICS - MSGS] \xbb\xbb MESSAGES BY DAY - * COMPLETE * ")})}getMaxOfArray(e){return Math.max.apply(null,e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(L.sK),t.Y36(M.y),t.Y36(P.f),t.Y36(w.M),t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-messages"]],decls:84,vars:79,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-md-3"],[1,"card",2,"border-radius","10px","min-height","424px"],[2,"padding-bottom","28px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content"],[1,"number-analytics"],[1,"col-md-9"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","12px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[4,"ngIf"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","52px","padding-right","38px"],[1,"col-sm-4"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],["name","agent",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["name","conversation-type",1,"custom","ng-select-conversation-type",3,"ngModel","clearable","ngModelChange","change"],[1,"card-content","chart-container",2,"position","relative","margin","12px 12px","height","35vh"],["id","lastdaysMessages"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"p",8),t._uU(13),t.qZA()()()(),t.TgZ(14,"div",9)(15,"div",10)(16,"div",11)(17,"span",12),t._uU(18),t.ALo(19,"translate"),t.YNc(20,St,3,3,"span",13),t.YNc(21,ft,3,3,"span",13),t.YNc(22,Ct,3,3,"span",13),t.TgZ(23,"span",14),t._uU(24),t.TgZ(25,"i",15),t._uU(26," arrow_forward "),t.qZA(),t._uU(27),t.qZA()()(),t.TgZ(28,"div",16)(29,"div",17)(30,"div",18)(31,"div",19)(32,"label",20),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"div",21)(36,"ng-select",22),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(i){return n.daysSelect(n.selectedDaysId,i)}),t.TgZ(37,"ng-option",23),t._uU(38),t.ALo(39,"translate"),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"ng-option",23),t._uU(42),t.ALo(43,"translate"),t.ALo(44,"translate"),t.qZA(),t.TgZ(45,"ng-option",23),t._uU(46),t.ALo(47,"translate"),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"ng-option",23),t._uU(50),t.ALo(51,"translate"),t.ALo(52,"translate"),t.qZA(),t.TgZ(53,"ng-option",23),t._uU(54),t.ALo(55,"translate"),t.ALo(56,"translate"),t.qZA(),t.TgZ(57,"ng-option",23),t._uU(58),t.ALo(59,"translate"),t.ALo(60,"translate"),t.qZA()()()()()(),t.TgZ(61,"div",17)(62,"div",18)(63,"div",19)(64,"label",20),t._uU(65),t.ALo(66,"translate"),t.qZA(),t.TgZ(67,"div",21)(68,"ng-select",24),t.NdJ("ngModelChange",function(i){return n.selectedAgentId=i})("change",function(){return n.agentSelected(n.selectedAgentId)}),t.TgZ(69,"ng-option",23),t._uU(70),t.ALo(71,"translate"),t.qZA(),t.YNc(72,_t,2,2,"ng-option",25),t.qZA()()()()(),t.TgZ(73,"div",17)(74,"div",18)(75,"div",19)(76,"label",20),t._uU(77),t.ALo(78,"translate"),t.qZA(),t.TgZ(79,"div",21)(80,"ng-select",26),t.NdJ("ngModelChange",function(i){return n.selectedChannelId=i})("change",function(){return n.conversationTypeSelected(n.selectedChannelId)}),t.YNc(81,yt,2,2,"ng-option",25),t.qZA()()()()()(),t.TgZ(82,"div",27),t._UZ(83,"canvas",28),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,41,"Analytics.Messages.NumberOfMessages")," "),t.xp6(6),t.hij(" ",t.lcZ(10,43,"Last30DaysMessages")," "),t.xp6(4),t.Oqu(n.messageCountLastMonth),t.xp6(5),t.AsE(" ",t.lcZ(19,45,"Analytics.Messages.MessagesChartTitle")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(34,47,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(39,49,"Analytics.Last")," 7 ",t.lcZ(40,51,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(43,53,"Analytics.Last")," 15 ",t.lcZ(44,55,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(47,57,"Analytics.Last")," 30 ",t.lcZ(48,59,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(51,61,"Analytics.Last")," 3 ",t.lcZ(52,63,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(55,65,"Analytics.Last")," 6 ",t.lcZ(56,67,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(59,69,"Analytics.Last")," 1 ",t.lcZ(60,71,"Analytics.Year"),""),t.xp6(7),t.hij(" ",t.lcZ(66,73,"Agent")," "),t.xp6(3),t.Q6J("ngModel",n.selectedAgentId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(71,75,"HistoryPage.AllAgents")),t.xp6(2),t.Q6J("ngForOf",n.projectUserAndBotsArray),t.xp6(5),t.hij(" ",t.lcZ(78,77,"MessageChannel")," "),t.xp6(3),t.Q6J("ngModel",n.selectedChannelId)("clearable",!1),t.xp6(1),t.Q6J("ngForOf",n.conversationType))},dependencies:[E.sg,E.O5,v.w9,v.jq,I.JJ,I.On,L.X$],styles:['.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n  padding-top: 5px;\n}\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n.chart-wrapper-messages[_ngcontent-%COMP%] {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  min-height: 345px;\n  background-color: white;\n}\n.chart-title-messages[_ngcontent-%COMP%] {\n  padding: 12px 0px;\n  font-size: 18px;\n  display: inline-block;\n  vertical-align: middle;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.number-analytics[_ngcontent-%COMP%] {\n  font-size: 50px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-days[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}']}),a})();const Lt=function(){return{range_count:7}};function bt(a,l){1&a&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"ConversationsInTheLastDays",t.DdM(4,Lt))," "))}const It=function(){return{range_count:15}};function vt(a,l){1&a&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"ConversationsInTheLastDays",t.DdM(4,It))," "))}const Nt=function(){return{range_count:30}};function Rt(a,l){1&a&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"ConversationsInTheLastDays",t.DdM(4,Nt))," "))}const xt=function(){return{range_count:3}};function Dt(a,l){1&a&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"ConversationsInTheLastMonths",t.DdM(4,xt))," "))}const Ot=function(){return{range_count:6}};function Yt(a,l){1&a&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"ConversationsInTheLastMonths",t.DdM(4,Ot))," "))}const Mt=function(){return{range_count:365}};function Zt(a,l){1&a&&(t.TgZ(0,"div",35),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.xi3(2,1,"ConversationsInTheLastDays",t.DdM(4,Mt))," "))}function Ut(a,l){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,e.totalHuman,"1.0-0")," ")}}function qt(a,l){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,e.totalBot,"1.0-0")," ")}}function Pt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function Vt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function wt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}function Bt(a,l){if(1&a&&(t.TgZ(0,"ng-option",28),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e._id),t.xp6(1),t.Oqu(e.name)}}function Qt(a,l){if(1&a&&(t.TgZ(0,"ng-option",28),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function kt(a,l){if(1&a&&(t.TgZ(0,"ng-option",28),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}let Gt=(()=>{class a{constructor(e,n,s,i,r,g){this.analyticsService=e,this.translate=n,this.departmentService=s,this.usersService=i,this.faqKbService=r,this.logger=g,this.lastdays=7,this.user_and_bot_array=[],this.projectUserAndBotsArray=[],this.conversationType=[{id:"",name:"All"},...k.pD],this.agentIsAChatbot=!1,this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - CONVS] LANGUAGE ",this.lang),this.getBrowserLangAndSwitchMonthName()}ngOnInit(){this.selected="day",this.selectedDeptId="",this.selectedDaysId=7,this.selectedAgentId="",this.selectedChannelId="",this.initDay=o()().subtract(6,"d").format("D/M/YYYY"),this.endDay=o()().subtract(0,"d").format("D/M/YYYY"),this.logger.log("[ANALYTICS - CONVS] INIT",this.initDay,"END",this.endDay),this.getAggregateValue(),this.getRequestByLastNDayMerge(this.selectedDaysId,this.selectedDeptId,this.selectedChannelId),this.getDepartments(),this.getProjectUsersAndBots()}ngOnDestroy(){this.logger.log("[ANALYTICS - CONVS] - !!!!! UN - SUBSCRIPTION TO REQUESTS"),this.subscription.unsubscribe()}ngAfterViewInit(){const e=document.querySelector(".ng-select-days > .ng-select-container > .ng-value-container > .ng-input > input");this.logger.log("[ANALYTICS - CONVS] EL-INPUT Of NgSelectDays ",e),e&&e.setAttribute("id","select-days");const n=document.querySelector(".ng-select-dept > .ng-select-container > .ng-value-container > .ng-input > input");this.logger.log("[ANALYTICS - CONVS] EL-INPUT Of NgSelectDept ",n),n&&n.setAttribute("id","select-dept");const s=document.querySelector(".ng-select-agent > .ng-select-container > .ng-value-container > .ng-input > input");this.logger.log("[ANALYTICS - CONVS] EL-INPUT Of NgSelectAgent ",s),s&&s.setAttribute("id","select-agent");const i=document.querySelector(".ng-select-ng-select-conversation-type > .ng-select-container > .ng-value-container > .ng-input > input");this.logger.log("[ANALYTICS - CONVS] EL-INPUT Of NgSelectConversation ",i),i&&i.setAttribute("id","select-conversation")}daysSelect(e,n){this.logger.log("[ANALYTICS - CONVS] daysSelect EVENT",n),this.selectedDaysId=e,e<=30?this.lastdays=e:90===e||180===e?this.lastdays=e/30:365===e&&(this.lastdays=1),this.lineChart.destroy(),this.subscription.unsubscribe(),this.logger.log("[ANALYTICS - CONVS] ++++++++++ SELECTED AGENT: ",this.selectedAgentId),this.selectedAgentId?(this.getRequestByLastNDay(e,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId),this.logger.log("[ANALYTICS - CONVS] getRequestByLastNDay REQUEST:",e,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId)):(this.getRequestByLastNDayMerge(this.selectedDaysId,this.selectedDeptId,this.selectedChannelId),this.logger.log("[ANALYTICS - CONVS] getRequestByLastNDayMerge REQUEST:",this.selectedDaysId,this.selectedDeptId))}depSelected(e){this.logger.log("[ANALYTICS - CONVS] depSelected",e),this.lineChart.destroy(),this.subscription.unsubscribe(),this.selectedAgentId?(this.getRequestByLastNDay(this.selectedDaysId,e,this.selectedAgentId,this.selectedChannelId),this.logger.log("[ANALYTICS - CONVS] getRequestByLastNDay:",this.selectedDaysId,e,this.selectedAgentId,this.selectedChannelId)):(this.getRequestByLastNDayMerge(this.selectedDaysId,this.selectedDeptId,this.selectedChannelId),this.logger.log("[ANALYTICS - CONVS] getRequestByLastNDayMerge REQUEST:",this.selectedDaysId,this.selectedDeptId))}agentSelected(e){this.logger.log("[ANALYTICS - CONVS]  Selected agent: ",e),this.lineChart.destroy(),this.subscription.unsubscribe(),this.selectedAgentId?(this.getRequestByLastNDay(this.selectedDaysId,this.selectedDeptId,e,this.selectedChannelId),this.logger.log("[ANALYTICS - CONVS] agentSelected getRequestByLastNDay REQUEST:",this.selectedDaysId,this.selectedDeptId,e,this.selectedChannelId)):(this.getRequestByLastNDayMerge(this.selectedDaysId,this.selectedDeptId,this.selectedChannelId),this.logger.log("[ANALYTICS - CONVS] agentSelected getRequestByLastNDayMerge REQUEST:",this.selectedDaysId,this.selectedDeptId))}conversationTypeSelected(e){this.logger.log("[ANALYTICS - CONVS]  Selected channel: ",e),this.lineChart.destroy(),this.subscription.unsubscribe(),this.selectedAgentId?(this.getRequestByLastNDay(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,e),this.logger.log("[ANALYTICS - CONVS] agentSelected getRequestByLastNDay REQUEST:",this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,e)):(this.getRequestByLastNDayMerge(this.selectedDaysId,this.selectedDeptId,e),this.logger.log("[ANALYTICS - CONVS] agentSelected getRequestByLastNDayMerge REQUEST:",this.selectedDaysId,this.selectedDeptId))}getDepartments(){this.departmentService.getDeptsByProjectId().subscribe(e=>{this.logger.log("[ANALYTICS - CONVS] - GET DEPTS RES ",e),this.departments=e},e=>{this.logger.error("[ANALYTICS - CONVS]- GET DEPTS - ERROR: ",e)},()=>{this.logger.log("[ANALYTICS - CONVS] - GET DEPTS * COMPLETE *")})}getProjectUsersAndBots(){const e=this.usersService.getProjectUsersByProjectId(),n=this.faqKbService.getAllBotByProjectId();(0,Q.$R)(e,n,(s,i)=>({_projectUsers:s,_bots:i})).subscribe(s=>{this.logger.log("[ANALYTICS - CONVS] - GET P-USERS-&-BOTS - PROJECT USERS : ",s._projectUsers),this.logger.log("[ANALYTICS - CONVS] - GET P-USERS-&-BOTS - BOTS: ",s._bots),s&&s._projectUsers&&(this.projectUsersList=s._projectUsers,this.projectUsersList.forEach(i=>{this.projectUserAndBotsArray.push({id:i.id_user._id,name:i.id_user.firstname+" "+i.id_user.lastname})})),s&&s._bots&&(this.bots=s._bots.filter(i=>!1===i.trashed),this.bots.forEach(i=>{this.projectUserAndBotsArray.push({id:"bot_"+i._id,name:i.name+" (bot)"})})),this.logger.log("[ANALYTICS - CONVS] - GET P-USERS-&-BOTS - PROJECT-USER & BOTS ARRAY : ",this.projectUserAndBotsArray)},s=>{this.logger.error("[ANALYTICS - CONVS] - GET P-USERS-&-BOTS - ERROR: ",s)},()=>{this.logger.log("[ANALYTICS - CONVS] - GET P-USERS-&-BOTS - COMPLETE")})}getBrowserLangAndSwitchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}getMinOfArray(e){return Math.min.apply(null,e)}getMaxOfArray(e){return Math.max.apply(null,e)}getAggregateValue(){this.analyticsService.getLastMountConversationsCount().subscribe(e=>{this.logger.log("[ANALYTICS - CONVS] LAST MONTH CONVERSATIONS COUNT: ",e),e&&e[0]?(this.conversationsCountLastMonth=e[0].totalCount,this.logger.log("[ANALYTICS - CONVS] --\x3e Conversations Last Month Count: ",this.conversationsCountLastMonth)):(this.logger.log("[ANALYTICS - CONVS] --\x3e Conversations Last Month Count - THERE ARE NOT CONVS IN THE LAST MONTH"),this.conversationsCountLastMonth=0)},e=>{this.logger.error("[ANALYTICS - CONVS] Impossible to retrieve monthly count",e),this.conversationsCountLastMonth=0})}getRequestByLastNDay(e,n,s,i){this.logger.log("[ANALYTICS - CONVS] user has filter participantID"),this.totalBot=0,this.totalHuman=0,this.agentIsAChatbot=!1,s.includes("bot")&&(this.logger.log("[ANALYTICS - CONVS] Selected Agent is a BOT"),this.agentIsAChatbot=!0),this.logger.log("[ANALYTICS - CONVS] GET REQUEST TYPE: For Agent/Bot"),this.subscription=this.analyticsService.requestsByDay(e,n,s,i).subscribe(r=>{this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY  N-DAY ",r);const g=[];for(let u=0;u<e;u++)g.push({count:0,day:o()().subtract(u,"d").format("D/M/YYYY")});g.reverse(),this.logger.log("[ANALYTICS - CONVS]- REQUESTS BY lastDAY - MOMENT LAST N DATE (init array)",g);const S=[];for(let u=0;u<r.length;u++)r[u]&&S.push({count:r[u].count,day:r[u]._id.day+"/"+r[u]._id.month+"/"+r[u]._id.year});this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY FORMATTED ",S);const _=g.map(u=>S.find(y=>y.day===u.day)||u);this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - FINAL ARRAY ",_);const h=[],c=[];this.initDay=_[0].day,this.endDay=_[e-1].day,this.logger.log("INIT",this.initDay,"END",this.endDay),_.forEach(u=>{h.push(u.count);const y=u.day.split("/");c.push(y[0]+" "+this.monthNames[y[1]])}),this.agentIsAChatbot?(this.totalBot=h.reduce((u,y)=>u+y,0),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - totalBot 1",this.totalBot),this.totalHuman=0,this.percentageOfRequestsHandledByBots=this.totalBot>0?100:0):(this.totalHuman=h.reduce((u,y)=>u+y,0),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - totalHuman 1",this.totalBot),this.totalBot=0,this.percentageOfRequestsHandledByBots=0),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - _requestsByDay_series_array",h),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - this.totalBot",this.totalBot),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - this.totalBot",this.totalHuman),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - SERIES (ARRAY OF COUNT - to use for debug)",[]),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",h),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - LABELS (ARRAY OF DAY - to use for debug)",[]),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - LABELS (+ NEW + ARRAY OF DAY)",c);const p=this.getMaxOfArray(h);var d;this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - -> HIGHTER COUNT ",p),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - ->_requestsByDay_series_array ",h),d=this.selectedDaysId>60?10:this.selectedDaysId,this.lineChart=new D.Chart("lastNdayChart",{type:"line",data:{labels:c,datasets:[{label:this.translate.instant("ServedByHumans"),data:h,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"Number of Conversations",display:!1},legend:{display:!1,position:"bottom",fullWidth:!1,labels:{usePointStyle:!0,padding:10}},scales:{xAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:d,display:!0,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(u,y,R){if(Math.floor(u)===u)return u},display:!0,fontColor:"black",suggestedMax:p+1}}]},tooltips:{callbacks:{label:(u,y)=>{const R=u.yLabel;return this.translate.instant("Requests")+":"+R}}}},plugins:[{beforeDraw:function(u,y){var R=u.chart.ctx;R.height=128,R.font="Roboto"}}]})},r=>{this.logger.error("[ANALYTICS - CONVS] - REQUESTS BY DAY - ERROR ",r)},()=>{this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY * COMPLETE *")})}getMaxValueFromArrays(e,n){const s=[...e,...n];return this.logger.log("mergedArray",s),Math.max(...s)}getRequestByLastNDayMerge(e,n,s){this.logger.log("[ANALYTICS - CONVS] user NOT has filter participantID"),this.totalBot=0,this.totalHuman=0,this.agentIsAChatbot=!1,this.logger.log("[ANALYTICS - CONVS] GET REQUEST TYPE: Merged lastdays",e),this.subscription=this.analyticsService.requestsByDay(e,n,"",s).subscribe(i=>{this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY  N-DAY ",i),this.analyticsService.requestsByDayBotServed(e,n,"",s).subscribe(r=>{this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY N-DAY BOT SERVED ",r);const g=[];for(let A=0;A<e;A++)g.push({count:0,day:o()().subtract(A,"d").format("D/M/YYYY")});g.reverse(),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY lastDAY - MOMENT LAST N DATE (init array)",g);const S=[],_=[];for(let A=0;A<i.length;A++)i[A]&&S.push({count:i[A].count,day:i[A]._id.day+"/"+i[A]._id.month+"/"+i[A]._id.year});for(let A=0;A<r.length;A++)r[A]&&1==r[A]._id.hasBot&&_.push({count:r[A].count,day:r[A]._id.day+"/"+r[A]._id.month+"/"+r[A]._id.year});this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY FORMATTED ",S),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY BOT SERVED FORMATTED ",_);const h=g.map(A=>S.find(b=>b.day===A.day)||A);this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - FINAL ARRAY ",h);const c=g.map(A=>_.find(b=>b.day===A.day)||A);this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY BOT SERVED - FINAL ARRAY ",c);const p=[],d=[],C=[];this.initDay=h[0].day,this.endDay=h[e-1].day,this.logger.log("[ANALYTICS - CONVS] INIT",this.initDay,"END",this.endDay),h.forEach(A=>{p.push(A.count);const b=A.day.split("/");d.push(b[0]+" "+this.monthNames[b[1]])}),c.forEach(A=>{C.push(A.count)});const u=h.map(A=>A.count),y=c.map(A=>A.count);this.logger.log("[ANALYTICS - CONVS] - humanCounts ",u),this.logger.log("[ANALYTICS - CONVS] - botCounts ",y),this.totalHuman=u.reduce((A,b)=>A+b,0),this.totalBot=y.reduce((A,b)=>A+b,0),this.percentageOfRequestsHandledByBots=this.totalBot>0?(this.totalBot/this.totalHuman*100).toFixed(2).replace(".",","):"0",this.logger.log("[ANALYTICS - CONVS] - totalHuman ",this.totalHuman),this.logger.log("[ANALYTICS - CONVS] - totalBot ",this.totalBot),this.logger.log("[ANALYTICS - CONVS] - percentageOfRequestsHandledByBots ",this.percentageOfRequestsHandledByBots),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - SERIES (ARRAY OF COUNT - to use for debug)",[]),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",p),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",C),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - LABELS (ARRAY OF DAY - to use for debug)",[]),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY - LABELS (+ NEW + ARRAY OF DAY)",d);const R=this.getMaxValueFromArrays(u,y);var O;this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY -> HIGHTER COUNT ",R),this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY -> _requestsByDay_series_array ",p),O=this.selectedDaysId>60?10:this.selectedDaysId,this.lineChart=new D.Chart("lastNdayChart",{type:"line",data:{labels:d,datasets:[{label:this.translate.instant("ServedByBots"),data:C,fill:!0,lineTension:0,backgroundColor:"rgba(232, 32, 32, 0.6)",borderColor:"rgba(189, 16, 16, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#b00e0e"},{label:this.translate.instant("TotalConversations"),data:p,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"AVERAGE TIME RESPONSE",display:!1},legend:{display:!0,position:"bottom",fullWidth:!1,labels:{usePointStyle:!0,padding:10}},scales:{xAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:O,display:!0,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(A,b,Y){if(Math.floor(A)===A)return A},display:!0,fontColor:"black",suggestedMax:R+1}}]},tooltips:{callbacks:{label:(A,b)=>{const Y=A.yLabel;return this.translate.instant("Requests")+":"+Y}}}},plugins:[{beforeDraw:function(A,b){var Y=A.chart.ctx;Y.height=128,Y.font="Roboto"}}]})})},i=>{this.logger.error("[ANALYTICS - CONVS] - REQUESTS BY DAY - ERROR ",i)},()=>{this.logger.log("[ANALYTICS - CONVS] - REQUESTS BY DAY * COMPLETE *")})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(M.y),t.Y36(L.sK),t.Y36(B.n),t.Y36(P.f),t.Y36(w.M),t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-requests"]],decls:125,vars:107,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-md-3"],[1,"card",2,"border-radius","10px","min-height","468px"],[1,"conv-analytics-left-card-title-wpr"],["class","conv-analytics-left-card-title",4,"ngIf"],[1,"conv-analytics-indicator-container"],[1,"conv-analytics-indicator-title-wpr"],[1,"conv-analytics-indicator-title"],[1,"conv-analytics-indicator-value-wpr"],["color","disabled",1,"conv-analytics-indicator-value"],[4,"ngIf"],[1,"percentage-symbol"],[1,"col-md-9"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","12px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","52px","padding-right","38px"],[1,"col-sm-3"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom","ng-select-days",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],["name","dept",1,"custom","ng-select-dept",3,"ngModel","clearable","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["name","agent",1,"custom","ng-select-agent",3,"ngModel","clearable","ngModelChange","change"],["name","conversation-type",1,"custom","ng-select-conversation-type",3,"ngModel","clearable","ngModelChange","change"],[1,"card-content","chart-container",2,"position","relative","margin","auto 12px","height","35vh"],["id","lastNdayChart"],[1,"conv-analytics-left-card-title"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t.YNc(9,bt,3,5,"div",7),t.YNc(10,vt,3,5,"div",7),t.YNc(11,Rt,3,5,"div",7),t.YNc(12,Dt,3,5,"div",7),t.YNc(13,Yt,3,5,"div",7),t.YNc(14,Zt,3,5,"div",7),t.qZA(),t.TgZ(15,"div",8)(16,"div",9)(17,"h2",10),t._uU(18),t.ALo(19,"translate"),t.qZA()(),t.TgZ(20,"div",11)(21,"h2",12),t.YNc(22,Ut,3,4,"span",13),t.YNc(23,qt,3,4,"span",13),t.qZA()()(),t.TgZ(24,"div",8)(25,"div",9)(26,"h2",10),t._uU(27),t.ALo(28,"translate"),t.qZA()(),t.TgZ(29,"div",11)(30,"h2",12),t._uU(31),t.ALo(32,"number"),t.qZA()()(),t.TgZ(33,"div",8)(34,"div",9)(35,"h2",10),t._uU(36),t.ALo(37,"translate"),t.qZA()(),t.TgZ(38,"div",11)(39,"h2",12),t._uU(40),t.TgZ(41,"span",14),t._uU(42," % "),t.qZA()()()()()(),t.TgZ(43,"div",15)(44,"div",16)(45,"div",17)(46,"span",18),t._uU(47),t.ALo(48,"translate"),t.YNc(49,Pt,3,3,"span",13),t.YNc(50,Vt,3,3,"span",13),t.YNc(51,wt,3,3,"span",13),t.TgZ(52,"span",19),t._uU(53),t.TgZ(54,"i",20),t._uU(55," arrow_forward "),t.qZA(),t._uU(56),t.qZA()()(),t.TgZ(57,"div",21)(58,"div",22)(59,"div",23)(60,"div",24)(61,"label",25),t._uU(62),t.ALo(63,"translate"),t.qZA(),t.TgZ(64,"div",26)(65,"ng-select",27),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(i){return n.daysSelect(n.selectedDaysId,i)}),t.TgZ(66,"ng-option",28),t._uU(67),t.ALo(68,"translate"),t.ALo(69,"translate"),t.qZA(),t.TgZ(70,"ng-option",28),t._uU(71),t.ALo(72,"translate"),t.ALo(73,"translate"),t.qZA(),t.TgZ(74,"ng-option",28),t._uU(75),t.ALo(76,"translate"),t.ALo(77,"translate"),t.qZA(),t.TgZ(78,"ng-option",28),t._uU(79),t.ALo(80,"translate"),t.ALo(81,"translate"),t.qZA(),t.TgZ(82,"ng-option",28),t._uU(83),t.ALo(84,"translate"),t.ALo(85,"translate"),t.qZA(),t.TgZ(86,"ng-option",28),t._uU(87),t.ALo(88,"translate"),t.ALo(89,"translate"),t.qZA()()()()()(),t.TgZ(90,"div",22)(91,"div",23)(92,"div",24)(93,"label",25),t._uU(94),t.ALo(95,"translate"),t.qZA(),t.TgZ(96,"div",26)(97,"ng-select",29),t.NdJ("ngModelChange",function(i){return n.selectedDeptId=i})("change",function(){return n.depSelected(n.selectedDeptId)}),t.TgZ(98,"ng-option",28),t._uU(99),t.ALo(100,"translate"),t.qZA(),t.YNc(101,Bt,2,2,"ng-option",30),t.qZA()()()()(),t.TgZ(102,"div",22)(103,"div",23)(104,"div",24)(105,"label",25),t._uU(106),t.ALo(107,"translate"),t.qZA(),t.TgZ(108,"div",26)(109,"ng-select",31),t.NdJ("ngModelChange",function(i){return n.selectedAgentId=i})("change",function(){return n.agentSelected(n.selectedAgentId)}),t.TgZ(110,"ng-option",28),t._uU(111),t.ALo(112,"translate"),t.qZA(),t.YNc(113,Qt,2,2,"ng-option",30),t.qZA()()()()(),t.TgZ(114,"div",22)(115,"div",23)(116,"div",24)(117,"label",25),t._uU(118),t.ALo(119,"translate"),t.qZA(),t.TgZ(120,"div",26)(121,"ng-select",32),t.NdJ("ngModelChange",function(i){return n.selectedChannelId=i})("change",function(){return n.conversationTypeSelected(n.selectedChannelId)}),t.YNc(122,kt,2,2,"ng-option",30),t.qZA()()()()()(),t.TgZ(123,"div",33),t._UZ(124,"canvas",34),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,58,"NumberOfRequests")," "),t.xp6(6),t.Q6J("ngIf",7===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",15===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",30===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",365===n.selectedDaysId),t.xp6(4),t.hij(" ",t.lcZ(19,60,"TotalConversations")," "),t.xp6(4),t.Q6J("ngIf",!n.agentIsAChatbot),t.xp6(1),t.Q6J("ngIf",n.agentIsAChatbot),t.xp6(4),t.hij(" ",t.lcZ(28,62,"HandledByBots")," "),t.xp6(4),t.hij(" ",t.xi3(32,64,n.totalBot,"1.0-0")," "),t.xp6(5),t.hij(" ",t.lcZ(37,67,"PercentageHandledByBots")," "),t.xp6(4),t.hij(" ",n.percentageOfRequestsHandledByBots,""),t.xp6(7),t.AsE(" ",t.lcZ(48,69,"Analytics.RequestChartTitle")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",365===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(63,71,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(68,73,"Analytics.Last")," 7 ",t.lcZ(69,75,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(72,77,"Analytics.Last")," 15 ",t.lcZ(73,79,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(76,81,"Analytics.Last")," 30 ",t.lcZ(77,83,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(80,85,"Analytics.Last")," 3 ",t.lcZ(81,87,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(84,89,"Analytics.Last")," 6 ",t.lcZ(85,91,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",365),t.xp6(1),t.AsE("",t.lcZ(88,93,"Analytics.Last")," 1 ",t.lcZ(89,95,"Analytics.Year"),""),t.xp6(7),t.hij(" ",t.lcZ(95,97,"HistoryPage.FilterByDepartment")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDeptId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(100,99,"HistoryPage.AllDepts")),t.xp6(2),t.Q6J("ngForOf",n.departments),t.xp6(5),t.hij(" ",t.lcZ(107,101,"Agent")," "),t.xp6(3),t.Q6J("ngModel",n.selectedAgentId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(112,103,"AllAgents")),t.xp6(2),t.Q6J("ngForOf",n.projectUserAndBotsArray),t.xp6(5),t.hij(" ",t.lcZ(119,105,"MessageChannel")," "),t.xp6(3),t.Q6J("ngModel",n.selectedChannelId)("clearable",!1),t.xp6(1),t.Q6J("ngForOf",n.conversationType))},dependencies:[E.sg,E.O5,v.w9,v.jq,I.JJ,I.On,E.JJ,L.X$],styles:['.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n  padding-top: 5px;\n}\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n.chart-wrapper-richieste[_ngcontent-%COMP%] {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  padding-left: 30px;\n  padding-right: 30px;\n  margin-left: -30px;\n  margin-right: -30px;\n  min-height: 345px;\n}\n.btn[_ngcontent-%COMP%] {\n  background-color: rgb(255, 255, 255);\n  margin-bottom: 1px;\n  margin-top: 1px;\n  height: 36px;\n  color: black;\n  text-transform: none !important;\n  padding: inherit;\n  width: 60px;\n}\n.chart-title-richieste[_ngcontent-%COMP%] {\n  padding: 12px 0px;\n  font-size: 18px;\n  display: inline-block;\n  vertical-align: middle;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.number-analytics[_ngcontent-%COMP%] {\n  font-size: 50px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-dept[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}\n.conv-analytics-left-card-title[_ngcontent-%COMP%] {\n  padding: 27px 10px 10px 10px;\n  font-size: 18px;\n  font-family: var(--header-font-family);\n}\n.conv-analytics-indicator-container[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  align-items: normal;\n  padding: 20px;\n}\n.conv-analytics-indicator-title-wpr[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: center;\n}\n.conv-analytics-indicator-title[_ngcontent-%COMP%] {\n  margin-top: 0px;\n  margin-bottom: 0px;\n  font-weight: 400;\n  font-size: 16px;\n  line-height: 20px;\n  letter-spacing: -0.01em;\n  font-family: var(--header-font-family);\n}\n.conv-analytics-indicator-value-wpr[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n  align-items: center;\n  min-height: 39px;\n}\n.conv-analytics-indicator-value[_ngcontent-%COMP%] {\n  margin-top: 6px;\n  margin-bottom: 0px;\n  font-weight: 600;\n  font-size: 40px;\n  line-height: 33px;\n  letter-spacing: -0.01em;\n  color: rgb(172, 184, 203);\n  font-family: Lato, Roboto, Helvetica, Arial, sans-serif;\n}\n.percentage-symbol[_ngcontent-%COMP%] {\n  font-size: 31px;\n}']}),a})();function Jt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function Ht(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function jt(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}function zt(a,l){if(1&a&&(t.TgZ(0,"ng-option",25),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e._id),t.xp6(1),t.Oqu(e.name)}}function Ft(a,l){if(1&a&&(t.TgZ(0,"ng-option",25),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function Wt(a,l){if(1&a&&(t.TgZ(0,"ng-option",25),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}let Kt=(()=>{class a{constructor(e,n,s,i,r,g,m){this.analyticsService=e,this.translate=n,this.departmentService=s,this.usersService=i,this.faqKbService=r,this.logger=g,this.auth=m,this.lastdays=7,this.langService=new N.b,this.humanizer=new N.f(this.langService),this.projectUserAndBotsArray=[],this.conversationType=[{id:"",name:"All"},...k.pD],this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - RESPONSETIMES] LANGUAGE ",this.lang),this.getBrowserLangAndSwitchMonthName()}ngOnInit(){this.selectedDeptId="",this.selectedDaysId=7,this.selectedAgentId="",this.selectedChannelId="",this.avarageWaitingTimeCLOCK(),this.avgTimeResponseCHART(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId),this.getDepartments(),this.getProjectUsersAndBots()}msToTIME(e){return Math.floor(e/36e5)+"h:"+Math.floor(e%36e5/6e4)+"m:"+Math.round(e%36e4%6e4/1e3)+"s"}msToTime(e){let n=Math.round(e/1e3%60),s=Math.floor(e/6e4%60),i=Math.floor(e/36e5%24);return s%2!=0?s+=1:s<59&&(i+=1),this.logger.log("[ANALYTICS - RESPONSETIMES] H:M->",i,s),(i<10?"0"+i:i)+":"+(s<10?"0"+s:s)+":"+(n<10?"0"+n:n)}stepSize(e){let n=Math.floor(e/36e5);return Math.floor(e%36e5/6e4),Math.round(e%36e4%6e4/1e3),0!=n?1e3*Math.floor(e/4/36e5)*60*60:1e3*Math.floor(e/4/6e4)*60}daysSelect(e){this.selectedDaysId=e,e<=30?this.lastdays=e:90===e||180===e?this.lastdays=e/30:360===e&&(this.lastdays=1),this.barChart.destroy(),this.subscription.unsubscribe(),this.avgTimeResponseCHART(e,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId),this.logger.log("[ANALYTICS - RESPONSETIMES] daysSelect REQUEST:",e,this.selectedDeptId,this.selectedAgentId)}depSelected(e){this.logger.log("[ANALYTICS - RESPONSETIMES] selectedDeptId",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.avgTimeResponseCHART(this.selectedDaysId,e,this.selectedAgentId,this.selectedChannelId),this.logger.log("[ANALYTICS - RESPONSETIMES] depSelected REQUEST:",this.selectedDaysId,e,this.selectedAgentId)}agentSelected(e){this.logger.log("[ANALYTICS - RESPONSETIMES] selectedAgentId: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.avgTimeResponseCHART(this.selectedDaysId,this.selectedDeptId,e,this.selectedChannelId),this.logger.log("[ANALYTICS - RESPONSETIMES] selectedAgentId REQUEST:",this.selectedDaysId,this.selectedDeptId,e)}conversationTypeSelected(e){this.logger.log("[ANALYTICS - CONVS]  Selected channel: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.avgTimeResponseCHART(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,e),this.logger.log("[ANALYTICS - RESPONSETIMES] selectedChannelId REQUEST:",this.selectedDaysId,this.selectedDeptId,this.selectedAgentId)}getDepartments(){this.departmentService.getDeptsByProjectId().subscribe(e=>{this.logger.log("[ANALYTICS - RESPONSETIMES] - GET DEPTS RESPONSE by analitycs ",e),this.departments=e},e=>{this.logger.error("[ANALYTICS - RESPONSETIMES] - GET DEPTS - ERROR: ",e)},()=>{this.logger.log("[ANALYTICS - RESPONSETIMES] - GET DEPTS * COMPLETE *")})}getProjectUsersAndBots(){const e=this.usersService.getProjectUsersByProjectId(),n=this.faqKbService.getAllBotByProjectId();(0,Q.$R)(e,n,(s,i)=>({_projectUsers:s,_bots:i})).subscribe(s=>{s&&s._projectUsers&&(this.projectUsersList=s._projectUsers,this.projectUsersList.forEach(i=>{this.projectUserAndBotsArray.push({id:i.id_user._id,name:i.id_user.firstname+" "+i.id_user.lastname})})),s&&s._bots&&(this.bots=s._bots.filter(i=>!1===i.trashed),this.bots.forEach(i=>{this.projectUserAndBotsArray.push({id:"bot_"+i._id,name:i.name+" (bot)"})}))},s=>{this.logger.error("[ANALYTICS - RESPONSETIMES] - GET P-USERS-&-BOTS - ERROR: ",s)},()=>{this.logger.log("[ANALYTICS - RESPONSETIMES] - GET P-USERS-&-BOTS - COMPLETE")})}getBrowserLangAndSwitchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}avarageWaitingTimeCLOCK(){this.subscription=this.analyticsService.getDataAVGWaitingCLOCK().subscribe(e=>{var n;if(e&&e.length>0)if(e[0].waiting_time_avg)if(null!==e[0].waiting_time_avg||void 0!==e[0].waiting_time_avg){n=this.humanizeDurations(e[0].waiting_time_avg).split(" "),this.unitAVGtime=n[1],this.numberAVGtime=this.msToTIME(e[0].waiting_time_avg);const s=this.translate.getBrowserLang();let i;this.auth.user_bs&&this.auth.user_bs.value&&(i=localStorage.getItem(this.auth.user_bs.value._id+"_lang"));let r="";s&&!i?r=s:s&&i&&(r=i),this.responseAVGtime=this.humanizer.humanize(e[0].waiting_time_avg,{round:!0,language:r}),this.logger.log("[ANALYTICS - RESPONSETIMES] Waiting time: humanize",this.humanizer.humanize(e[0].waiting_time_avg)),this.logger.log("[ANALYTICS - RESPONSETIMES] waiting time funtion:",this.humanizeDurations(e[0].waiting_time_avg))}else this.setToNa(),this.logger.log("[ANALYTICS - RESPONSETIMES] Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - RESPONSETIMES] waiting time funtion:",this.humanizeDurations(0));else this.setToNa();else this.setToNa(),this.logger.log("[ANALYTICS - RESPONSETIMES] Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - RESPONSETIMES] waiting time funtion:",this.humanizeDurations(0))},e=>{this.logger.error("[ANALYTICS - RESPONSETIMES] - AVERAGE WAITING TIME CLOCK REQUEST  - ERROR ",e),this.setToNa()},()=>{this.logger.log("[ANALYTICS - RESPONSETIMES] - AVERAGE TIME CLOCK REQUEST * COMPLETE *")})}setToNa(){this.numberAVGtime="0",this.unitAVGtime="",this.responseAVGtime="0"}avgTimeResponseCHART(e,n,s,i){this.subscription=this.analyticsService.getavarageWaitingTimeDataCHART(e,n,s,i).subscribe(r=>{if(r){const S=[];for(let u=0;u<e;u++)S.push({date:o()().subtract(u,"d").format("D/M/YYYY"),value:0});S.reverse();const _=[];for(let u in r)null==r[u].waiting_time_avg&&(r[u].waiting_time_avg=0),_.push({date:r[u]._id.day+"/"+r[u]._id.month+"/"+r[u]._id.year,value:r[u].waiting_time_avg});const h=S.map(u=>_.find(y=>y.date===u.date)||u);this.logger.log("[ANALYTICS - RESPONSETIMES] - RESPONSE TIME REQUESTS BY DAY - FINAL ARRAY ",h);const c=[],p=[];this.initDay=h[0].date,this.endDay=h[e-1].date,this.logger.log("[ANALYTICS - RESPONSETIMES] INIT",this.initDay,"END",this.endDay),h.forEach(u=>{this.logger.log("[ANALYTICS - RESPONSETIMES] - RESPONSE TIME REQUESTS BY DAY - requestByDay",u),c.push(u.value);const y=u.date.split("/");this.logger.log("[ANALYTICS - RESPONSETIMES] - RESPONSE TIME REQUESTS BY DAY - SPLITTED DATE",y),p.push(y[0]+" "+this.monthNames[y[1]])}),this.xValueAVGchart=p,this.yValueAVGchart=c,this.logger.log("[ANALYTICS - RESPONSETIMES] Xlabel-RESPONSE TIME",this.xValueAVGchart),this.logger.log("[ANALYTICS - RESPONSETIMES] Ylabel-RESPONSE TIME",this.yValueAVGchart);const d=this.getMaxOfArray(this.yValueAVGchart);this.logger.log("[ANALYTICS - RESPONSETIMES] - RESPONSE TIME REQUESTS BY DAY - HIGHER COUNT ",d),this.msToTime(d);var m=Math.floor(d/4/36e5);this.logger.log("[ANALYTICS - RESPONSETIMES] step absoluteHours",m),this.barChart=new D.Chart("avgTimeResponse",{type:"bar",data:{labels:this.xValueAVGchart,datasets:[{label:"Average time response in last 30 days ",data:this.yValueAVGchart,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0}]},options:{maintainAspectRatio:!1,title:{text:"AVERAGE TIME RESPONSE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:this.selectedDaysId>60?10:this.selectedDaysId,display:!0,minRotation:0,fontColor:"black"},gridLines:{display:!1,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,stepSize:this.stepSize(d),fontColor:"black",callback:function(u,y,R){let O=Math.floor(u/36e5),V=Math.floor(u%36e5/6e4),A=Math.round(u%36e4%6e4/1e3);return(O<10?"0"+O:O)+"h:"+(V<10?"0"+V:V)+"m:"+(A<10?"0"+A:A)+"s"}}}]},tooltips:{callbacks:{label:(u,y)=>{const R=u.yLabel;let O=new N.b,V=new N.f(O);const A=this.translate.getBrowserLang();let b;this.auth.user_bs&&this.auth.user_bs.value&&(b=localStorage.getItem(this.auth.user_bs.value._id+"_lang"));let Y="";return A&&!b?Y=A:A&&b&&(Y=b),this.translate.instant("AverageResponseTime")+": "+V.humanize(R,{round:!0,language:Y,units:["y","mo","w","d","h","m","s"]})}}}},plugins:[{beforeDraw:function(u,y){u.chart.ctx.font="Roboto"}}]})}},r=>{this.logger.error("[ANALYTICS - RESPONSETIMES] - RESPONSE TIME REQUESTS BY DAY - ERROR ",r)},()=>{this.logger.log("[ANALYTICS - RESPONSETIMES] - RESPONSE TIME REQUESTS BY DAY * COMPLETE *")})}humanizeDurations(e){let n;if(e)return"en"==this.lang?(n=Math.round(e/31104e6))>0?n=1===n?n+" Year":n+" Years":(n=Math.round(e/2592e6))>0?n=1===n?n+" Month":n+" Months":(n=Math.round(e/864e5))>0?n=1===n?n+" Day":n+" Days":(n=Math.round(e/36e5))>0?n+=" Hours":n=(n=Math.round(e/6e4))>0?1===n?n+" Minute":n+" Minutes":(n=Math.round(e/1e3))>0?1===n?n+" Second":n+" Seconds":e+" Millisec":n=(n=Math.round(e/31104e6))>0?1===n?n+" Anno":n+" Anni":(n=Math.round(e/2592e6))>0?1===n?n+" Mese":n+" Mesi":(n=Math.round(e/864e5))>0?1===n?n+" Giorno":n+" Giorni":(n=Math.round(e/36e5))>0?1===n?n+" Ora":n+" Ore":(n=Math.round(e/6e4))>0?1===n?n+" Minuto":n+" Minuti":(n=Math.round(e/1e3))>0?1===n?n+" Secondo":n+" Secondi":e+" Millisecondi",n}getMaxOfArray(e){return Math.max.apply(null,e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(M.y),t.Y36(L.sK),t.Y36(B.n),t.Y36(P.f),t.Y36(w.M),t.Y36(x.m),t.Y36(q.e))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-responsetimes"]],decls:102,vars:93,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-md-3"],[1,"card",2,"border-radius","10px","min-height","445px"],[2,"padding-bottom","28px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content","clock"],[1,"avg-time-in-clock"],[1,"card-footer","request_count_footer",2,"font-size","16px","margin-top","9px","padding-top","21px","padding-bottom","19px"],[2,"display","block"],[1,"col-md-9"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","18px","display","block","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[4,"ngIf"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","23px","padding-right","12px"],[1,"col-sm-3"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],["name","dept",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["name","agent",1,"custom",3,"ngModel","clearable","ngModelChange","change"],["name","conversation-type",1,"custom","ng-select-conversation-type",3,"ngModel","clearable","ngModelChange","change"],[1,"card-content","chart-container",2,"position","relative","margin","auto","min-height","260px"],["id","avgTimeResponse"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"p",8),t._uU(13),t.qZA()(),t.TgZ(14,"div",9),t._uU(15),t.ALo(16,"translate"),t.TgZ(17,"span",10)(18,"b"),t._uU(19),t.qZA()()()()(),t.TgZ(20,"div",11)(21,"div",12)(22,"div",13)(23,"span",14),t._uU(24),t.ALo(25,"translate"),t.YNc(26,Jt,3,3,"span",15),t.YNc(27,Ht,3,3,"span",15),t.YNc(28,jt,3,3,"span",15),t.TgZ(29,"span",16),t._uU(30),t.TgZ(31,"i",17),t._uU(32," arrow_forward "),t.qZA(),t._uU(33),t.qZA()(),t.TgZ(34,"div",18)(35,"div",19)(36,"div",20)(37,"div",21)(38,"label",22),t._uU(39),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"div",23)(42,"ng-select",24),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(){return n.daysSelect(n.selectedDaysId)}),t.TgZ(43,"ng-option",25),t._uU(44),t.ALo(45,"translate"),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ng-option",25),t._uU(48),t.ALo(49,"translate"),t.ALo(50,"translate"),t.qZA(),t.TgZ(51,"ng-option",25),t._uU(52),t.ALo(53,"translate"),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"ng-option",25),t._uU(56),t.ALo(57,"translate"),t.ALo(58,"translate"),t.qZA(),t.TgZ(59,"ng-option",25),t._uU(60),t.ALo(61,"translate"),t.ALo(62,"translate"),t.qZA(),t.TgZ(63,"ng-option",25),t._uU(64),t.ALo(65,"translate"),t.ALo(66,"translate"),t.qZA()()()()()(),t.TgZ(67,"div",19)(68,"div",20)(69,"div",21)(70,"label",22),t._uU(71),t.ALo(72,"translate"),t.qZA(),t.TgZ(73,"div",23)(74,"ng-select",26),t.NdJ("ngModelChange",function(i){return n.selectedDeptId=i})("change",function(){return n.depSelected(n.selectedDeptId)}),t.TgZ(75,"ng-option",25),t._uU(76),t.ALo(77,"translate"),t.qZA(),t.YNc(78,zt,2,2,"ng-option",27),t.qZA()()()()(),t.TgZ(79,"div",19)(80,"div",20)(81,"div",21)(82,"label",22),t._uU(83),t.ALo(84,"translate"),t.qZA(),t.TgZ(85,"div",23)(86,"ng-select",28),t.NdJ("ngModelChange",function(i){return n.selectedAgentId=i})("change",function(){return n.agentSelected(n.selectedAgentId)}),t.TgZ(87,"ng-option",25),t._uU(88),t.ALo(89,"translate"),t.qZA(),t.YNc(90,Ft,2,2,"ng-option",27),t.qZA()()()()(),t.TgZ(91,"div",19)(92,"div",20)(93,"div",21)(94,"label",22),t._uU(95),t.ALo(96,"translate"),t.qZA(),t.TgZ(97,"div",23)(98,"ng-select",29),t.NdJ("ngModelChange",function(i){return n.selectedChannelId=i})("change",function(){return n.conversationTypeSelected(n.selectedChannelId)}),t.YNc(99,Wt,2,2,"ng-option",27),t.qZA()()()()()()(),t.TgZ(100,"div",30),t._UZ(101,"canvas",31),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,49,"Analytics.AvgTimeTitle")," "),t.xp6(6),t.hij(" ",t.lcZ(10,51,"Analytics.MedianResTimeClock")," "),t.xp6(4),t.Oqu(n.numberAVGtime),t.xp6(2),t.hij(" ",t.lcZ(16,53,"Analytics.ResponseAVGtime")," "),t.xp6(4),t.Oqu(n.responseAVGtime),t.xp6(5),t.AsE(" ",t.lcZ(25,55,"Analytics.DailyMedianResponseTime")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(40,57,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(45,59,"Analytics.Last")," 7 ",t.lcZ(46,61,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(49,63,"Analytics.Last")," 15 ",t.lcZ(50,65,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(53,67,"Analytics.Last")," 30 ",t.lcZ(54,69,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(57,71,"Analytics.Last")," 3 ",t.lcZ(58,73,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(61,75,"Analytics.Last")," 6 ",t.lcZ(62,77,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(65,79,"Analytics.Last")," 1 ",t.lcZ(66,81,"Analytics.Year"),""),t.xp6(7),t.hij(" ",t.lcZ(72,83,"HistoryPage.FilterByDepartment")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDeptId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(77,85,"HistoryPage.AllDepts")),t.xp6(2),t.Q6J("ngForOf",n.departments),t.xp6(5),t.hij(" ",t.lcZ(84,87,"Agent")," "),t.xp6(3),t.Q6J("ngModel",n.selectedAgentId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(89,89,"HistoryPage.AllAgents")),t.xp6(2),t.Q6J("ngForOf",n.projectUserAndBotsArray),t.xp6(5),t.hij(" ",t.lcZ(96,91,"MessageChannel")," "),t.xp6(3),t.Q6J("ngModel",n.selectedChannelId)("clearable",!1),t.xp6(1),t.Q6J("ngForOf",n.conversationType))},dependencies:[E.sg,E.O5,v.w9,v.jq,I.JJ,I.On,L.X$],styles:['.card-header-custom[_ngcontent-%COMP%] {\n  box-shadow: none !important;\n  margin-left: 0px !important;\n  margin-right: 0px !important;\n  border-bottom: 1px solid #eff3f5 !important;\n}\n\n.request_count_footer[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  color: rgba(0, 0, 0, 0.54);\n  text-align: center;\n}\n\n.chart-wrapper[_ngcontent-%COMP%] {\n  background-color: #ffffff;\n  padding-top: 15px;\n  padding-bottom: 15px;\n  padding-left: 30px;\n  padding-right: 30px;\n  margin-left: -30px;\n  margin-right: -30px;\n  min-height: 345px;\n}\n\n.chart-title[_ngcontent-%COMP%] {\n  padding-bottom: 24px;\n  padding-top: 24px;\n  font-size: 18px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.clock[_ngcontent-%COMP%] {\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 200px;\n  width: 200px;\n  margin: auto;\n}\n\n.avg-time-in-clock[_ngcontent-%COMP%] {\n  font-size: 16px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-dept[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}']}),a})();var $t=f(8929),Xt=f(7625);function te(a,l){if(1&a&&(t.TgZ(0,"div",31),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"span",32)(4,"b"),t._uU(5),t.qZA()()()),2&a){const e=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,2,"Analytics.Satisfaction.StatisfactionValueLabel")," "),t.xp6(4),t.hij(" ",e.avgSatisfaction," ")}}function ee(a,l){1&a&&(t.TgZ(0,"div",31),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"span",32),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Analytics.Satisfaction.NoSatisfactionValue")," "))}function ne(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function se(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function ae(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}function ie(a,l){if(1&a&&(t.TgZ(0,"ng-option",24),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.Q6J("value",e._id),t.xp6(1),t.Oqu(e.name)}}function oe(a,l){if(1&a&&(t.TgZ(0,"ng-option",24),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}function re(a,l){if(1&a&&(t.TgZ(0,"ng-option",24),t._uU(1),t.qZA()),2&a){const e=l.$implicit;t.s9C("value",e.id),t.xp6(1),t.Oqu(e.name)}}let le=(()=>{class a{constructor(e,n,s,i,r,g){this.translate=e,this.analyticsService=n,this.departmentService=s,this.usersService=i,this.faqKbService=r,this.logger=g,this.unsubscribe$=new $t.xQ,this.lastdays=7,this.projectUserAndBotsArray=[],this.conversationType=[{id:"",name:"All"},...k.pD],this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - SATISFACTION] LANGUAGE ",this.lang),this.switchMonthName()}ngOnInit(){this.selectedDaysId=7,this.selectedDeptId="",this.selected="day",this.selectedAgentId="",this.selectedChannelId="",this.initDay=o()().subtract(6,"d").format("D/M/YYYY"),this.endDay=o()().subtract(0,"d").format("D/M/YYYY"),this.logger.log("[ANALYTICS - SATISFACTION] INIT",this.initDay,"END",this.endDay),this.getDepartments(),this.getProjectUsersAndBots(),this.getAvgSatisfaction(),this.getSatisfactionByLastNDays(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId)}ngOnDestroy(){this.logger.log("[ANALYTICS - SATISFACTION] - !!!!! UN - SUBSCRIPTION TO REQUESTS"),this.subscription.unsubscribe(),this.unsubscribe$.next(),this.unsubscribe$.complete()}switchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}daysSelect(e,n){this.logger.log("[ANALYTICS - SATISFACTION] daysSelect EVENT: ",n),this.selectedDaysId=e,e<=30?this.lastdays=e:90==e||180==e?this.lastdays=e/30:360==e&&(this.lastdays=1),this.barChart.destroy(),this.subscription.unsubscribe(),this.getSatisfactionByLastNDays(e,this.selectedDeptId,this.selectedAgentId,this.selectedChannelId)}depSelected(e){this.logger.log("[ANALYTICS - SATISFACTION] Department selected: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.getSatisfactionByLastNDays(this.selectedDaysId,e,this.selectedAgentId,this.selectedChannelId)}agentSelected(e){this.logger.log("[ANALYTICS - SATISFACTION] Selected agent: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.getSatisfactionByLastNDays(this.selectedDaysId,this.selectedDeptId,e,this.selectedChannelId),this.logger.log("[ANALYTICS - SATISFACTION] agentSelected REQUEST:",this.selectedDaysId,this.selectedDeptId,e)}conversationTypeSelected(e){this.logger.log("[ANALYTICS - CONVS]  Selected channel: ",e),this.barChart.destroy(),this.subscription.unsubscribe(),this.getSatisfactionByLastNDays(this.selectedDaysId,this.selectedDeptId,this.selectedAgentId,e),this.logger.log("[ANALYTICS - SATISFACTION] selectedChannelId REQUEST:",this.selectedDaysId,this.selectedDeptId,this.selectedAgentId)}getDepartments(){this.departmentService.getDeptsByProjectId().pipe((0,Xt.R)(this.unsubscribe$)).subscribe(e=>{this.logger.log("[ANALYTICS - SATISFACTION] - GET DEPTS RESPONSE by analitycs ",e),this.departments=e},e=>{this.logger.error("[ANALYTICS - SATISFACTION] - GET DEPTS - ERROR: ",e)},()=>{this.logger.log("[ANALYTICS - SATISFACTION] - GET DEPTS * COMPLETE *")})}getProjectUsersAndBots(){const e=this.usersService.getProjectUsersByProjectId(),n=this.faqKbService.getAllBotByProjectId();(0,Q.$R)(e,n,(s,i)=>({_projectUsers:s,_bots:i})).subscribe(s=>{this.logger.log("[ANALYTICS - SATISFACTION] - GET P-USERS-&-BOTS - PROJECT USERS : ",s._projectUsers),this.logger.log("[ANALYTICS - SATISFACTION] - GET P-USERS-&-BOTS - BOTS: ",s._bots),s&&s._projectUsers&&(this.projectUsersList=s._projectUsers,this.projectUsersList.forEach(i=>{this.projectUserAndBotsArray.push({id:i.id_user._id,name:i.id_user.firstname+" "+i.id_user.lastname})})),s&&s._bots&&(this.bots=s._bots.filter(i=>!1===i.trashed),this.bots.forEach(i=>{this.projectUserAndBotsArray.push({id:"bot_"+i._id,name:i.name+" (bot)"})})),this.logger.log("[ANALYTICS - SATISFACTION] - GET P-USERS-&-BOTS - PROJECT-USER & BOTS ARRAY : ",this.projectUserAndBotsArray)},s=>{this.logger.error("[ANALYTICS - SATISFACTION] - GET P-USERS-&-BOTS - ERROR: ",s)},()=>{this.logger.log("[ANALYTICS - SATISFACTION]- GET P-USERS-&-BOTS - COMPLETE")})}getAvgSatisfaction(){this.analyticsService.getAvgSatisfaction().then(e=>{this.logger.log("[ANALYTICS - SATISFACTION] !!! AVG Satisfaction: ",e);const s=(e[0].satisfaction_avg%1==0?e[0].satisfaction_avg.toString():e[0].satisfaction_avg.toFixed(2)).replace(".",",");this.avgSatisfaction=s}).catch(e=>{this.logger.error("[ANALYTICS - SATISFACTION] Error during getAvgSatisfaction: ",e),this.avgSatisfaction=0})}getSatisfactionByLastNDays(e,n,s,i){this.subscription=this.analyticsService.getSatisfactionByDay(e,n,s,i).subscribe(r=>{this.logger.log("[ANALYTICS - SATISFACTION] \xbb\xbb SATISFACTION BY DAY RESULT: ",r);const g=[],m=[];if(r){const h=[];for(let d=0;d<e;d++)h.push({date:o()().subtract(d,"d").format("D/M/YYYY"),value:0});h.reverse(),this.logger.log("[ANALYTICS - SATISFACTION] - REQUESTS SATISFACTION BY DAY - (init array)",h);const c=[];for(let d in r)this.logger.log("[ANALYTICS - SATISFACTION] ****** satisfaction: ",r[d]),null==r[d].satisfaction_avg&&(r[d].satisfaction_avg=0),c.push({date:r[d]._id.day+"/"+r[d]._id.month+"/"+r[d]._id.year,value:r[d].satisfaction_avg});this.logger.log("[ANALYTICS - SATISFACTION] Satisfaction data:",c);const p=h.map(d=>c.find(C=>C.date===d.date)||d);this.logger.log("[ANALYTICS - SATISFACTION] - REQUESTS SATISFACTION BY DAY - FINAL ARRAY ",p),this.initDay=p[0].date,this.endDay=p[e-1].date,this.logger.log("[ANALYTICS - SATISFACTION] INIT",this.initDay,"END",this.endDay),p.forEach(d=>{g.push(d.value);const C=d.date.split("/");m.push(C[0]+" "+this.monthNames[C[1]])}),this.xValueSatisfaction=m,this.yValueSatisfaction=g,this.logger.log("[ANALYTICS - SATISFACTION] Xlabel-Satisfaction",this.xValueSatisfaction),this.logger.log("[ANALYTICS - SATISFACTION] Ylabel-Satisfaction",this.yValueSatisfaction)}else this.logger.error("[ANALYTICS - SATISFACTION] !!!ERROR!!! while get data from resouces for requests satisfaction graph");let T;T=this.selectedDaysId>60?10:this.selectedDaysId,this.getMaxOfArray(g),this.barChart=new D.Chart("satisfactionRating",{type:"bar",data:{labels:m,datasets:[{label:"Daily satisfaction: ",data:g,fill:!1,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0}]},options:{maintainAspectRatio:!1,title:{text:"DURATION CONVERSATION LENGHT RESPONSE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:T,display:!0,minRotation:0,fontColor:"black"},gridLines:{display:!1,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(h,c,p){if(Math.floor(h)===h)return h},display:!0,fontColor:"black",suggestedMax:5,stepSize:1}}]},tooltips:{callbacks:{label:(h,c)=>{const p=h.yLabel;return this.translate.instant("DailyAverage")+": "+p}}}}})})}getMaxOfArray(e){return Math.max.apply(null,e)}stepSize(e){const n=Math.floor(e/36e5);return Math.floor(e%36e5/6e4),Math.round(e%36e4%6e4/1e3),0!==n?1e3*Math.floor(e/4/36e5)*60*60:1e3*Math.floor(e/4/6e4)*60}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(L.sK),t.Y36(M.y),t.Y36(B.n),t.Y36(P.f),t.Y36(w.M),t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-satisfaction"]],decls:98,vars:91,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-md-3"],[1,"card",2,"border-radius","10px","min-height","440px"],[2,"padding-bottom","28px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content","star"],[1,"number-stars"],["class","card-footer request_count_footer","style","font-size: 16px; margin-top: 9px; padding-top: 21px;  padding-bottom: 19px;",4,"ngIf"],[1,"col-md-9"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","18px","display","block","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[4,"ngIf"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","23px","padding-right","12px"],[1,"col-sm-3"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],["name","dept",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],["name","agent",1,"custom",3,"ngModel","clearable","ngModelChange","change"],["name","conversation-type",1,"custom","ng-select-conversation-type",3,"ngModel","clearable","ngModelChange","change"],[1,"card-content","chart-container",2,"position","relative","margin","auto","min-height","260px"],["id","satisfactionRating"],[1,"card-footer","request_count_footer",2,"font-size","16px","margin-top","9px","padding-top","21px","padding-bottom","19px"],[2,"display","block"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"p",8),t._uU(13),t.qZA()(),t.YNc(14,te,6,4,"div",9),t.YNc(15,ee,4,3,"div",9),t.qZA()(),t.TgZ(16,"div",10)(17,"div",11)(18,"div",12)(19,"span",13),t._uU(20),t.ALo(21,"translate"),t.YNc(22,ne,3,3,"span",14),t.YNc(23,se,3,3,"span",14),t.YNc(24,ae,3,3,"span",14),t.TgZ(25,"span",15),t._uU(26),t.TgZ(27,"i",16),t._uU(28," arrow_forward "),t.qZA(),t._uU(29),t.qZA()(),t.TgZ(30,"div",17)(31,"div",18)(32,"div",19)(33,"div",20)(34,"label",21),t._uU(35),t.ALo(36,"translate"),t.qZA(),t.TgZ(37,"div",22)(38,"ng-select",23),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(i){return n.daysSelect(n.selectedDaysId,i)}),t.TgZ(39,"ng-option",24),t._uU(40),t.ALo(41,"translate"),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ng-option",24),t._uU(44),t.ALo(45,"translate"),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ng-option",24),t._uU(48),t.ALo(49,"translate"),t.ALo(50,"translate"),t.qZA(),t.TgZ(51,"ng-option",24),t._uU(52),t.ALo(53,"translate"),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"ng-option",24),t._uU(56),t.ALo(57,"translate"),t.ALo(58,"translate"),t.qZA(),t.TgZ(59,"ng-option",24),t._uU(60),t.ALo(61,"translate"),t.ALo(62,"translate"),t.qZA()()()()()(),t.TgZ(63,"div",18)(64,"div",19)(65,"div",20)(66,"label",21),t._uU(67),t.ALo(68,"translate"),t.qZA(),t.TgZ(69,"div",22)(70,"ng-select",25),t.NdJ("ngModelChange",function(i){return n.selectedDeptId=i})("change",function(){return n.depSelected(n.selectedDeptId)}),t.TgZ(71,"ng-option",24),t._uU(72),t.ALo(73,"translate"),t.qZA(),t.YNc(74,ie,2,2,"ng-option",26),t.qZA()()()()(),t.TgZ(75,"div",18)(76,"div",19)(77,"div",20)(78,"label",21),t._uU(79),t.ALo(80,"translate"),t.qZA(),t.TgZ(81,"div",22)(82,"ng-select",27),t.NdJ("ngModelChange",function(i){return n.selectedAgentId=i})("change",function(){return n.agentSelected(n.selectedAgentId)}),t.TgZ(83,"ng-option",24),t._uU(84),t.ALo(85,"translate"),t.qZA(),t.YNc(86,oe,2,2,"ng-option",26),t.qZA()()()()(),t.TgZ(87,"div",18)(88,"div",19)(89,"div",20)(90,"label",21),t._uU(91),t.ALo(92,"translate"),t.qZA(),t.TgZ(93,"div",22)(94,"ng-select",28),t.NdJ("ngModelChange",function(i){return n.selectedChannelId=i})("change",function(){return n.conversationTypeSelected(n.selectedChannelId)}),t.YNc(95,re,2,2,"ng-option",26),t.qZA()()()()()(),t.TgZ(96,"div",29),t._UZ(97,"canvas",30),t.qZA()()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,49,"Analytics.SatisfactionComponentTitle")," "),t.xp6(6),t.hij(" ",t.lcZ(10,51,"Analytics.Satisfaction.SatisfactionStar")," "),t.xp6(4),t.hij(" ",n.avgSatisfaction," "),t.xp6(1),t.Q6J("ngIf",null!=n.avgSatisfaction),t.xp6(1),t.Q6J("ngIf",null==n.avgSatisfaction),t.xp6(5),t.AsE(" ",t.lcZ(21,53,"Analytics.Satisfaction.DailySatisfactionTrend")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(36,55,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(41,57,"Analytics.Last")," 7 ",t.lcZ(42,59,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(45,61,"Analytics.Last")," 15 ",t.lcZ(46,63,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(49,65,"Analytics.Last")," 30 ",t.lcZ(50,67,"Analytics.Days"),""),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(53,69,"Analytics.Last")," 3 ",t.lcZ(54,71,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(57,73,"Analytics.Last")," 6 ",t.lcZ(58,75,"Analytics.Months"),""),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(61,77,"Analytics.Last")," 1 ",t.lcZ(62,79,"Analytics.Year"),""),t.xp6(7),t.hij(" ",t.lcZ(68,81,"HistoryPage.FilterByDepartment")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDeptId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(73,83,"HistoryPage.AllDepts")),t.xp6(2),t.Q6J("ngForOf",n.departments),t.xp6(5),t.hij(" ",t.lcZ(80,85,"Agent")," "),t.xp6(3),t.Q6J("ngModel",n.selectedAgentId)("clearable",!1),t.xp6(1),t.Q6J("value",""),t.xp6(1),t.Oqu(t.lcZ(85,87,"HistoryPage.AllAgents")),t.xp6(2),t.Q6J("ngForOf",n.projectUserAndBotsArray),t.xp6(5),t.hij(" ",t.lcZ(92,89,"MessageChannel")," "),t.xp6(3),t.Q6J("ngModel",n.selectedChannelId)("clearable",!1),t.xp6(1),t.Q6J("ngForOf",n.conversationType))},dependencies:[E.sg,E.O5,v.w9,v.jq,I.JJ,I.On,L.X$],styles:['.star[_ngcontent-%COMP%] {\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  color: #073f74;\n  height: 200;\n  width: 200;\n  margin: auto;\n}\n\n.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n}\n\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n\n.chart-title[_ngcontent-%COMP%] {\n  padding-bottom: 24px;\n  padding-top: 24px;\n  font-size: 18px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.chart-wrapper[_ngcontent-%COMP%] {\n  background-color: #ffffff;\n  padding-top: 15px;\n  padding-bottom: 15px;\n  padding-left: 30px;\n  padding-right: 30px;\n  margin-left: -30px;\n  margin-right: -30px;\n  min-height: 345px;\n}\n\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.number-stars[_ngcontent-%COMP%] {\n  font-size: 16px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-weight: 400;\n}\n\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-dept[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}']}),a})();function ge(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Days")))}function ce(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Months")))}function de(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Analytics.Year")))}let he=(()=>{class a{constructor(e,n,s){this.translate=e,this.analyticsService=n,this.logger=s,this.xlabel_ita=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],this.xlabel_eng=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],this.ylabel_ita=["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"],this.ylabel_eng=["1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12am","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm","12pm"],this.lastdays=7,this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - VISITORS] LANGUAGE ",this.lang),this.switchMonthName()}ngOnInit(){this.selected="day",this.selectedDeptId="",this.selectedDaysId=7,this.initDay=o()().subtract(6,"d").format("D/M/YYYY"),this.endDay=o()().subtract(0,"d").format("D/M/YYYY"),this.logger.log("[ANALYTICS - VISITORS] INIT",this.initDay,"END",this.endDay),this.getAggregateValue(),this.getVisitorsByLastNDays(this.selectedDaysId)}ngOnDestroy(){this.logger.log("[ANALYTICS - VISITORS] - !!!!! UN - SUBSCRIPTION TO REQUESTS"),this.subscription.unsubscribe()}daysSelect(e,n){this.logger.log("[ANALYTICS - VISITORS] daysSelect EVENT: ",n),this.selectedDaysId=e,e<=30?this.lastdays=e:90==e||180==e?this.lastdays=e/30:360==e&&(this.lastdays=1),this.lineChart.destroy(),this.subscription.unsubscribe(),this.getVisitorsByLastNDays(e)}getAggregateValue(){this.analyticsService.getVisitors().subscribe(e=>{this.logger.log("[ANALYTICS - VISITORS] LAST MONTH VISITORS COUNT: ",e),e&&e[0]?(this.visitorsCountLastMonth=e[0].totalCount,this.logger.log("[ANALYTICS - VISITORS] Visitors Count: ",this.visitorsCountLastMonth)):(this.logger.log("[ANALYTICS - VISITORS] THERE ARE NOT VISITORS IN THE LAST MONTH "),this.visitorsCountLastMonth=0)},e=>{this.logger.error("[ANALYTICS - VISITORS] Impossible to retrieve monthly count",e),this.visitorsCountLastMonth=0})}getVisitorsByLastNDays(e){this.subscription=this.analyticsService.getVisitorsByDay(e).subscribe(n=>{this.logger.log("[ANALYTICS - VISITORS] \xbb\xbb VISITORS BY DAY RESULT: ",n);const s=[];for(let h=0;h<e;h++)s.push({count:0,day:o()().subtract(h,"d").format("D/M/YYYY")});s.reverse(),this.logger.log("[ANALYTICS - VISITORS] \xbb\xbb LAST 7 DAYS VISITORS - INIT ARRAY: ",s);const i=[],r=[],g=[];for(let h=0;h<n.length;h++)n[h]&&g.push({count:n[h].count,day:n[h]._id.day+"/"+n[h]._id.month+"/"+n[h]._id.year});const m=s.map(h=>g.find(c=>c.day===h.day)||h);this.initDay=m[0].day,this.endDay=m[e-1].day,this.logger.log("[ANALYTICS - VISITORS] INIT",this.initDay,"END",this.endDay),m.forEach(h=>{i.push(h.count);const c=h.day.split("/");r.push(c[0]+" "+this.monthNames[c[1]])}),this.logger.log("[ANALYTICS - VISITORS] \xbb\xbb VISITORS BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",i),this.logger.log("[ANALYTICS - VISITORS] \xbb\xbb VISITORS BY DAY - LABELS (+ NEW + ARRAY OF DAY)",r);const T=this.getMaxOfArray(i);this.lineChart=new D.Chart("lastNdayVisitors",{type:"line",data:{labels:r,datasets:[{label:"Number of visitors in last 7 days ",data:i,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"TITLE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,maxTicksLimit:this.selectedDaysId>60?10:this.selectedDaysId,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(h,c,p){if(Math.floor(h)===h)return h},display:!0,fontColor:"black",suggestedMax:T+2}}]},tooltips:{callbacks:{label:(h,c)=>{const p=h.yLabel;return this.translate.instant("Visitors")+":"+p}}}},plugins:[{beforeDraw:function(h,c){var p=h.chart.ctx;p.height=128,p.font="Roboto"}}]})},n=>{this.logger.error("[ANALYTICS - VISITORS] \xbb\xbb VISITORS BY DAY - ERROR ",n)},()=>{this.logger.log("[ANALYTICS - VISITORS] \xbb\xbb VISITORS BY DAY - * COMPLETE * ")})}switchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}getMaxOfArray(e){return Math.max.apply(null,e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(L.sK),t.Y36(M.y),t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-visitors-analytics"]],decls:63,vars:63,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-md-3"],[1,"card",2,"border-radius","10px","min-height","424px"],[2,"padding-bottom","28px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content"],[1,"number-analytics"],[1,"col-md-9"],[1,"card",2,"border-radius","10px"],[2,"padding-top","27px","padding-bottom","10px"],[2,"padding-bottom","12px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[4,"ngIf"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"row",2,"padding-left","52px","padding-right","38px"],[1,"col-sm-4"],[1,"section-select-dept"],[1,"row"],[1,"col-sm-12",2,"text-align","left","color","black"],[1,"col-sm-12",2,"margin-bottom","6px","text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","ngModelChange","change"],[3,"value"],[1,"card-content","chart-container",2,"position","relative","margin","12px 12px","height","35vh"],["id","lastNdayVisitors"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"p",8),t._uU(13),t.qZA()()()(),t.TgZ(14,"div",9)(15,"div",10)(16,"div",11)(17,"span",12),t._uU(18),t.ALo(19,"translate"),t.YNc(20,ge,3,3,"span",13),t.YNc(21,ce,3,3,"span",13),t.YNc(22,de,3,3,"span",13),t.TgZ(23,"span",14),t._uU(24),t.TgZ(25,"i",15),t._uU(26," arrow_forward "),t.qZA(),t._uU(27),t.qZA()()(),t.TgZ(28,"div",16)(29,"div",17)(30,"div",18)(31,"div",19)(32,"label",20),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"div",21)(36,"ng-select",22),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(i){return n.daysSelect(n.selectedDaysId,i)}),t.TgZ(37,"ng-option",23),t._uU(38),t.ALo(39,"translate"),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"ng-option",23),t._uU(42),t.ALo(43,"translate"),t.ALo(44,"translate"),t.qZA(),t.TgZ(45,"ng-option",23),t._uU(46),t.ALo(47,"translate"),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"ng-option",23),t._uU(50),t.ALo(51,"translate"),t.ALo(52,"translate"),t.qZA(),t.TgZ(53,"ng-option",23),t._uU(54),t.ALo(55,"translate"),t.ALo(56,"translate"),t.qZA(),t.TgZ(57,"ng-option",23),t._uU(58),t.ALo(59,"translate"),t.ALo(60,"translate"),t.qZA()()()()()()(),t.TgZ(61,"div",24),t._UZ(62,"canvas",25),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,31,"Analytics.Visitors.NumberOfVisitors")," "),t.xp6(6),t.hij(" ",t.lcZ(10,33,"Last30DaysVisitors")," "),t.xp6(4),t.Oqu(n.visitorsCountLastMonth),t.xp6(5),t.AsE(" ",t.lcZ(19,35,"Analytics.Visitors.VisitorsChartTitle")," ",n.lastdays," "),t.xp6(2),t.Q6J("ngIf",n.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===n.selectedDaysId||180===n.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===n.selectedDaysId),t.xp6(2),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay,""),t.xp6(6),t.hij(" ",t.lcZ(34,37,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(39,39,"Analytics.Last")," 7 ",t.lcZ(40,41,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(43,43,"Analytics.Last")," 15 ",t.lcZ(44,45,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(47,47,"Analytics.Last")," 30 ",t.lcZ(48,49,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(51,51,"Analytics.Last")," 3 ",t.lcZ(52,53,"Analytics.Months")," "),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(55,55,"Analytics.Last")," 6 ",t.lcZ(56,57,"Analytics.Months")," "),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(59,59,"Analytics.Last")," 1 ",t.lcZ(60,61,"Analytics.Year")," "))},dependencies:[E.O5,v.w9,v.jq,I.JJ,I.On,L.X$],styles:['.boxdays[_ngcontent-%COMP%] {\n  height: 33px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 100%;\n  display: inline-block;\n  vertical-align: middle;\n  padding-top: 5px;\n}\n.boxdays[_ngcontent-%COMP%]   .arrow_forward-custom[_ngcontent-%COMP%] {\n  position: relative;\n  top: 5px;\n  font-size: 22px;\n}\n.chart-wrapper-visitors[_ngcontent-%COMP%] {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  min-height: 345px;\n  background-color: white;\n}\n.chart-title-visitors[_ngcontent-%COMP%] {\n  padding: 12px 0px;\n  font-size: 18px;\n  display: inline-block;\n  vertical-align: middle;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.number-analytics[_ngcontent-%COMP%] {\n  font-size: 50px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n@media screen and (min-width: 768px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    width: 500px;\n    margin: 0 auto;\n  }\n  .section-select-days[_ngcontent-%COMP%] {\n    padding-right: 15px;\n  }\n}\n@media screen and (max-width: 767px) {\n  .advancedOptionForm[_ngcontent-%COMP%] {\n    padding-right: 25px;\n    padding-left: 25px;\n  }\n}']}),a})();var pe=f(40623),X=f(39850),J=f(42115),tt=f(87238),U=f(86856),H=f(67322),et=f(25245);const ue=["chart"];function Ae(a,l){1&a&&(t.O4$(),t.kcU(),t.TgZ(0,"div",49),t._UZ(1,"loading-spinner"),t.TgZ(2,"p"),t._uU(3),t.ALo(4,"translate"),t.qZA()()),2&a&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"Processing")))}function me(a,l){if(1&a&&(t.TgZ(0,"div",52),t._UZ(1,"apx-chart",53),t.qZA()),2&a){const e=t.oxw(2);t.xp6(1),t.Q6J("series",e.chartOptions.series)("chart",e.chartOptions.chart)("dataLabels",e.chartOptions.dataLabels)("plotOptions",e.chartOptions.plotOptions)("xaxis",e.chartOptions.xaxis)("stroke",e.chartOptions.stroke)("fill",e.chartOptions.fill)("yaxis",e.chartOptions.yaxis)("title",e.chartOptions.title)("tooltip",e.chartOptions.tooltip)("legend",e.chartOptions.legend)}}function Te(a,l){if(1&a&&(t.O4$(),t.kcU(),t.TgZ(0,"div",50),t.YNc(1,me,2,11,"div",51),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.chartOptions)}}const nt=function(a){return{"active-column-graph":a}};let Se=(()=>{class a{constructor(e,n,s){this.tagsService=e,this.logger=n,this.auth=s,this.lastdays=7,this.selectedDaysId=7,this.chartStackedColumns=!0,this.chartBasicColumns=!1,this.startDate=null,this.endDate=null,this.minEndDate=null,this.maxEndDate=null,this.isLoading=!0}ngOnInit(){this.calculateDateRange(this.lastdays),this.getCurrentUserAndChartTypePreference()}getCurrentUserAndChartTypePreference(){this.auth.user_bs.subscribe(e=>{this.logger.log("[TAG-ANALYTICS] - LoggedUser ",e),e&&e._id&&(this.currentUserId=e._id)})}getUserChartTypePreference(e){let n=localStorage.getItem(`chartStackedColumns-${e}`);this.logger.log("[TAG-ANALYTICS] STORED CHART TYPE PREFERENCE",n),n?("false"===n&&(this.chartStackedColumns=!1,this.chartBasicColumns=!0),"true"===n&&(this.chartStackedColumns=!0,this.chartBasicColumns=!1)):(this.chartStackedColumns=!0,this.chartBasicColumns=!1,this.logger.log("[TAG-ANALYTICS] NO STORED CHART TYPE PREFERENCE chartStackedColumns",this.chartStackedColumns,"chartBasicColumns ",this.chartBasicColumns))}onSelectStartDate(e){this.startDateTemp=o()(e).format("DD/MM/YYYY"),this.logger.log("[TAG-ANALYTICS] - Start Date startDate:",this.startDateTemp),e?(this.minEndDate=new Date(e),this.maxEndDate=new Date(e),this.maxEndDate.setDate(this.maxEndDate.getDate()+30)):(this.minEndDate=null,this.maxEndDate=null)}onSelectEndDate(e){this.endDateTemp=o()(e).format("DD/MM/YYYY"),this.logger.log("[TAG-ANALYTICS] - End Date endDateTemp:",this.endDateTemp),this.startDateTemp&&this.endDateTemp&&(this.selectedDaysId=null,this.getTagDataAndBuildGraph(this.startDateTemp,this.endDateTemp,this.chartStackedColumns))}clearDateRange(){this.logger.log("[TAG-ANALYTICS] - CLEAR DATE RANGE"),this.startDate=null,this.endDate=null,this.startDateTemp=null,this.endDateTemp=null,this.minEndDate=null,this.maxEndDate=null}onSelectStackedColmunsGraphType(e){this.logger.log("[TAG-ANALYTICS] - onSelectColmunsGraphType areStaked",e),this.chartStackedColumns=e,this.chartBasicColumns=!1,localStorage.setItem(`chartStackedColumns-${this.currentUserId}`,"true"),this.logger.log("[TAG-ANALYTICS] - chartStackedColumns ",this.chartStackedColumns),this.logger.log("[TAG-ANALYTICS] onSelectStackedColmunsGraphType startDateTemp",this.startDateTemp," endDateTemp ",this.endDateTemp),this.startDateTemp&&this.endDateTemp?this.getTagDataAndBuildGraph(this.startDateTemp,this.endDateTemp,this.chartStackedColumns):this.calculateDateRange(this.lastdays)}onSelectBasicColmunsGraphType(e){this.logger.log("[TAG-ANALYTICS] - onSelectBasicColmunsGraphType ",e),this.chartBasicColumns=e,this.chartStackedColumns=!1,localStorage.setItem(`chartStackedColumns-${this.currentUserId}`,"false"),this.logger.log("[TAG-ANALYTICS] - chartBasicColumns ",this.chartBasicColumns),this.logger.log("[TAG-ANALYTICS] onSelectBasicColmunsGraphType startDateTemp",this.startDateTemp," endDateTemp ",this.endDateTemp),this.startDateTemp&&this.endDateTemp?this.getTagDataAndBuildGraph(this.startDateTemp,this.endDateTemp,this.chartStackedColumns):this.calculateDateRange(this.lastdays)}daysSelect(e){this.selectedDaysId=e,this.logger.log("[TAG-ANALYTICS] daysSelect this.selectedDaysId ",this.selectedDaysId),this.selectedDaysId&&this.clearDateRange(),e<=30?(this.lastdays=e,this.calculateDateRange(this.lastdays)):90===e?(this.lastdays=e,this.logger.log("lastdays use case 90 or 180 lastdays",this.lastdays),this.calculateDateRange(this.lastdays)):(180===e||360===e)&&(this.lastdays=e,this.calculateDateRange(this.lastdays)),this.logger.log("[TAG-ANALYTICS] daysSelect:",e,"selectedDaysId ",this.selectedDaysId)}calculateDateRange(e){this.logger.log("calculateDateRange days ",e);const n=o()(),s=n.clone().subtract(e-1,"days"),i=n,r=s.format("DD/MM/YYYY"),g=i.format("DD/MM/YYYY");this.logger.log("[TAG-ANALYTICS] --\x3e calculateDateRange:",r,"startDate "," endDate ",g),this.getTagDataAndBuildGraph(r,g,this.chartStackedColumns)}getTagDataAndBuildGraph(e,n,s){this.logger.log("[TAG-ANALYTICS] GET TAG DATA AND BUILD GRAPH  startDate ",e,"endDate ",n,"chartStackedColumns ",s);const r=((T,S)=>{const _=[];let h=o()(T,"DD/MM/YYYY");const c=o()(S,"DD/MM/YYYY");for(;h<=c;)_.push(h.format("DD/MM/YYYY")),h=h.add(1,"day");return _})(e,n);this.logger.log("[TAG-ANALYTICS] Generated Date Range ----\x3e fullDateRange 2:",r),this.initDay=e,this.endDay=n,this.logger.log("[TAG-ANALYTICS] filter start day",this.initDay,"filter end day ",this.endDay),this.logger.log("[TAG-ANALYTICS] filter start day x query",o()(this.initDay,"DD/MM/YYYY").format("MM/DD/YYYY"),"filter end day x query",o()(this.endDay,"DD/MM/YYYY").format("MM/DD/YYYY"));const g=o()(this.initDay,"DD/MM/YYYY").format("MM/DD/YYYY"),m=o()(this.endDay,"DD/MM/YYYY").format("MM/DD/YYYY");this.tagsService.geTagsForGraph("conversation-tag",g,m).subscribe(T=>{this.logger.log("[TAG-ANALYTICS] ---\x3e GET GRAPH TAGS RES ",T);const S=T.series.map(h=>{this.logger.log("filledSeries serie ",h);const c=Object.fromEntries(T.dates.map((d,C)=>[d,h.values[C]]));this.logger.log("filledSeriesvaluesMap",c),this.logger.log("filledSeries fullDateRange",r);const p=r.map(d=>c[d]||0);return{name:h.name,data:p}}),_={dates:r,series:S};this.buildGraph(_,s),this.logger.log("finalData",_)},T=>{this.logger.error("[TAG-ANALYTICS] - GET GRAPH TAGS - ERROR: ",T)},()=>{this.logger.log("[TAG-ANALYTICS] - GET GRAPH TAGS * COMPLETE *")})}buildGraph(e,n){this.isLoading=!0,setTimeout(()=>{this.chartOptions={series:e.series,chart:{type:"bar",height:350,stacked:n},plotOptions:{bar:{horizontal:!1}},stroke:{width:1,colors:["#fff"]},xaxis:{categories:e.dates,labels:{formatter:function(s){return s}}},yaxis:{title:{text:void 0}},tooltip:{y:{formatter:function(s){return s+""}}},fill:{opacity:1},legend:{position:"bottom",horizontalAlign:"center",offsetX:40}},this.isLoading=!1},1e3)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(pe.i),t.Y36(x.m),t.Y36(q.e))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-tags-analytics"]],viewQuery:function(e,n){if(1&e&&t.Gf(ue,5),2&e){let s;t.iGM(s=t.CRH())&&(n.chart=s.first)}},decls:88,vars:72,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],[1,"card","graph-card"],[1,"graph-card-header"],[1,"graph-card-header-title"],[1,"graph-card-header-filter-range"],[1,"analytics-date-range-selected"],[1,"material-icons","arrow_forward-custom"],[1,"graph-options"],[1,"analytics-date-range-filter-wpr"],[1,"analytics-date-range-filter-label"],[1,"analytics-date-range-filter-select"],["name","days",1,"custom",3,"ngModel","clearable","placeholder","ngModelChange","change"],[3,"value"],[1,"date-picker-wpr"],[1,"analytics-options-label"],["matTooltipClass","custom-mat-tooltip","matTooltipPosition","above","matTooltipHideDelay","100",1,"info-icon-wpr",3,"matTooltip"],["tooltip","matTooltip"],[1,"material-icons"],[1,"analytics-date-picker"],["appearance","standard",1,"tags-analytics-date-range-picker"],[3,"rangePicker","min","max"],["matStartDate","",3,"placeholder","ngModel","ngModelChange","dateChange"],["matEndDate","",3,"placeholder","ngModel","ngModelChange","dateChange"],["matSuffix","",3,"for"],["matSuffix","",3,"click"],["matDatepickerToggleIcon",""],["picker",""],[1,"graph-type-options-wpr"],[1,"graph-type-select"],[1,"graph-type-select-btns-wrp"],[1,"graph-type-select-btn-wrp"],["matTooltipClass","custom-mat-tooltip","matTooltipPosition","below","matTooltipHideDelay","100",1,"graph-type-select-btn",3,"matTooltip","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","enable-background","new 0 0 24 24","viewBox","0 0 24 24","fill","none"],["fill","none","height","24","width","24"],["d","M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M19,19H5V5h14V19z"],["height","5","width","2","x","7","y","12"],["height","10","width","2","x","15","y","7"],["height","3","width","2","x","11","y","14"],["height","2","width","2","x","11","y","10"],[1,"graph-type-btn-wrp"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","none"],["d","M0 0h24v24H0V0z","fill","none"],["d","M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"],["class","chart-loading-spinner",4,"ngIf"],["class","card-content","style"," margin:0px auto; padding-top: 0px;padding-bottom: 10px;",4,"ngIf"],[1,"chart-loading-spinner"],[1,"card-content",2,"margin","0px auto","padding-top","0px","padding-bottom","10px"],["id","chart",4,"ngIf"],["id","chart"],[3,"series","chart","dataLabels","plotOptions","xaxis","stroke","fill","yaxis","title","tooltip","legend"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"div",8)(13,"span",9),t._uU(14),t.TgZ(15,"i",10),t._uU(16," arrow_forward "),t.qZA(),t._uU(17),t.qZA()(),t.TgZ(18,"div",11)(19,"div",12)(20,"div",13),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.TgZ(23,"div",14)(24,"ng-select",15),t.NdJ("ngModelChange",function(i){return n.selectedDaysId=i})("change",function(){return n.daysSelect(n.selectedDaysId)}),t.ALo(25,"translate"),t.TgZ(26,"ng-option",16),t._uU(27),t.ALo(28,"translate"),t.ALo(29,"translate"),t.qZA(),t.TgZ(30,"ng-option",16),t._uU(31),t.ALo(32,"translate"),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"ng-option",16),t._uU(35),t.ALo(36,"translate"),t.ALo(37,"translate"),t.qZA()()()(),t.TgZ(38,"div",17)(39,"div",18),t._uU(40),t.ALo(41,"translate"),t.TgZ(42,"span",19,20),t.ALo(44,"translate"),t.TgZ(45,"i",21),t._uU(46," help_outline "),t.qZA()()(),t.TgZ(47,"div",22)(48,"mat-form-field",23)(49,"mat-date-range-input",24)(50,"input",25),t.NdJ("ngModelChange",function(i){return n.startDate=i})("dateChange",function(i){return n.onSelectStartDate(i.value)}),t.ALo(51,"translate"),t.qZA(),t.TgZ(52,"input",26),t.NdJ("ngModelChange",function(i){return n.endDate=i})("dateChange",function(i){return n.onSelectEndDate(i.value)}),t.ALo(53,"translate"),t.qZA()(),t._UZ(54,"mat-datepicker-toggle",27),t.TgZ(55,"mat-datepicker-toggle",28),t.NdJ("click",function(){return n.clearDateRange()}),t.TgZ(56,"mat-icon",29),t._uU(57,"clear"),t.qZA()(),t._UZ(58,"mat-date-range-picker",null,30),t.qZA()()(),t.TgZ(60,"div",31)(61,"div",18),t._uU(62),t.ALo(63,"translate"),t.qZA(),t.TgZ(64,"div",32)(65,"div",33)(66,"div",34)(67,"button",35,20),t.NdJ("click",function(){return n.onSelectStackedColmunsGraphType(!0)}),t.ALo(69,"translate"),t.O4$(),t.TgZ(70,"svg",36)(71,"g"),t._UZ(72,"rect",37),t.TgZ(73,"g"),t._UZ(74,"path",38)(75,"rect",39)(76,"rect",40)(77,"rect",41)(78,"rect",42),t.qZA()()()()(),t.kcU(),t.TgZ(79,"div",43)(80,"button",35,20),t.NdJ("click",function(){return n.onSelectBasicColmunsGraphType(!0)}),t.ALo(82,"translate"),t.O4$(),t.TgZ(83,"svg",44),t._UZ(84,"path",45)(85,"path",46),t.qZA()()()()()()(),t.YNc(86,Ae,5,3,"div",47),t.YNc(87,Te,2,1,"div",48),t.qZA()()()()),2&e){const s=t.MAs(59);t.xp6(3),t.hij(" ",t.lcZ(4,34,"Analytics.ConversationsTags")," "),t.xp6(7),t.hij(" ",t.lcZ(11,36,"Analytics.TagsAnalysis")," "),t.xp6(4),t.hij(" ",n.initDay," "),t.xp6(3),t.hij(" ",n.endDay," "),t.xp6(4),t.hij(" ",t.lcZ(22,38,"Analytics.FilterByTheLastNDays")," "),t.xp6(3),t.s9C("placeholder",t.lcZ(25,40,"SelectAnOption")),t.Q6J("ngModel",n.selectedDaysId)("clearable",!1),t.xp6(2),t.Q6J("value",7),t.xp6(1),t.AsE(" ",t.lcZ(28,42,"Analytics.Last")," 7 ",t.lcZ(29,44,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE(" ",t.lcZ(32,46,"Analytics.Last")," 15 ",t.lcZ(33,48,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE(" ",t.lcZ(36,50,"Analytics.Last")," 30 ",t.lcZ(37,52,"Analytics.Days")," "),t.xp6(5),t.hij(" ",t.lcZ(41,54,"Analytics.FilterByCustomRange")," "),t.xp6(2),t.s9C("matTooltip",t.lcZ(44,56,"Analytics.MaxRange30Days")),t.xp6(7),t.Q6J("rangePicker",s)("min",n.minEndDate)("max",n.maxEndDate),t.xp6(1),t.s9C("placeholder",t.lcZ(51,58,"StartDate")),t.Q6J("ngModel",n.startDate),t.xp6(2),t.s9C("placeholder",t.lcZ(53,60,"EndDate")),t.Q6J("ngModel",n.endDate),t.xp6(2),t.Q6J("for",s),t.xp6(8),t.hij(" ",t.lcZ(63,62,"Analytics.GraphType")," "),t.xp6(5),t.s9C("matTooltip",t.lcZ(69,64,"Analytics.StackedColumns")),t.Q6J("ngClass",t.VKq(68,nt,n.chartStackedColumns)),t.xp6(13),t.s9C("matTooltip",t.lcZ(82,66,"Analytics.BasicColumns")),t.Q6J("ngClass",t.VKq(70,nt,n.chartBasicColumns)),t.xp6(6),t.Q6J("ngIf",n.isLoading),t.xp6(1),t.Q6J("ngIf",!n.isLoading)}},dependencies:[E.mk,E.O5,X.g,v.w9,v.jq,I.Fj,I.JJ,I.On,J.x,tt.gM,U.nW,U.Q0,U.wx,U.zY,U.By,U._g,H.KE,H.R9,et.Hw,L.X$]}),a})();function fe(a,l){1&a&&t._UZ(0,"appdashboard-requests")}function Ce(a,l){1&a&&t._UZ(0,"appdashboard-visitors-analytics")}function _e(a,l){1&a&&t._UZ(0,"appdashboard-messages")}function ye(a,l){1&a&&t._UZ(0,"appdashboard-responsetimes")}function Ee(a,l){1&a&&t._UZ(0,"appdashboard-convsduration")}function Le(a,l){1&a&&t._UZ(0,"appdashboard-events-analytics")}function be(a,l){1&a&&t._UZ(0,"appdashboard-satisfaction")}function Ie(a,l){1&a&&t._UZ(0,"appdashboard-tags-analytics")}const Z=function(a,l){return{"li-active":a,"border-from-center":l}};let ve=(()=>{class a{constructor(e){this.logger=e,this.selected="richieste"}ngOnInit(){this.logger.log("[ANALYTICS - METRICS] - autoselected",this.autoselected),"visitors"===this.autoselected&&(this.selected="visitors"),"messages"===this.autoselected&&(this.selected="messages")}goTo(e){this.selected=e,this.logger.log("[ANALYTICS - METRICS] Move to:",e)}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-metrics"]],inputs:{autoselected:"autoselected"},decls:43,vars:64,consts:[[1,"bottom-nav-metrics",2,"margin-left","-25px","margin-right","-25px"],[1,"btn-with-border-effect",3,"ngClass","click"],[1,"bnt-with-border-effect",3,"ngClass","click"],[1,"main-content",2,"padding-top","0px"],[1,"container-fluid"],[4,"ngIf"]],template:function(e,n){1&e&&(t.TgZ(0,"ul",0)(1,"li",1),t.NdJ("click",function(){return n.goTo("richieste")}),t.TgZ(2,"a"),t._uU(3),t.ALo(4,"translate"),t.qZA()(),t.TgZ(5,"li",1),t.NdJ("click",function(){return n.goTo("visitors")}),t.TgZ(6,"a"),t._uU(7),t.ALo(8,"translate"),t.qZA()(),t.TgZ(9,"li",2),t.NdJ("click",function(){return n.goTo("messages")}),t.TgZ(10,"a"),t._uU(11),t.ALo(12,"translate"),t.qZA()(),t.TgZ(13,"li",1),t.NdJ("click",function(){return n.goTo("tempiRisposta")}),t.TgZ(14,"a"),t._uU(15),t.ALo(16,"translate"),t.qZA()(),t.TgZ(17,"li",1),t.NdJ("click",function(){return n.goTo("durataConv")}),t.TgZ(18,"a"),t._uU(19),t.ALo(20,"translate"),t.qZA()(),t.TgZ(21,"li",1),t.NdJ("click",function(){return n.goTo("events")}),t.TgZ(22,"a"),t._uU(23),t.ALo(24,"translate"),t.qZA()(),t.TgZ(25,"li",1),t.NdJ("click",function(){return n.goTo("satisfaction")}),t.TgZ(26,"a"),t._uU(27),t.ALo(28,"translate"),t.qZA()(),t.TgZ(29,"li",1),t.NdJ("click",function(){return n.goTo("tags")}),t.TgZ(30,"a"),t._uU(31),t.ALo(32,"translate"),t.qZA()()(),t.TgZ(33,"div",3)(34,"div",4),t.YNc(35,fe,1,0,"appdashboard-requests",5),t.YNc(36,Ce,1,0,"appdashboard-visitors-analytics",5),t.YNc(37,_e,1,0,"appdashboard-messages",5),t.YNc(38,ye,1,0,"appdashboard-responsetimes",5),t.YNc(39,Ee,1,0,"appdashboard-convsduration",5),t.YNc(40,Le,1,0,"appdashboard-events-analytics",5),t.YNc(41,be,1,0,"appdashboard-satisfaction",5),t.YNc(42,Ie,1,0,"appdashboard-tags-analytics",5),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("ngClass",t.WLB(40,Z,"richieste"===n.selected,"richieste"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(4,24,"Analytics.Metrics.Requests")),t.xp6(2),t.Q6J("ngClass",t.WLB(43,Z,"visitors"===n.selected,"visitors"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(8,26,"Analytics.VisitorsComponentTitle")),t.xp6(2),t.Q6J("ngClass",t.WLB(46,Z,"messages"===n.selected,"visitors"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(12,28,"Analytics.MessagesComponentTitle")),t.xp6(2),t.Q6J("ngClass",t.WLB(49,Z,"tempiRisposta"===n.selected,"tempiRisposta"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(16,30,"Analytics.Metrics.ResponseTime")),t.xp6(2),t.Q6J("ngClass",t.WLB(52,Z,"durataConv"===n.selected,"durataConv"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(20,32,"Analytics.Metrics.ConversationLenght")),t.xp6(2),t.Q6J("ngClass",t.WLB(55,Z,"events"===n.selected,"events"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(24,34,"Analytics.Metrics.Events")),t.xp6(2),t.Q6J("ngClass",t.WLB(58,Z,"satisfaction"===n.selected,"satisfaction"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(28,36,"Analytics.Metrics.Satisfaction")),t.xp6(2),t.Q6J("ngClass",t.WLB(61,Z,"tags"===n.selected,"tags"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(32,38,"Tags.Tags")),t.xp6(4),t.Q6J("ngIf","richieste"==n.selected),t.xp6(1),t.Q6J("ngIf","visitors"==n.selected),t.xp6(1),t.Q6J("ngIf","messages"==n.selected),t.xp6(1),t.Q6J("ngIf","tempiRisposta"==n.selected),t.xp6(1),t.Q6J("ngIf","durataConv"==n.selected),t.xp6(1),t.Q6J("ngIf","events"==n.selected),t.xp6(1),t.Q6J("ngIf","satisfaction"==n.selected),t.xp6(1),t.Q6J("ngIf","tags"==n.selected))},dependencies:[E.mk,E.O5,ht,Tt,Et,Gt,Kt,le,he,Se,L.X$],styles:[".bottom-nav-metrics[_ngcontent-%COMP%] {\n  background-color: #fff;\n  width: 100%;\n  position: relative;\n  top: -5px;\n  padding-bottom: 5px;\n  float: left;\n  height: 50px;\n  padding-left: 0px;\n  display: flex;\n  flex-grow: 1;\n  margin-bottom: 20px;\n}\n.bottom-nav-metrics[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n  float: left;\n  padding: 15px;\n  list-style: none;\n  position: relative;\n  display: block;\n  height: 52px;\n  cursor: pointer;\n}\n.bottom-nav-metrics[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\n  padding: 18px 15px;\n  color: #797979;\n  line-height: 20px;\n}\n.bottom-nav-metrics[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover {\n  text-decoration: none;\n}\n@media (max-width: 991px) {\n  .bottom-nav-metrics[_ngcontent-%COMP%] {\n    top: -2px !important;\n  }\n  .chart-wrapper[_ngcontent-%COMP%] {\n    margin-top: 60px !important;\n  }\n}\n@media (max-width: 370px) {\n  .bottom-nav-metrics[_ngcontent-%COMP%] {\n    height: 37px !important;\n  }\n  .bottom-nav-metrics[_ngcontent-%COMP%]   li[_ngcontent-%COMP%] {\n    padding: 6px !important;\n    height: 39px;\n  }\n}"]}),a})();var Ne=f(15861),j=f(31158);const Re=["chart"];function xe(a,l){if(1&a&&(t.TgZ(0,"div",17),t._UZ(1,"apx-chart",18),t.qZA()),2&a){const e=t.oxw();t.xp6(1),t.Q6J("series",e.chartOptions.series)("chart",e.chartOptions.chart)("dataLabels",e.chartOptions.dataLabels)("colors",e.chartOptions.colors)("grid",e.chartOptions.grid)("xaxis",e.chartOptions.xaxis)("title",e.chartOptions.title)}}let De=(()=>{class a{constructor(e,n,s,i,r){this.translate=e,this.analyticsService=n,this.auth=s,this.logger=i,this.roleService=r,this.customData=[],this.xlabel_ita=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],this.xlabel_eng=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],this.ylabel_ita=["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"],this.ylabel_eng=["1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12am","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm","12pm"],this.showSpinner=!0,this.langService=new N.b,this.humanizer=new N.f(this.langService),this.lang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS - OVERVIEW] LANGUAGE ",this.lang),this.getBrowserLangAndSwitchMonthName(),this.getHeatMapSeriesDataByLang()}ngOnInit(){this.roleService.checkRoleForCurrentProject("panoramica"),this.getRequestByLast7Day(),this.avarageWaitingTimeCLOCK(),this.durationConvTimeCLOCK(),this.getHeatMapDataAndBuildGraph()}showHideSpinner(){var e=this;return(0,Ne.Z)(function*(){!0===e.heatmapEND&&!0===e.chartEND&&(e.showSpinner=!1)})()}startTimer(){let n,e=5;n=setInterval(()=>{e>0&&(e--,this.logger.log("[ANALYTICS - OVERVIEW] startTimer timeLeft ",e))},1e3)}ngOnDestroy(){this.logger.log("[ANALYTICS - OVERVIEW] - !!!!! UN - SUBSCRIPTION TO REQUESTS"),this.subscription.unsubscribe()}goToRichieste(){this.logger.log("[ANALYTICS - OVERVIEW] User click on last 7 days graph"),this.analyticsService.goToRichieste()}getHeatMapSeriesDataByLang(){this.weekday={1:o().weekdaysShort(0),2:o().weekdaysShort(1),3:o().weekdaysShort(2),4:o().weekdaysShort(3),5:o().weekdaysShort(4),6:o().weekdaysShort(5),7:o().weekdaysShort(6)},this.hour={1:o()("01:00","HH:mm").format("LT"),2:o()("02:00","HH:mm").format("LT"),3:o()("03:00","HH:mm").format("LT"),4:o()("04:00","HH:mm").format("LT"),5:o()("05:00","HH:mm").format("LT"),6:o()("06:00","HH:mm").format("LT"),7:o()("07:00","HH:mm").format("LT"),8:o()("08:00","HH:mm").format("LT"),9:o()("09:00","HH:mm").format("LT"),10:o()("10:00","HH:mm").format("LT"),11:o()("11:00","HH:mm").format("LT"),12:o()("12:00","HH:mm").format("LT"),13:o()("13:00","HH:mm").format("LT"),14:o()("14:00","HH:mm").format("LT"),15:o()("15:00","HH:mm").format("LT"),16:o()("16:00","HH:mm").format("LT"),17:o()("17:00","HH:mm").format("LT"),18:o()("18:00","HH:mm").format("LT"),19:o()("19:00","HH:mm").format("LT"),20:o()("20:00","HH:mm").format("LT"),21:o()("21:00","HH:mm").format("LT"),22:o()("22:00","HH:mm").format("LT"),23:o()("23:00","HH:mm").format("LT"),24:o()("24:00","HH:mm").format("LT")},this.yAxis={labels:[o()("01:00","HH:mm").format("LT"),o()("02:00","HH:mm").format("LT"),o()("03:00","HH:mm").format("LT"),o()("04:00","HH:mm").format("LT"),o()("05:00","HH:mm").format("LT"),o()("06:00","HH:mm").format("LT"),o()("07:00","HH:mm").format("LT"),o()("08:00","HH:mm").format("LT"),o()("09:00","HH:mm").format("LT"),o()("10:00","HH:mm").format("LT"),o()("11:00","HH:mm").format("LT"),o()("12:00","HH:mm").format("LT"),o()("13:00","HH:mm").format("LT"),o()("14:00","HH:mm").format("LT"),o()("15:00","HH:mm").format("LT"),o()("16:00","HH:mm").format("LT"),o()("17:00","HH:mm").format("LT"),o()("18:00","HH:mm").format("LT"),o()("19:00","HH:mm").format("LT"),o()("20:00","HH:mm").format("LT"),o()("21:00","HH:mm").format("LT"),o()("22:00","HH:mm").format("LT"),o()("23:00","HH:mm").format("LT"),o()("24:00","HH:mm").format("LT")]};const e=o().weekdaysShort();e.push(e.shift()),this.xAxis={labels:e},this.titleSettings={text:"Requests per hour of day",textStyle:{size:"15px",fontWeight:"500",fontStyle:"Normal"}}}getBrowserLangAndSwitchMonthName(){this.monthNames={1:o().monthsShort(0),2:o().monthsShort(1),3:o().monthsShort(2),4:o().monthsShort(3),5:o().monthsShort(4),6:o().monthsShort(5),7:o().monthsShort(6),8:o().monthsShort(7),9:o().monthsShort(8),10:o().monthsShort(9),11:o().monthsShort(10),12:o().monthsShort(11)}}getMaxOfArray(e){return Math.max.apply(null,e)}getRequestByLast7Day(){this.subscription=this.analyticsService.requestsByDay(7).subscribe(e=>{this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY ",e);const n=[];for(let c=0;c<=6;c++)n.push({count:0,day:o()().subtract(c,"d").format("D-M-YYYY")});n.reverse(),this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - MOMENT LAST SEVEN DATE (init array)",n);const r=[];for(let c=0;c<e.length;c++)e[c]&&r.push({count:e[c].count,day:e[c]._id.day+"-"+e[c]._id.month+"-"+e[c]._id.year});this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY FORMATTED ",r);const g=n.map(c=>r.find(p=>p.day===c.day)||c);this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - FINAL ARRAY ",g);const m=[],T=[];g.forEach(c=>{m.push(c.count);const p=c.day.split("-");T.push(p[0]+" "+this.monthNames[p[1]])}),this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - SERIES (ARRAY OF COUNT - to use for debug)",[]),this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",m),this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - LABELS (ARRAY OF DAY - to use for debug)",[]),this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - LABELS (+ NEW + ARRAY OF DAY)",T);const S=this.getMaxOfArray(m);this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY - HIGHTER COUNT ",S),new D.Chart("last7dayChart",{type:"line",data:{labels:T,datasets:[{label:"Number of request in last 7 days ",data:m,fill:!0,lineTension:.4,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"AVERAGE TIME RESPONSE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(c,p,d){if(Math.floor(c)===c)return c},display:!0,fontColor:"black",suggestedMax:S+2}}]},tooltips:{callbacks:{label:(c,p)=>{const C=c.yLabel;return this.translate.instant("Requests")+":"+C}}}},plugins:[{beforeDraw:function(c,p){var d=c.chart.ctx;d.height=128,d.font="Roboto"}}]})},e=>{this.logger.error("[ANALYTICS -  OVERVIEW] - REQUESTS BY DAY - ERROR ",e)},()=>{this.logger.log("[ANALYTICS - OVERVIEW] - REQUESTS BY DAY * COMPLETE *")})}getHeatMapDataAndBuildGraph(){this.analyticsService.getDataHeatMap().subscribe(e=>{let n=e,s=[];for(let r=1;r<=24;r++)for(let g=1;g<=7;g++)s.push({hour:this.hour[r],weekday:this.weekday[g],count:0});this.formattedHeatMapRes=[];for(let r in n)this.formattedHeatMapRes.push({hour:this.hour[this.getOffset(n[r]._id.hour,n[r]._id.weekday).hours],weekday:this.weekday[this.getOffset(n[r]._id.hour,n[r]._id.weekday).weekday],count:n[r].count});const i=s.map(r=>this.formattedHeatMapRes.find(g=>g.hour===r.hour&&g.weekday===r.weekday)||r);i&&this.buildApxHeatMap(i)},e=>{this.logger.error("[ANALYTICS - OVERVIEW] - GET P-USERS-&-BOTS - ERROR: ",e)},()=>{this.logger.log("[ANALYTICS - OVERVIEW] - GET P-USERS-&-BOTS - COMPLETE")})}buildApxHeatMap(e){this.chartOptions={series:[{name:this.hour[24],data:this.generateData(this.hour[24],e)},{name:this.hour[23],data:this.generateData(this.hour[23],e)},{name:this.hour[22],data:this.generateData(this.hour[22],e)},{name:this.hour[21],data:this.generateData(this.hour[21],e)},{name:this.hour[20],data:this.generateData(this.hour[20],e)},{name:this.hour[19],data:this.generateData(this.hour[19],e)},{name:this.hour[18],data:this.generateData(this.hour[18],e)},{name:this.hour[17],data:this.generateData(this.hour[17],e)},{name:this.hour[16],data:this.generateData(this.hour[16],e)},{name:this.hour[15],data:this.generateData(this.hour[15],e)},{name:this.hour[14],data:this.generateData(this.hour[14],e)},{name:this.hour[13],data:this.generateData(this.hour[13],e)},{name:this.hour[12],data:this.generateData(this.hour[12],e)},{name:this.hour[11],data:this.generateData(this.hour[11],e)},{name:this.hour[10],data:this.generateData(this.hour[10],e)},{name:this.hour[9],data:this.generateData(this.hour[9],e)},{name:this.hour[8],data:this.generateData(this.hour[8],e)},{name:this.hour[7],data:this.generateData(this.hour[7],e)},{name:this.hour[6],data:this.generateData(this.hour[6],e)},{name:this.hour[5],data:this.generateData(this.hour[5],e)},{name:this.hour[4],data:this.generateData(this.hour[4],e)},{name:this.hour[3],data:this.generateData(this.hour[3],e)},{name:this.hour[2],data:this.generateData(this.hour[2],e)},{name:this.hour[1],data:this.generateData(this.hour[1],e)}],chart:{height:500,type:"heatmap"},dataLabels:{enabled:!0},stroke:{colors:["#90A4AE"]},colors:["#008FFB"],xaxis:{type:"category",categories:[this.weekday[1],this.weekday[2],this.weekday[3],this.weekday[4],this.weekday[5],this.weekday[6],this.weekday[7]]},grid:{padding:{right:20}}}}generateData(e,n){var s=[];return n.filter(r=>r.hour===e).forEach(r=>{s.push(r.count)}),s}getOffset(e,n){const r=e+j.tz(j.utc(),j.tz.guess()).utcOffset()/60;if(r>24){const g=n+1;return g>7?{hours:r-24,weekday:g-7}:g<1?{hours:r-24,weekday:7+g}:{hours:r-24,weekday:g}}if(r<1){let g=n-1;return g>7?{hours:24+r,weekday:g-7}:g<1?{hours:24+r,weekday:7+g}:{hours:24+r,weekday:g}}return{hours:r,weekday:n}}avarageWaitingTimeCLOCK(){this.subscription=this.analyticsService.getDataAVGWaitingCLOCK().subscribe(e=>{var n;if(e&&e.length>0)if(e[0].waiting_time_avg)if(null!==e[0].waiting_time_avg||void 0!==e[0].waiting_time_avg){n=this.humanizeDurations(e[0].waiting_time_avg).split(" "),this.unitAVGtime=n[1],this.numberAVGtime=this.msToTIME(e[0].waiting_time_avg);const s=this.translate.getBrowserLang();let i;this.auth.user_bs&&this.auth.user_bs.value&&(i=localStorage.getItem(this.auth.user_bs.value._id+"_lang"));let r="";s&&!i?r=s:s&&i&&(r=i),this.logger.log("[ANALYTICS  - OVERVIEW] - setMomentLocale durationConvTimeCLOCK dshbrd_lang",r),this.responseAVGtime=this.humanizer.humanize(e[0].waiting_time_avg,{round:!0,language:r}),this.logger.log("[ANALYTICS - OVERVIEW] avarageWaitingTimeCLOCK Waiting time: humanize",this.humanizer.humanize(e[0].waiting_time_avg)),this.logger.log("[ANALYTICS - OVERVIEW] waiting time funtion:",this.humanizeDurations(e[0].waiting_time_avg))}else this.setToNa("avg"),this.logger.log("[ANALYTICS - OVERVIEW] avarageWaitingTimeCLOCK Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - OVERVIEW] avarageWaitingTimeCLOCK waiting time funtion:",this.humanizeDurations(0));else this.setToNa("avg");else this.setToNa("avg"),this.logger.log("[ANALYTICS - OVERVIEW] avarageWaitingTimeCLOCK Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - OVERVIEW] avarageWaitingTimeCLOCK waiting time funtion:",this.humanizeDurations(0))},e=>{this.logger.error("[ANALYTICS - OVERVIEW] - AVERAGE WAITING TIME CLOCK REQUEST  - ERROR ",e),this.setToNa("avg")},()=>{this.logger.log("![ANALYTICS - OVERVIEW]- AVERAGE TIME CLOCK REQUEST * COMPLETE *")})}durationConvTimeCLOCK(){this.subscription=this.analyticsService.getDurationConversationTimeDataCLOCK().subscribe(e=>{let n,s;if(e&&e.length>0)if(this.logger.log("[ANALYTICS - OVERVIEW] \xbb\xbb\xbb\xbb durationConvTimeCLOCK res[0].duration_avg ",e[0].duration_avg),this.logger.log("[ANALYTICS - OVERVIEW] \xbb\xbb\xbb\xbb durationConvTimeCLOCK typeof res[0].duration_avg ",typeof e[0].duration_avg),e[0].duration_avg)if(null!==e[0].duration_avg||void 0!==e[0].duration_avg){n=this.humanizeDurations(e[0].duration_avg),s=this.humanizeDurations(e[0].duration_avg).split(" "),this.numberDurationCNVtime=this.msToTIME(e[0].duration_avg),this.unitDurationCNVtime=s[1];const i=this.translate.getBrowserLang();let r;this.auth.user_bs&&this.auth.user_bs.value&&(r=localStorage.getItem(this.auth.user_bs.value._id+"_lang"));let g="";i&&!r?g=i:i&&r&&(g=r),this.logger.log("[ANALYTICS  - OVERVIEW] - setMomentLocale durationConvTimeCLOCK dshbrd_lang",g),this.responseDurationtime=this.humanizer.humanize(e[0].duration_avg,{round:!0,language:g}),this.logger.log("[ANALYTICS - OVERVIEW] durationConvTimeCLOCK Waiting time: humanize",this.humanizer.humanize(e[0].duration_avg)),this.logger.log("[ANALYTICS - OVERVIEW] durationConvTimeCLOCK waiting time funtion:",n)}else this.setToNa("duration");else this.setToNa("duration"),this.logger.log("[ANALYTICS - OVERVIEW] durationConvTimeCLOCK Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - OVERVIEW] durationConvTimeCLOCK waiting time funtion:",n);else this.setToNa("duration"),this.logger.log("[ANALYTICS - OVERVIEW] durationConvTimeCLOCK Waiting time: humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS - OVERVIEW] durationConvTimeCLOCK waiting time funtion:",n)},e=>{this.logger.error("[ANALYTICS - OVERVIEW] - DURATION CONVERSATION CLOCK REQUEST - ERROR ",e),this.setToNa("duration")},()=>{this.logger.log("[ANALYTICS - OVERVIEW] - DURATION CONVERSATION CLOCK REQUEST * COMPLETE *")})}setToNa(e){"avg"===e?(this.numberAVGtime="n/a",this.unitAVGtime="",this.responseAVGtime="n/a"):"duration"===e&&(this.numberDurationCNVtime="n/a.",this.unitDurationCNVtime="",this.responseDurationtime="n/a")}humanizeDurations(e){let n;if(e)return n=(n=Math.round(e/31104e6))>0?1===n?n+" "+this.translate.instant("Analytics.Year"):n+" "+this.translate.instant("Analytics.Years"):(n=Math.round(e/2592e6))>0?1===n?n+" "+this.translate.instant("Analytics.Month"):n+" "+this.translate.instant("Analytics.Months"):(n=Math.round(e/864e5))>0?1===n?n+" "+this.translate.instant("Analytics.Day"):n+" "+this.translate.instant("Analytics.Days"):(n=Math.round(e/36e5))>0?1===n?n+" "+this.translate.instant("Analytics.Hour"):n+" "+this.translate.instant("Analytics.Hours"):(n=Math.round(e/6e4))>0?1===n?n+" "+this.translate.instant("Analytics.Minute"):n+" "+this.translate.instant("Analytics.Minutes"):(n=Math.round(e/1e3))>0?1===n?n+" "+this.translate.instant("Analytics.Second"):n+" "+this.translate.instant("Analytics.Seconds"):e+" "+this.translate.instant("Analytics.Milliseconds"),n}msToTIME(e){return Math.floor(e/36e5)+"h:"+Math.floor(e%36e5/6e4)+"m:"+Math.round(e%36e4%6e4/1e3)+"s"}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(L.sK),t.Y36(M.y),t.Y36(q.e),t.Y36(x.m),t.Y36($.N))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-panoramica"]],viewQuery:function(e,n){if(1&e&&t.Gf(Re,5),2&e){let s;t.iGM(s=t.CRH())&&(n.chart=s.first)}},decls:47,vars:23,consts:[[1,"row"],[1,"col-md-12"],[1,"chart-wrapper-panoramica"],[1,"chart-title-panoramica",2,"cursor","pointer","text-align","center",3,"click"],[1,"card-content","chart-container",2,"position","relative","margin","auto 12px","height","35vh"],["id","last7dayChart"],[1,"row",2,"text-align","center","margin-top","6px"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12"],[1,"card",2,"border-radius","10px"],[2,"padding-bottom","12px","padding-top","16px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content",2,"margin","0px auto","padding-top","0px","padding-bottom","10px"],["id","chart",4,"ngIf"],[1,"col-xs-12","col-sm-6","col-md-6","col-lg-6"],[2,"padding-bottom","12px","padding-top","30px","font-size","18px","font-family","'Poppins', 'Roboto',  'Arial', sans-serif"],[1,"card-content","clock"],[1,"numberCLOCK"],[1,"card-footer","request_count_footer",2,"font-size","14px"],["id","chart"],[3,"series","chart","dataLabels","colors","grid","xaxis","title"]],template:function(e,n){1&e&&(t.TgZ(0,"div")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),t.NdJ("click",function(){return n.goToRichieste()}),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",4),t._UZ(8,"canvas",5),t.qZA()()()(),t.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"p"),t._uU(14),t.ALo(15,"translate"),t.qZA()(),t.TgZ(16,"div",10),t.YNc(17,xe,2,7,"div",11),t.qZA()()()(),t.TgZ(18,"div",6)(19,"div",12)(20,"div",8)(21,"div",13)(22,"p"),t._uU(23),t.ALo(24,"translate"),t.qZA()(),t.TgZ(25,"div",14)(26,"p",15),t._uU(27),t.qZA()(),t.TgZ(28,"div",16),t._uU(29),t.ALo(30,"translate"),t.TgZ(31,"b"),t._uU(32),t.qZA()()()(),t.TgZ(33,"div",12)(34,"div",8)(35,"div",13)(36,"p"),t._uU(37),t.ALo(38,"translate"),t.qZA()(),t.TgZ(39,"div",14)(40,"p",15),t._uU(41),t.qZA()(),t.TgZ(42,"div",16),t._uU(43),t.ALo(44,"translate"),t.TgZ(45,"b"),t._uU(46),t.qZA()()()()()()),2&e&&(t.xp6(5),t.hij(" ",t.lcZ(6,11,"NumberOfRequestsLast7Days")," "),t.xp6(9),t.Oqu(t.lcZ(15,13,"Analytics.HeatMapTitle")),t.xp6(3),t.Q6J("ngIf",n.chartOptions),t.xp6(6),t.Oqu(t.lcZ(24,15,"Analytics.MedianResTimeClock")),t.xp6(4),t.Oqu(n.numberAVGtime),t.xp6(2),t.hij(" ",t.lcZ(30,17,"Analytics.ResponseAVGtime")," "),t.xp6(3),t.Oqu(n.responseAVGtime),t.xp6(5),t.Oqu(t.lcZ(38,19,"Analytics.MedianConvClock")),t.xp6(4),t.Oqu(n.numberDurationCNVtime),t.xp6(2),t.hij(" ",t.lcZ(44,21,"Analytics.ResponseDurationtime")," "),t.xp6(3),t.Oqu(n.responseDurationtime))},dependencies:[E.O5,J.x,L.X$],styles:['.chart-wrapper-panoramica[_ngcontent-%COMP%] {\n  padding-top: 15px;\n  padding-bottom: 15px;\n  padding-left: 30px;\n  padding-right: 30px;\n  margin-left: -30px;\n  margin-right: -30px;\n  min-height: 345px;\n  background-color: white;\n}\n\n.chart-title-panoramica[_ngcontent-%COMP%] {\n  padding-bottom: 24px;\n  padding-top: 24px;\n  font-size: 18px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.chart-container[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.card-header-custom-heatmap[_ngcontent-%COMP%] {\n  font-size: 14px;\n  box-shadow: none !important;\n  margin-left: 0px !important;\n  margin-right: 0px !important;\n  border-bottom: 1px solid #eff3f5 !important;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.la-ball-scale-pulse[_ngcontent-%COMP%], .la-ball-scale-pulse[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  position: relative;\n  box-sizing: border-box;\n}\n\n.la-ball-scale-pulse[_ngcontent-%COMP%] {\n  display: block;\n  font-size: 0;\n  color: #fff;\n}\n\n.la-ball-scale-pulse.la-dark[_ngcontent-%COMP%] {\n  color: #333;\n}\n\n.la-ball-scale-pulse[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  display: inline-block;\n  float: none;\n  background-color: currentColor;\n  border: 0 solid currentColor;\n}\n\n.la-ball-scale-pulse[_ngcontent-%COMP%] {\n  width: 32px;\n  height: 32px;\n}\n\n.la-ball-scale-pulse[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 32px;\n  height: 32px;\n  border-radius: 100%;\n  opacity: 0.5;\n  animation: ball-scale-pulse 2s infinite ease-in-out;\n}\n\n.la-ball-scale-pulse[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%]:last-child {\n  animation-delay: -1s;\n}\n\n.la-ball-scale-pulse.la-sm[_ngcontent-%COMP%] {\n  width: 16px;\n  height: 16px;\n}\n\n.la-ball-scale-pulse.la-sm[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  width: 16px;\n  height: 16px;\n}\n\n.la-ball-scale-pulse.la-2x[_ngcontent-%COMP%] {\n  width: 64px;\n  height: 64px;\n}\n\n.la-ball-scale-pulse.la-2x[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  width: 64px;\n  height: 64px;\n}\n\n.la-ball-scale-pulse.la-3x[_ngcontent-%COMP%] {\n  width: 96px;\n  height: 96px;\n}\n\n.la-ball-scale-pulse.la-3x[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  width: 96px;\n  height: 96px;\n}\n\n\n\n@keyframes ball-scale-pulse {\n  0%, 100% {\n    transform: scale(0);\n  }\n  50% {\n    transform: scale(1);\n  }\n}\n\n.clock[_ngcontent-%COMP%] {\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 200px;\n  width: 200px;\n  margin: auto;\n}\n\n.numberCLOCK[_ngcontent-%COMP%] {\n  font-size: 16px;\n  line-height: 0;\n  padding-top: 94px;\n  color: #073f74;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-weight: 400;\n}']}),a})();var st=f(28348);function Oe(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Requests")," "))}function Ye(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Request")," "))}function Me(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Requests")," "))}function Ze(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Request")," "))}function Ue(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Requests")," "))}function qe(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Request")," "))}function Pe(a,l){1&a&&t._UZ(0,"loading-spinner")}function Ve(a,l){if(1&a&&t._UZ(0,"img",35),2&a){const e=t.oxw().$implicit,n=t.oxw(2);t.hYB("src","https://firebasestorage.googleapis.com/v0/b/",n.storageBucket,"/o/profiles%2F",null==e||null==e.id_user?null:e.id_user._id,"%2Fphoto.jpg?alt=media",t.LSH)}}function we(a,l){if(1&a&&t._UZ(0,"img",35),2&a){const e=t.oxw().$implicit,n=t.oxw(2);t.hYB("src","",n.baseUrl,"images?path=uploads%2Fusers%2F",null==e||null==e.id_user?null:e.id_user._id,"%2Fimages%2Fthumbnails_200_200-photo.jpg",t.LSH)}}function Be(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"tr")(1,"td",31),t.NdJ("click",function(){const i=t.CHM(e).$implicit,r=t.oxw(2);return t.KtG(r.goToMemberProfile(null==i?null:i._id))}),t.YNc(2,Ve,1,2,"img",32),t.YNc(3,we,1,2,"img",32),t.qZA(),t.TgZ(4,"td",33),t.NdJ("click",function(){const i=t.CHM(e).$implicit,r=t.oxw(2);return t.KtG(r.goToMemberProfile(null==i?null:i._id))}),t._uU(5),t.qZA(),t.TgZ(6,"td")(7,"span",34),t._uU(8),t.qZA()()()}if(2&a){const e=l.$implicit,n=t.oxw(2);t.xp6(2),t.Q6J("ngIf",n.UPLOAD_ENGINE_IS_FIREBASE),t.xp6(1),t.Q6J("ngIf",!n.UPLOAD_ENGINE_IS_FIREBASE),t.xp6(2),t.AsE(" ",null==e||null==e.id_user?null:e.id_user.firstname," ",null==e||null==e.id_user?null:e.id_user.lastname," "),t.xp6(3),t.hij(" ",null==e?null:e.value,"")}}function Qe(a,l){if(1&a&&(t.TgZ(0,"div",26)(1,"table",27)(2,"thead")(3,"tr"),t._UZ(4,"th")(5,"th")(6,"th"),t.qZA()(),t.TgZ(7,"tbody"),t.YNc(8,Be,9,5,"tr",28),t.qZA()()()),2&a){const e=t.oxw();t.xp6(8),t.Q6J("ngForOf",e.projectUsers)}}function ke(a,l){if(1&a){const e=t.EpF();t.TgZ(0,"tr")(1,"td",36),t.NdJ("click",function(){const i=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.goToEditAddPage_EDIT(null==i?null:i._id))}),t._uU(2),t.qZA(),t.TgZ(3,"td")(4,"span",34),t._uU(5),t.qZA()()()}if(2&a){const e=l.$implicit;t.xp6(2),t.hij(" ",null==e?null:e.name," "),t.xp6(3),t.hij(" ",null==e?null:e.value," ")}}function Ge(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Requests")," "))}function Je(a,l){1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&a&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Request")," "))}let He=(()=>{class a{constructor(e,n,s,i,r,g,m,T){this.usersService=e,this.auth=n,this.departmentService=s,this.router=i,this.wsRequestsService=r,this.appConfigService=g,this.analyticsService=m,this.logger=T,this.users_id_array=[],this.users_reqs_dict={},this.showSpinner=!0}ngOnInit(){this.getCurrentProject(),this.globalServedAndUnservedRequestsCount(),this.getCountOf_AllRequestsForAgent(),this.getCountOf_AllRequestsForDept(),this.getlastMonthRequetsCount(),this.getProfileImageStorage()}getProfileImageStorage(){if("firebase"===this.appConfigService.getConfig().uploadEngine){this.UPLOAD_ENGINE_IS_FIREBASE=!0;const e=this.appConfigService.getConfig().firebase;this.storageBucket=e.storageBucket,this.logger.log("[ANALYTICS - REALTIME] IMAGE STORAGE ",this.storageBucket,"(usecase Firebase)")}else this.UPLOAD_ENGINE_IS_FIREBASE=!1,this.baseUrl=this.appConfigService.getConfig().SERVER_BASE_URL,this.logger.log("[ANALYTICS - REALTIME] IMAGE STORAGE ",this.baseUrl,"usecase native")}ngOnDestroy(){this.logger.log("[ANALYTICS - REALTIME] - !!!!! UN - SUBSCRIPTION TO REQUESTS-LIST-BS"),this.subscription.unsubscribe()}getCurrentProject(){this.auth.project_bs.subscribe(e=>{e&&(this.id_project=e._id)})}globalServedAndUnservedRequestsCount(){this.subscription=this.wsRequestsService.wsRequestsList$.subscribe(e=>{if(this.date=new Date,this.logger.log("[ANALYTICS - REALTIME] globalServedAndUnservedRequestsCount - CURRENT DATE : ",this.date),this.logger.log("[ANALYTICS - REALTIME] globalServedAndUnservedRequestsCount - SUBSCRIBE TO REQUEST SERVICE - GLOBAL REQUESTS LIST: ",e),e){let n=0,s=0;e.forEach(i=>{100===i.status&&(n+=1),200===i.status&&(s+=1)}),this.global_unservedRequestsCount=n,this.logger.log("[ANALYTICS - REALTIME] - # OF GLOBAL UNSERVED REQUESTS:  ",this.global_unservedRequestsCount),this.global_servedRequestsCount=s,this.logger.log("[ANALYTICS - REALTIME] - # OF GLOBAL SERVED REQUESTS:  ",this.global_servedRequestsCount),this.global_activeRequestsCount=this.global_unservedRequestsCount+this.global_servedRequestsCount,this.logger.log("[ANALYTICS - REALTIME] - # OF GLOBAL ACTIVE REQUESTS:  ",this.global_activeRequestsCount)}})}getlastMonthRequetsCount(){this.analyticsService.lastMonthRequetsCount().subscribe(e=>{this.logger.log("[ANALYTICS - REALTIME] - LAST MONTH REQUESTS COUNT - RESPONSE ",e),"undefined"!==e&&e.length>0?(this.lastMonthrequestsCount=e[0].totalCount,this.logger.log("[ANALYTICS - REALTIME] - LAST MONTH REQUESTS COUNT - RESPONSE ",this.lastMonthrequestsCount)):(this.logger.log("[ANALYTICS - REALTIME] - LAST MONTH REQUESTS COUNT - RESPONSE ",this.lastMonthrequestsCount),this.lastMonthrequestsCount=0)},e=>{this.logger.error("[ANALYTICS - REALTIME] - LAST MONTH REQUESTS COUNT - ERROR ",e)},()=>{this.logger.log("[ANALYTICS - REALTIME] - LAST MONTH REQUESTS COUNT * COMPLETE *")})}getCountOf_AllRequestsForAgent(){this.getProjectUsersAndRunFlatMembersArray()}getProjectUsersAndRunFlatMembersArray(){this.usersService.getProjectUsersByProjectId().subscribe(e=>{this.logger.log("[ANALYTICS - REALTIME] - !!!!! PROJECT USERS ARRAY ",e),e&&(this.projectUsers=e,e.forEach(n=>{this.logger.log("[ANALYTICS - REALTIME] - PROJECT USERS RETURNED FROM THE CALLBACK",n);const s=n.id_user._id;this.logger.log("[ANALYTICS - REALTIME] - USER ID ",s),this.users_id_array.push(s)}),this.logger.log("[ANALYTICS - REALTIME] - !!!!! ARRAY OF USERS ID ",this.users_id_array))},e=>{this.logger.error("[ANALYTICS - REALTIME] - !!!!! PROJECT USERS (FILTERED FOR PROJECT ID) - ERROR",e)},()=>{this.logger.log("[ANALYTICS - REALTIME] - !!!!!  PROJECT USERS (FILTERED FOR PROJECT ID) - COMPLETE"),this.getFlatMembersArrayFromAllRequestsAndRunGetOccurrence()})}getFlatMembersArrayFromAllRequestsAndRunGetOccurrence(){this.logger.log("!!! ANALYTICS - !!!!! CALL GET COUNT OF REQUEST FOR AGENT"),this.subscription=this.wsRequestsService.wsRequestsList$.subscribe(e=>{if(this.logger.log("[ANALYTICS - REALTIME] - !!!!! SUBSCRIPTION TO ALL-THE-REQUESTS-LIST-BS"),e){this.logger.log("[ANALYTICS - REALTIME] - !!!!! REQUESTS LENGHT ",e.length);let n=[];for(let s=0;s<e.length;s++)n=n.concat(e[s].participants);if(this.logger.log("[ANALYTICS - REALTIME] - !!!!! FLAT-MEMBERS-ARRAY  ",n),this.logger.log("[ANALYTICS - REALTIME] - !!!!! USER_ID_ARRAY - LENGTH ",this.users_id_array.length),n)for(let s=0;s<this.users_id_array.length;s++)this.logger.log("[ANALYTICS - REALTIME] - !!!!! USER_ID_ARRAY - LENGTH ",this.users_id_array.length),this.getOccurrenceAndAssignToProjectUser(n,this.users_id_array[s])}})}getOccurrenceAndAssignToProjectUser(e,n){this.logger.log("[ANALYTICS - REALTIME] - !!!!! CALLING GET OCCURRENCE REQUESTS FOR AGENT AND ASSIGN TO PROJECT USERS");let s=0;e.forEach(i=>i===n&&s++),this.logger.log("[ANALYTICS - REALTIME] - !!!!! #",s," REQUESTS ASSIGNED TO THE USER ",n);for(const i of this.projectUsers)n===i.id_user._id&&(i.value=s);return this.showSpinner=!1,s}goToMemberProfile(e){this.router.navigate(["project/"+this.id_project+"/user/edit/"+e])}getCountOf_AllRequestsForDept(){this.departmentService.getDeptsByProjectId().subscribe(e=>{this.logger.log("[ANALYTICS - REALTIME] ALL REQUESTS X DEPT - GET DEPTS RESPONSE ",e),this.departments=e;const n=[];this.departments&&this.departments.forEach(s=>{this.logger.log("[ANALYTICS - REALTIME] ALL REQUESTS X DEPT - DEPT ID: ",s._id),n.push(s._id)}),this.logger.log("[ANALYTICS - REALTIME] ALL REQUESTS X DEPT - ARRAY OF DEPTS IDs: ",n),this.subscription=this.wsRequestsService.wsRequestsList$.subscribe(s=>{const i=[];s&&s.forEach(r=>{this.logger.log("[ANALYTICS - REALTIME] ALL REQUESTS X DEPT - g_r ",r),r.department&&i.push(r.department._id)}),n.forEach(r=>{this.getDeptIdOccurrence(i,r)})})},e=>{this.logger.error("[ANALYTICS - REALTIME] ALL REQUESTS X DEPT - GET DEPTS - ERROR: ",e)},()=>{this.logger.log("[ANALYTICS - REALTIME] ALL REQUESTS X DEPT - GET DEPTS * COMPLETE *")})}getDeptIdOccurrence(e,n){let s=0;e.forEach(i=>i===n&&s++),this.logger.log("[ANALYTICS - REALTIME] - ALL REQUESTS X DEPT - #",s," REQUESTS ASSIGNED TO DEPT ",n);for(const i of this.departments)n===i._id&&(i.value=s);return s}goToEditAddPage_EDIT(e){this.logger.log("[ANALYTICS - REALTIME]- ALL REQUESTS X DEPT - GO TO DEPT ID ",e),this.router.navigate(["project/"+this.id_project+"/department/edit",e])}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(P.f),t.Y36(q.e),t.Y36(B.n),t.Y36(G.F0),t.Y36(W.z),t.Y36(K._),t.Y36(M.y),t.Y36(x.m))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-realtime"]],decls:102,vars:54,consts:[[1,"row",2,"text-align","center","margin-top","35px"],[1,"col-md-12"],[1,"section-title"],[1,"row"],[1,"col-xs-12","col-sm-4","col-md-4","col-lg-4"],[1,"card","card-stats",2,"border-radius","10px"],[1,"card-header","tiledesk_card_header"],[1,"card-content",2,"text-align","center"],[1,"card_content_header"],[1,"card_content_header_last_update"],[1,"material-icons","card_content_header_last_update_icons"],[1,"request_count",2,"color","#ff9800"],[1,"request_count_icons_numbers"],[2,"color","#ff9800"],[4,"ngIf"],[1,"card-footer","request_count_footer"],[1,"request_count",2,"color","#00bcd4"],[2,"color","#00bcd4"],[1,"request_count",2,"color","#f44336"],[2,"color","#f44336"],[1,"col-md-4"],[1,"card"],[1,"card-header","card-header-custom",2,"background-color","#fff","padding-top","12px","padding-bottom","10px"],[1,"c21-title",2,"margin-bottom","2px","margin-top","2px"],["class","card-content table-responsive","style","padding-top: 0px",4,"ngIf"],[1,"card",2,"border-radius","10px"],[1,"card-content","table-responsive",2,"padding-top","0px"],[1,"table","table-hover"],[4,"ngFor","ngForOf"],[1,"card","card-stats",2,"border-radius","10px","margin-top","0px"],[1,"card-footer","request_count_footer",2,"margin-bottom","11px"],[2,"width","45px","padding-top","4px !important","padding-bottom","4px!important","cursor","pointer",3,"click"],["class","user-img-in-realtime-analytics","onerror","this.src='assets/img/no_image_user.png'",3,"src",4,"ngIf"],[2,"font-weight","400","cursor","pointer",3,"click"],[2,"font-weight","400"],["onerror","this.src='assets/img/no_image_user.png'",1,"user-img-in-realtime-analytics",3,"src"],[2,"cursor","pointer","font-weight","400",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h4",2),t._uU(3),t.ALo(4,"translate"),t.qZA()()(),t.TgZ(5,"div",3)(6,"div",4)(7,"div",5),t._UZ(8,"div",6),t.TgZ(9,"div",7)(10,"p",8)(11,"span",9)(12,"i",10),t._uU(13," update "),t.qZA(),t._uU(14),t.ALo(15,"translate"),t.ALo(16,"amTimeAgo"),t.qZA()(),t.TgZ(17,"div",11)(18,"span",12),t._uU(19),t.qZA()(),t.TgZ(20,"span",13),t.YNc(21,Oe,3,3,"span",14),t.YNc(22,Ye,3,3,"span",14),t.qZA()(),t.TgZ(23,"div",15),t._uU(24),t.ALo(25,"translate"),t.qZA()()(),t.TgZ(26,"div",4)(27,"div",5),t._UZ(28,"div",6),t.TgZ(29,"div",7)(30,"p",8)(31,"span",9)(32,"i",10),t._uU(33," update "),t.qZA(),t._uU(34),t.ALo(35,"translate"),t.ALo(36,"amTimeAgo"),t.qZA()(),t.TgZ(37,"div",16)(38,"span",12),t._uU(39),t.qZA()(),t.TgZ(40,"span",17),t.YNc(41,Me,3,3,"span",14),t.YNc(42,Ze,3,3,"span",14),t.qZA()(),t.TgZ(43,"div",15),t._uU(44),t.ALo(45,"translate"),t.qZA()()(),t.TgZ(46,"div",4)(47,"div",5),t._UZ(48,"div",6),t.TgZ(49,"div",7)(50,"p",8)(51,"span",9)(52,"i",10),t._uU(53," update "),t.qZA(),t._uU(54),t.ALo(55,"translate"),t.ALo(56,"amTimeAgo"),t.qZA()(),t.TgZ(57,"div",18)(58,"span",12),t._uU(59),t.qZA()(),t.TgZ(60,"span",19),t.YNc(61,Ue,3,3,"span",14),t.YNc(62,qe,3,3,"span",14),t.qZA()(),t.TgZ(63,"div",15),t._uU(64),t.ALo(65,"translate"),t.qZA()()()(),t.TgZ(66,"div",3)(67,"div",20)(68,"div",21)(69,"div",22)(70,"h4",23),t._uU(71),t.ALo(72,"translate"),t.qZA()(),t.YNc(73,Pe,1,0,"loading-spinner",14),t.YNc(74,Qe,9,1,"div",24),t.qZA()(),t.TgZ(75,"div",20)(76,"div",25)(77,"div",22)(78,"h4",23),t._uU(79),t.ALo(80,"translate"),t.qZA()(),t.TgZ(81,"div",26)(82,"table",27)(83,"thead")(84,"tr"),t._UZ(85,"th")(86,"th"),t.qZA()(),t.TgZ(87,"tbody"),t.YNc(88,ke,6,2,"tr",28),t.qZA()()()()(),t.TgZ(89,"div",20)(90,"div",29),t._UZ(91,"div",6),t.TgZ(92,"div",7)(93,"div",11)(94,"span",12),t._uU(95),t.qZA()(),t.TgZ(96,"span",13),t.YNc(97,Ge,3,3,"span",14),t.YNc(98,Je,3,3,"span",14),t.qZA()(),t.TgZ(99,"div",30),t._uU(100),t.ALo(101,"translate"),t.qZA()()()()),2&e&&(t.xp6(3),t.hij(" ",t.lcZ(4,28,"Analytics.RealTimeMonitoring")," "),t.xp6(11),t.AsE(" ",t.lcZ(15,30,"Updated"),": ",t.lcZ(16,32,n.date)," "),t.xp6(5),t.hij(" ",n.global_activeRequestsCount," "),t.xp6(2),t.Q6J("ngIf",n.global_activeRequestsCount>1||0==n.global_activeRequestsCount),t.xp6(1),t.Q6J("ngIf",1==n.global_activeRequestsCount),t.xp6(2),t.hij(" ",t.lcZ(25,34,"TotalActive")," "),t.xp6(10),t.AsE(" ",t.lcZ(35,36,"Updated"),": ",t.lcZ(36,38,n.date)," "),t.xp6(5),t.hij(" ",n.global_servedRequestsCount," "),t.xp6(2),t.Q6J("ngIf",n.global_servedRequestsCount>1||0==n.global_servedRequestsCount),t.xp6(1),t.Q6J("ngIf",1==n.global_servedRequestsCount),t.xp6(2),t.hij(" ",t.lcZ(45,40,"Served")," "),t.xp6(10),t.AsE(" ",t.lcZ(55,42,"Updated"),": ",t.lcZ(56,44,n.date)," "),t.xp6(5),t.hij(" ",n.global_unservedRequestsCount," "),t.xp6(2),t.Q6J("ngIf",n.global_unservedRequestsCount>1||0==n.global_unservedRequestsCount),t.xp6(1),t.Q6J("ngIf",1==n.global_unservedRequestsCount),t.xp6(2),t.hij(" ",t.lcZ(65,46,"Unserved")," "),t.xp6(7),t.hij(" ",t.lcZ(72,48,"RequestsForAgent")," "),t.xp6(2),t.Q6J("ngIf",n.showSpinner),t.xp6(1),t.Q6J("ngIf",!n.showSpinner),t.xp6(5),t.hij(" ",t.lcZ(80,50,"RequestsForDept")," "),t.xp6(9),t.Q6J("ngForOf",n.departments),t.xp6(7),t.hij(" ",n.lastMonthrequestsCount," "),t.xp6(2),t.Q6J("ngIf",n.lastMonthrequestsCount>1||0==n.lastMonthrequestsCount),t.xp6(1),t.Q6J("ngIf",1==n.lastMonthrequestsCount),t.xp6(2),t.hij(" ",t.lcZ(101,52,"LastMonth")," "))},dependencies:[E.sg,E.O5,X.g,L.X$,st.eG],styles:['.tiledesk_card_header[_ngcontent-%COMP%] {\n  padding: 0px !important;\n  box-shadow: none !important;\n  width: 0;\n  height: 0 !important;\n  position: relative !important;\n  top: 24px !important;\n}\n\n.card_content_header[_ngcontent-%COMP%] {\n  text-align: right;\n}\n\n.card-header_icon[_ngcontent-%COMP%] {\n  background-color: #ffffff !important;\n  font-size: 46px;\n}\n\n.card_content_header_last_update[_ngcontent-%COMP%] {\n  text-align: right;\n  line-height: 22px;\n  color: #999999;\n  font-size: 12px;\n  top: 10px;\n  position: relative;\n}\n\n.card_content_header_last_update_icons[_ngcontent-%COMP%] {\n  font-size: 16px;\n  position: relative;\n  top: 4px;\n}\n\n.request_count[_ngcontent-%COMP%] {\n  font-size: 72px;\n  line-height: 72px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  margin-top: 35px;\n}\n\n.request_count_icons[_ngcontent-%COMP%] {\n  font-size: 46px;\n  position: relative;\n  top: 1px;\n  left: -52px;\n}\n\n.request_count_footer[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  color: rgba(0, 0, 0, 0.54);\n  text-align: center;\n}\n\n.c21-title[_ngcontent-%COMP%] {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  color: rgba(0, 0, 0, 0.54);\n}\n\n.user-img-in-realtime-analytics[_ngcontent-%COMP%] {\n  vertical-align: middle;\n  width: 32px;\n  height: 32px;\n  border-radius: 50%;\n  border: 1px solid #eee;\n  margin-right: 15px;\n  object-fit: cover;\n}']}),a})();function je(a,l){1&a&&t._UZ(0,"appdashboard-panoramica")}function ze(a,l){if(1&a&&t._UZ(0,"appdashboard-metrics",7),2&a){const e=t.oxw();t.Q6J("autoselected",e.childToSelect)}}function Fe(a,l){1&a&&t._UZ(0,"appdashboard-realtime")}const We=function(a){return{"margin-top":a}},z=function(a,l){return{"li-active":a,"border-from-center":l}};let Ke=(()=>{class a{constructor(e,n,s,i,r,g,m,T){this.auth=e,this.router=n,this.translate=s,this.analyticsService=i,this.wsRequestsService=r,this.appConfigService=g,this.logger=m,this.roleService=T,this.users_id_array=[],this.users_reqs_dict={},this.showSpinner=!0,this.customData=[],this.xlabel_ita=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],this.xlabel_eng=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],this.ylabel_ita=["01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"],this.ylabel_eng=["1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","12am","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"],this.langService=new N.b,this.humanizer=new N.f(this.langService),this.showTooltip=!0,this.selected="panoramica",this.logger.log("[ANALYTICS] !!! \xbb\xbb\xbb HELLO ANALYTICS \xbb\xbb\xbb "),this.getBrowserLangAndSwitchMonthName(),this.getCurrentUrl(),this.getBrowserVersion()}getBrowserVersion(){this.auth.isChromeVerGreaterThan100.subscribe(e=>{this.isChromeVerGreaterThan100=e})}setMomentLocale(){this.browserLang=this.translate.getBrowserLang();const e=localStorage.getItem(this.auth.user_bs.value._id+"_lang");let n="";this.browserLang&&!e?n=this.browserLang:this.browserLang&&e&&(n=e),this.logger.log("[ANALYTICS] - setMomentLocale dshbrd_lang",n),o().locale(n);const s=o().weekdaysShort();s.push(s.shift())}getCurrentUrl(){const e=this.router.url;this.logger.log("[ANALYTICS]  - currentUrl ",e);const n=e.split("/");this.logger.log("[ANALYTICS]  - url_segments ",n),5===n.length&&"metrics"===n[4]&&(this.selected="metriche"),6===n.length&&"metrics"===n[4]&&(this.selected="metriche",this.childToSelect=n[5])}goTo(e){this.selected=e,this.logger.log("[ANALYTICS] Move to:",e)}getBrowserLangAndSwitchMonthName(){const e=this.translate.getBrowserLang();this.logger.log("[ANALYTICS]  - BROWSER LANG ",e),e&&(this.monthNames="it"===e?{1:"Gen",2:"Feb",3:"Mar",4:"Apr",5:"Mag",6:"Giu",7:"Lug",8:"Ago",9:"Set",10:"Ott",11:"Nov",12:"Dic"}:{1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"})}ngOnInit(){this.roleService.checkRoleForCurrentProject("analytics"),this.analyticsService.richieste_bs.subscribe(e=>{this.logger.log("[ANALYTICS] CLICK hasClickedOnGraph:",e),this.logger.log("[ANALYTICS] Has click graph title... move to METRICHE"),e&&(this.selected="metriche")}),this.getCurrentProject(),this.getStorageBucket()}getCurrentProject(){this.auth.project_bs.subscribe(e=>{e&&(this.id_project=e._id)})}getStorageBucket(){const e=this.appConfigService.getConfig().firebase;this.storageBucket=e.storageBucket,this.logger.log("[ANALYTICS] STORAGE-BUCKET Analytics2 List ",this.storageBucket)}translateHours(){this.translate.get("hours").subscribe(e=>{this.translatedHoursString=e,this.logger.log("[ANALYTICS] - AVERAGE WAIT - translatedHoursString ",e)})}translateMinutes(){this.translate.get("minutes").subscribe(e=>{this.translatedMinutesString=e,this.logger.log("[ANALYTICS] - AVERAGE WAIT - translatedMinutesString ",e)})}translateSeconds(){this.translate.get("seconds").subscribe(e=>{this.translatedSecondsString=e,this.logger.log("[ANALYTICS] - AVERAGE WAIT - translatedSecondsString ",e)})}getMaxOfArray(e){return Math.max.apply(null,e)}goToEditAddPage_EDIT(e){this.logger.log("[ANALYTICS] - ALL REQUESTS X DEPT - GO TO DEPT ID ",e),this.router.navigate(["project/"+this.id_project+"/department/edit",e])}ngOnDestroy(){this.logger.log("[ANALYTICS] - !!!!! UN - SUBSCRIPTION TO REQUESTS-LIST-BS")}buildgraph(){this.browserLang=this.translate.getBrowserLang(),this.logger.log("[ANALYTICS] buildgraph LANGUAGE ",this.browserLang),this.cellSettings={border:{radius:4,width:1,color:"white"},showLabel:!1},this.paletteSettings={palette:[{color:"#a0d4e9"},{color:"#5fa3f1"},{color:"#5187ed"},{color:"#254594"}]},this.analyticsService.getDataHeatMap().subscribe(e=>{const n=e;this.logger.log("[ANALYTICS] getDataHeatMap data from servoice->",e),"it"===this.browserLang?(this.weekday={1:"Lun",2:"Mar",3:"Mer",4:"Gio",5:"Ven",6:"Sab",7:"Dom"},this.hour={1:"01:00",2:"02:00",3:"03:00",4:"04:00",5:"05:00",6:"06:00",7:"07:00",8:"08:00",9:"09:00",10:"10:00",11:"11:00",12:"12:00",13:"13:00",14:"14:00",15:"15:00",16:"16:00",17:"17:00",18:"18:00",19:"19:00",20:"20:00",21:"21:00",22:"22:00",23:"23:00"},this.yAxis={labels:this.ylabel_ita},this.xAxis={labels:this.xlabel_ita},this.titleSettings={text:"Utenti per ora del giorno",textStyle:{size:"15px",fontWeight:"500",fontStyle:"Normal"}}):(this.weekday={1:"Mon",2:"Tue",3:"Wed",4:"The",5:"Fri",6:"Sat",7:"Sun"},this.hour={1:"1am",2:"2am",3:"3am",4:"4am",5:"5am",6:"6am",7:"7am",8:"8am",9:"9am",10:"10am",11:"11am",12:"12am",13:"1pm",14:"2pm",15:"3pm",16:"4pm",17:"5pm",18:"6pm",19:"7pm",20:"8pm",21:"9pm",22:"10pm",23:"11pm"},this.yAxis={labels:this.ylabel_eng},this.xAxis={labels:this.xlabel_eng},this.titleSettings={text:"User per hour of day",textStyle:{size:"15px",fontWeight:"500",fontStyle:"Normal"}});for(let s in n)this.customData.push({_id:{hour:this.hour[n[s]._id.hour],weekday:this.weekday[n[s]._id.weekday]},count:n[s].count});this.logger.log("[ANALYTICS] getDataHeatMap customData",this.customData),this.dataSource={data:this.customData,isJsonData:!0,adaptorType:"Cell",yDataMapping:"_id.hour",xDataMapping:"_id.weekday",valueMapping:"count"}})}humanizeDurations(e){let n;if(e)return"en"==this.browserLang?(n=Math.round(e/31104e6))>0?n=1===n?n+" Year":n+" Years":(n=Math.round(e/2592e6))>0?n=1===n?n+" Month":n+" Months":(n=Math.round(e/864e5))>0?n=1===n?n+" Day":n+" Days":(n=Math.round(e/36e5))>0?n+=" Hours":n=(n=Math.round(e/6e4))>0?1===n?n+" Minute":n+" Minutes":(n=Math.round(e/1e3))>0?1===n?n+" Second":n+" Seconds":e+" Millisec":n=(n=Math.round(e/31104e6))>0?1===n?n+" Anno":n+" Anni":(n=Math.round(e/2592e6))>0?1===n?n+" Mese":n+" Mesi":(n=Math.round(e/864e5))>0?1===n?n+" Giorno":n+" Giorni":(n=Math.round(e/36e5))>0?1===n?n+" Ora":n+" Ore":(n=Math.round(e/6e4))>0?1===n?n+" Minuto":n+" Minuti":(n=Math.round(e/1e3))>0?1===n?n+" Secondo":n+" Secondi":e+" Millisecondi",n}avarageWaitingTimeCLOCK(){this.analyticsService.getDataAVGWaitingCLOCK().subscribe(e=>{let n;var s;e&&0!=e.length?(n=this.humanizeDurations(e[0].waiting_time_avg),s=this.humanizeDurations(e[0].waiting_time_avg).split(" "),this.numberAVGtime=s[0],this.unitAVGtime=s[1],this.responseAVGtime=this.humanizer.humanize(e[0].waiting_time_avg,{round:!0,language:this.browserLang}),this.logger.log("[ANALYTICS] avarageWaitingTimeCLOCK Waiting time: humanize",this.humanizer.humanize(e[0].waiting_time_avg)),this.logger.log("[ANALYTICS] avarageWaitingTimeCLOCK waiting time funtion:",n)):(this.numberAVGtime="n/a",this.unitAVGtime="",this.responseAVGtime="n/a",this.logger.log("[ANALYTICS] avarageWaitingTimeCLOCK humanize",this.humanizer.humanize(0)),this.logger.log("[ANALYTICS] avarageWaitingTimeCLOCK waiting time funtion:",n))},e=>{this.logger.error("[ANALYTICS] avarageWaitingTimeCLOCK - AVERAGE WAITING TIME REQUEST - ERROR ",e)},()=>{this.logger.log("[ANALYTICS] avarageWaitingTimeCLOCK - AVERAGE TIME REQUEST * COMPLETE *")})}avgTimeResponsechart(){this.analyticsService.getavarageWaitingTimeDataCHART(30,"").subscribe(e=>{if(this.logger.log("[ANALYTICS] avgTimeResponsechart chart data:",e),e){const s=[];for(let g=0;g<=30;g++)s.push({date:o()().subtract(g,"d").format("D/M/YYYY"),value:0});s.reverse(),this.dateRangeAvg=s[0].date.split(-4)+" - "+s[30].date,this.logger.log("[ANALYTICS] avgTimeResponsechart - REQUESTS BY DAY - MOMENT LAST 30 DATE (init array)",s);const i=[];for(let g=0;g<i.length;g++)i[g]&&(null==e[g].waiting_time_avg&&(e[g].waiting_time_avg=0),i.push({date:new Date(e[g]._id.year,e[g]._id.month-1,e[g]._id.day).toLocaleDateString(),value:e[g].waiting_time_avg}));this.logger.log("[ANALYTICS] avgTimeResponsechart Custom data:",i);const r=s.map(g=>i.find(m=>m.date===g.date)||g);this.logger.log("[ANALYTICS] avgTimeResponsechart - FINAL ARRAY ",r),this.xValueAVGchart=r.map(function(g){return g.date}),this.yValueAVGchart=r.map(function(g){return g.value}),this.logger.log("[ANALYTICS] Xlabel-AVERAGE TIME",this.xValueAVGchart),this.logger.log("[ANALYTICS] Ylabel-AVERAGE TIME",this.yValueAVGchart)}else this.logger.error("[ANALYTICS]  !!!ERROR!!! while get data from resouces for waiting avg time graph");new D.Chart("avgTimeResponse",{type:"line",data:{labels:this.xValueAVGchart,datasets:[{label:"Average time response in last 30 days ",data:this.yValueAVGchart,fill:!0,lineTension:.1,backgroundColor:"rgba(255, 255, 255, 0.7)",borderColor:"rgba(255, 255, 255, 0.7)",borderWidth:3,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"rgba(255, 255, 255, 0.8)"}]},options:{title:{text:"AVERAGE TIME RESPONSE",display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,minRotation:30,fontColor:"white"},gridLines:{display:!0,color:"rgba(255, 255, 255, 0.5)",borderDash:[3,1]}}],yAxes:[{gridLines:{display:!0,color:"rgba(255, 255, 255, 0.5)",borderDash:[3,1]},ticks:{beginAtZero:!0,display:!0,fontColor:"white",callback:function(s,i,r){return Math.floor(s/36e5)+"h:"+Math.floor(s%36e5/6e4)+"m:"+Math.floor(s%36e4%6e4/1e3)+"s"}}}]},tooltips:{callbacks:{label:function(s,i){const r=s.yLabel;let g=new N.b,m=new N.f(g);return m.setOptions({round:!0}),i.datasets[s.datasetIndex].label+": "+m.humanize(r)}}}},plugins:[{beforeDraw:function(s,i){s.chart.ctx.font="Roboto"}}]})})}durationConvTimeCLOCK(){this.analyticsService.getDurationConversationTimeDataCLOCK().subscribe(e=>{if(e){this.humanizer.setOptions({round:!0});const s=this.humanizeDurations(e[0].duration_avg);var n=this.humanizeDurations(e[0].duration_avg).split(" ");this.numberDurationCNVtime=n[0],this.unitDurationCNVtime=n[1];const i=this.translate.getBrowserLang();i?(this.responseDurationtime="it"==i?"La durata di conversazione media complessiva del tuo team \xe8 "+this.humanizer.humanize(e[0].duration_avg,{language:"it"}):"Your team's overall Median Conversation Lenght is "+this.humanizer.humanize(e[0].duration_avg,{language:"en"}),this.logger.log("[ANALYTICS] durationConvTimeCLOCK Waiting time: humanize",this.humanizer.humanize(e[0].duration_avg)),this.logger.log("[ANALYTICS] durationConvTimeCLOCK waiting time funtion:",s)):this.logger.error("[ANALYTICS] durationConvTimeCLOCK !!!ERROR!!! while get resources for waiting avarage time ")}})}durationConversationTimeCHART(){this.analyticsService.getDurationConversationTimeDataCHART(30,"").subscribe(e=>{if(e){this.logger.log("[ANALYTICS] durationConversationTimeCHART resp",e);const s=[];for(let g=0;g<=30;g++)s.push({date:o()().subtract(g,"d").format("D/M/YYYY"),value:0});s.reverse(),this.dataRangeDuration=s[0].date+" - "+s[30].date,this.logger.log("[ANALYTICS] - REQUESTS DURATION CONVERSATION BY DAY - MOMENT LAST 30 DATE (init array)",s);const i=[];for(let g in e)null==e[g].duration_avg&&(e[g].duration_avg=0),i.push({date:new Date(e[g]._id.year,e[g]._id.month-1,e[g]._id.day).toLocaleDateString(),value:e[g].duration_avg});this.logger.log("[ANALYTICS] Custom Duration COnversation data:",i);const r=s.map(g=>i.find(m=>m.date===g.date)||g);this.logger.log("[ANALYTICS] - REQUESTS DURATION CONVERSATION BY DAY - FINAL ARRAY ",r),this.xValueDurationConversation=r.map(function(g){return g.date}),this.yValueDurationConversation=r.map(function(g){return g.value}),this.logger.log("[ANALYTICS] Xlabel-DURATION",this.xValueDurationConversation),this.logger.log("[ANALYTICS] Ylabel-DURATION",this.yValueDurationConversation)}else this.logger.error("[ANALYTICS] !!!ERROR!!! while get data from resouces for duration conversation time graph");new D.Chart("durationConversationTimeResponse",{type:"bar",data:{labels:this.xValueDurationConversation,datasets:[{label:"Average duration conversation time response in last 30 days ",data:this.yValueDurationConversation,fill:!1,lineTension:.1,borderColor:"#1e88e5",backgroundColor:"#1e88e5",borderWidth:5}]},options:{title:{text:"DURATION CONVERSATION TIME RESPONSE",display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,minRotation:30}}],yAxes:[{ticks:{beginAtZero:!0,display:!0,callback:function(s,i,r){return Math.floor(s/36e5)+"h:"+Math.floor(s%36e5/6e4)+"m:"+Math.floor(s%36e4%6e4/1e3)+"s"}}}]},tooltips:{callbacks:{label:function(s,i){const r=s.yLabel;let g=new N.b,m=new N.f(g);return m.setOptions({round:!0}),i.datasets[s.datasetIndex].label+": "+m.humanize(r)}}}}})})}}return a.\u0275fac=function(e){return new(e||a)(t.Y36(q.e),t.Y36(G.F0),t.Y36(L.sK),t.Y36(M.y),t.Y36(W.z),t.Y36(K._),t.Y36(x.m),t.Y36($.N))},a.\u0275cmp=t.Xpm({type:a,selectors:[["appdashboard-analytics2"]],decls:21,vars:30,consts:[[1,"navbar-brand",2,"padding-left","40px","position","relative","z-index","1050",3,"ngStyle"],[1,"bottom-nav-analytics"],[1,"btn-with-border-effect",3,"ngClass","click"],[1,"main-content",2,"padding-top","0px","padding-left","15px"],[1,"container-fluid"],[4,"ngIf"],[3,"autoselected",4,"ngIf"],[3,"autoselected"]],template:function(e,n){1&e&&(t.TgZ(0,"p",0),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"ul",1)(4,"li",2),t.NdJ("click",function(){return n.goTo("panoramica")}),t.TgZ(5,"a"),t._uU(6),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"li",2),t.NdJ("click",function(){return n.goTo("metriche")}),t.TgZ(9,"a"),t._uU(10),t.ALo(11,"translate"),t.qZA()(),t.TgZ(12,"li",2),t.NdJ("click",function(){return n.goTo("realtime")}),t.TgZ(13,"a"),t._uU(14),t.ALo(15,"translate"),t.qZA()()(),t.TgZ(16,"div",3)(17,"div",4),t.YNc(18,je,1,0,"appdashboard-panoramica",5),t.YNc(19,ze,1,1,"appdashboard-metrics",6),t.YNc(20,Fe,1,0,"appdashboard-realtime",5),t.qZA()()),2&e&&(t.Q6J("ngStyle",t.VKq(19,We,!0===n.isChromeVerGreaterThan100?"-64px":"6px")),t.xp6(1),t.hij(" ",t.lcZ(2,11,"Analytics.AnalyticsTITLE"),"\n"),t.xp6(3),t.Q6J("ngClass",t.WLB(21,z,"panoramica"===n.selected,"panoramica"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(7,13,"Analytics.PanoramicaComponentTitle")),t.xp6(2),t.Q6J("ngClass",t.WLB(24,z,"metriche"===n.selected,"metriche"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(11,15,"Analytics.MetricsComponentTitle")),t.xp6(2),t.Q6J("ngClass",t.WLB(27,z,"realtime"===n.selected,"realtime"!==n.selected)),t.xp6(2),t.Oqu(t.lcZ(15,17,"Analytics.RealTimeComponentTitle")),t.xp6(4),t.Q6J("ngIf","panoramica"==n.selected),t.xp6(1),t.Q6J("ngIf","metriche"==n.selected),t.xp6(1),t.Q6J("ngIf","realtime"==n.selected))},dependencies:[E.mk,E.O5,E.PC,ve,De,He,L.X$],styles:['/* ANIMATION */\n/* SHADOWS */\n#heatmap-container_HeatmapBorder {\n  fill: none;\n}\n.tiledesk_card_header {\n  padding: 0px !important;\n  box-shadow: none !important;\n  width: 0;\n  height: 0 !important;\n  position: relative !important;\n  top: 24px !important;\n}\n.card_content_header {\n  text-align: right;\n}\n.card-header_icon {\n  background-color: #ffffff !important;\n  font-size: 46px;\n}\n.card_content_header_last_update {\n  text-align: right;\n  line-height: 22px;\n  color: #999999;\n  font-size: 12px;\n  top: 10px;\n  position: relative;\n}\n.card_content_header_last_update_icons {\n  font-size: 16px;\n  position: relative;\n  top: 4px;\n}\n.request_count {\n  font-size: 72px;\n  line-height: 72px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  margin-top: 35px;\n}\n.request_count_icons {\n  font-size: 46px;\n  position: relative;\n  top: 1px;\n  left: -52px;\n}\n.request_count_footer {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  color: rgba(0, 0, 0, 0.54);\n  text-align: center;\n}\n.c21-title {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  color: rgba(0, 0, 0, 0.54);\n}\n.card-header-custom {\n  box-shadow: none !important;\n  margin-left: 0px !important;\n  margin-right: 0px !important;\n  border-bottom: 1px solid #eff3f5 !important;\n}\n.chart-wrapper {\n  background-color: #ffffff;\n  padding-top: 15px;\n  padding-bottom: 15px;\n  padding-left: 30px;\n  padding-right: 30px;\n  margin-left: -30px;\n  margin-right: -30px;\n  min-height: 345px;\n}\n.chart-title {\n  padding-bottom: 24px;\n  padding-top: 24px;\n  font-size: 18px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n.ct-label {\n  color: rgb(255, 255, 255) !important;\n}\n.ct-line {\n  stroke: rgba(255, 255, 255, 0.7) !important;\n}\n.ct-series-a .ct-point {\n  stroke: rgba(255, 255, 255, 0.8) !important;\n}\n.ct-grid {\n  stroke: rgba(255, 255, 255, 0.5) !important;\n}\n.clock {\n  background-image: url(\'stopwatch.08b1fe7bd8b483b0.png\');\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 200px;\n  width: 200px;\n  margin: auto;\n}\n.star {\n  background-image: url(\'star-blue.963567bac1a58a80.png\');\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: contain;\n  height: 200px;\n  width: 200px;\n  margin: auto;\n}\n.heart {\n  background-image: url(\'heart.16725dea8d174c35.png\');\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  height: 160px;\n  width: 160px;\n  margin: auto;\n}\n.chart-container {\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n@media (max-width: 991px) {\n  .bottom-nav-analytics li {\n    top: -6px !important;\n    z-index: 1049;\n  }\n  .chart-wrapper {\n    margin-top: 60px !important;\n  }\n}\n@media (max-width: 370px) {\n  .bottom-nav-analytics {\n    height: 37px !important;\n  }\n  .bottom-nav-analytics li {\n    padding: 6px !important;\n    height: 39px;\n  }\n}'],encapsulation:2}),a})();var $e=f(31449),Xe=f(98833),tn=f(47423),en=f(90508),nn=f(20773);const sn=[{path:"",component:Ke}];let an=(()=>{class a{}return a.\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[G.Bz.forChild(sn),E.ez,L.aw,$e.m,v.A0,st._G,I.u5,I.UX,J.X,tt.AV,U.FA,H.lN,Xe.c,et.Ps,tn.ot,en.XK,nn.Cq,G.Bz]}),a})()}}]);