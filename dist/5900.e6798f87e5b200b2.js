"use strict";(self.webpackChunkchat21=self.webpackChunkchat21||[]).push([[5900],{15900:(F,d,a)=>{a.r(d),a.d(d,{NotificationEmailModule:()=>y});var r=a(69808),T=a(354),h=a(87341),E=a(48616),I=a(44034),t=a(5e3),f=a(22313),p=a(51062),c=a(93075),m=a(53251),u=a(1533);function A(i,o){1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij("",t.lcZ(2,1,"Settings")," "))}const _=function(i){return{"tab-active-color":i}};function M(i,o){if(1&i){const e=t.EpF();t.TgZ(0,"a",20),t.NdJ("click",function(){const s=t.CHM(e).$implicit,g=t.oxw();return t.KtG(g.selectedTemplate(s))}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=o.$implicit,n=t.oxw();t.Q6J("active",e===n.active_template)("ngClass",t.VKq(5,_,e===n.active_template)),t.xp6(1),t.hij(" ",t.lcZ(2,3,e)," ")}}function v(i,o){1&i&&(t.TgZ(0,"div",21),t._UZ(1,"div",22)(2,"div",23)(3,"div",24)(4,"div",25)(5,"div",26),t.qZA())}const O=function(i){return{"margin-top":i}},C=function(i,o){return{is_opened:i,is_closed:o}},N=function(i,o){return{"page-title--sidebar-settings_opened":i,"page-title--sidebar-settings_closed":o}};let b=(()=>{class i{constructor(e,n,l,s,g,w,B){this.location=e,this.projectService=n,this.sanitizer=l,this.translate=s,this.auth=g,this.logger=w,this.notify=B,this.EMAIL_TEMPLATE_NAME=["assignedRequest","assignedEmailMessage","pooledRequest","pooledEmailMessage","newMessage","ticket","sendTranscript","emailDirect","newMessageFollower"],this.active_template="assignedRequest"}ngOnInit(){this.subscribeToCurrentProjectAndGetProjectById(),this.logger.log("[NOTIFICATION-EMAIL] - GET EMAIL TEMPALTE - ACTIVE TEMPLATE ",this.active_template),this.getTranslations(),this.getBrowserVersion(),this.listenSidebarIsOpened()}listenSidebarIsOpened(){this.auth.settingSidebarIsOpned.subscribe(e=>{this.logger.log("[NOTIFICATION-EMAIL] SETTNGS-SIDEBAR isopened (FROM SUBSCRIPTION) ",e),this.IS_OPEN_SETTINGS_SIDEBAR=e})}getBrowserVersion(){this.auth.isChromeVerGreaterThan100.subscribe(e=>{this.isChromeVerGreaterThan100=e})}getTranslations(){this.translate.get("AnErrorHasOccurred").subscribe(e=>{this.anErrorHasOccurredMsg=e}),this.translate.get("EmailTemplateUpdatedSuccessfully").subscribe(e=>{this.emailTemplateUpdatedSuccessfullyMsg=e})}subscribeToCurrentProjectAndGetProjectById(){this.auth.project_bs.subscribe(e=>{e&&(this.projectId=e._id,this.logger.log("[NOTIFICATION-EMAIL] - projectId ",this.projectId),this.getProjectById(this.projectId))})}getProjectById(e){this.projectService.getProjectById(e).subscribe(n=>{this.logger.log("[NOTIFICATION-EMAIL] - GET PROJECT BY ID - project ",n),n&&n.settings&&n.settings.email&&n.settings.email.templates?(this.logger.log("[NOTIFICATION-EMAIL] - GET PROJECT BY ID - project.settings.email.templates ",n.settings.email.templates),n.settings.email.templates.hasOwnProperty(this.active_template)?(this.logger.log("[NOTIFICATION-EMAIL] - GET PROJECT BY ID - project.settings.email.templates hasOwnProperty ",this.active_template),this.emailTemplate=n.settings.email.templates[this.active_template],document.getElementById("iframe-email-template-preview")&&(document.getElementById("iframe-email-template-preview").srcdoc=this.emailTemplate)):(this.logger.log("[NOTIFICATION-EMAIL] - GET PROJECT BY ID - project.settings.email.templates NOT hasOwnProperty ",this.active_template,"RUN GET DEFAULT TEMPLATE"),this.getAssignedRequestTemplate())):(this.logger.log("[NOTIFICATION-EMAIL] - GET PROJECT BY ID - NOT EXIST project.settings.email.templates "),this.getAssignedRequestTemplate())},n=>{this.logger.error("[NOTIFICATION-EMAIL] - GET PROJECT BY ID - ERROR ",n)},()=>{this.logger.log("[NOTIFICATION-EMAIL] - getProjectByID * complete ")})}getAssignedRequestTemplate(){this.projectService.getEmailTemplate(this.active_template).subscribe(e=>{this.logger.log("[NOTIFICATION-EMAIL] - GET EMAIL TEMPALTE res ",e),e&&e.template&&(this.emailTemplate=e.template,document.getElementById("iframe-email-template-preview")&&(document.getElementById("iframe-email-template-preview").srcdoc=this.emailTemplate))},e=>{this.logger.error("[NOTIFICATION-EMAIL] - GET EMAIL TEMPALTE error ",e)},()=>{this.logger.log("[NOTIFICATION-EMAIL] - GET EMAIL TEMPALTE  * COMPLETE *")})}ngAfterViewInit(){this.disableIframeLinks(),this.getTranslationsAndSetIframePlaceholder()}getTranslationsAndSetIframePlaceholder(){this.translate.get("ProjectEditPage.SeeThePreviewOfTheEmail").subscribe(e=>{this.logger.log("[NOTIFICATION-EMAIL] - GET TRANSLATION - text ",e),this.iframePlaceholderText=e})}disableIframeLinks(){$("iframe").on("load",function(){$("iframe").contents().find("a").each(function(e){$(this).on("click",function(n){n.preventDefault(),n.stopPropagation()})})})}goBack(){this.location.back()}selectedTemplate(e){this.logger.log("[NOTIFICATION-EMAIL] - GET EMAIL TEMPALTE - SELECTED TEMPALTE ",e),this.active_template=e,this.logger.log("[NOTIFICATION-EMAIL] - GET EMAIL TEMPALTE - SELECTED TEMPALTE - ACTIVE TEMPLATE ",this.active_template),this.getProjectById(this.projectId)}seePreview(){document.getElementById("iframe-email-template-preview")&&(document.getElementById("iframe-email-template-preview").srcdoc=this.emailTemplate),document.querySelector(".see_preview_btn").blur()}onChangeEmailTempalte(e){this.logger.log("[NOTIFICATION-EMAIL] - SAVE EMAIL TEMPLATE onChangeEmailTempalte ",this.emailTemplate),document.getElementById("iframe-email-template-preview").srcdoc=this.emailTemplate}saveEmailNotificationTemplate(){document.querySelector(".save_email_template").blur(),this.logger.log("[NOTIFICATION-EMAIL] - SAVE EMAIL TEMPLATE emailTemplate ",this.emailTemplate),this.projectService.updateEmailTempalte(this.active_template,this.emailTemplate).subscribe(n=>{this.logger.log("[NOTIFICATION-EMAIL] - SAVE EMAIL TEMPLATE res ",n)},n=>{this.logger.error("[NOTIFICATION-EMAIL] - SAVE EMAIL TEMPLATE error ",n),this.notify.showWidgetStyleUpdateNotification(this.anErrorHasOccurredMsg,4,"report_problem")},()=>{this.logger.log("[NOTIFICATION-EMAIL] - SAVE EMAIL TEMPLATE * COMPLETE *"),this.notify.showWidgetStyleUpdateNotification(this.emailTemplateUpdatedSuccessfullyMsg,2,"done")})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(r.Ye),t.Y36(T.Y),t.Y36(f.H7),t.Y36(p.sK),t.Y36(h.e),t.Y36(E.m),t.Y36(I.c))},i.\u0275cmp=t.Xpm({type:i,selectors:[["appdashboard-notification-email"]],decls:29,vars:22,consts:[[1,"navbar-brand","navbar-brand-sidebar-settings",3,"ngStyle","ngClass"],["navbarbrand",""],[1,"material-icons"],[4,"ngIf"],[1,"main-content",2,"padding-top","0px","padding-left","10px","padding-right","5px"],[1,"page-title--sidebar-settings",3,"ngClass"],[1,"material-icons",2,"vertical-align","middle !important","cursor","pointer",3,"click"],[1,"container-fluid",2,"padding-left","0px","padding-right","5px"],[1,"content-wpr",2,"display","flex"],[1,"tempalte-content",2,"flex","1 1 auto","width","calc(100% - 230px)","margin-left","12px"],["mat-tab-nav-bar","",3,"tabPanel"],["mat-tab-link","",3,"active","ngClass","click",4,"ngFor","ngForOf"],["tabPanel",""],[1,"row","template-html-code-row",2,"margin-top","16px"],[1,"col-xs-12","col-md-6","template-html-code-col"],["id","input","rows","24",1,"template-html-code",3,"ngModel","ngModelChange"],[1,"btn","btn-tdblu-no-boxshadow","save_email_template",2,"margin-top","5px","font-weight","500",3,"click"],[1,"col-xs-12","col-md-6","template-iframe-col"],["class","stretchspinner_in_app_install",4,"ngIf"],["width","100%","height","522","id","iframe-email-template-preview","srcdoc",t.$cX``],["mat-tab-link","",3,"active","ngClass","click"],[1,"stretchspinner_in_app_install"],[1,"rect1"],[1,"rect2"],[1,"rect3"],[1,"rect4"],[1,"rect5"]],template:function(e,n){if(1&e&&(t.TgZ(0,"span",0,1)(2,"i",2),t._uU(3,"settings"),t.qZA(),t.YNc(4,A,3,3,"span",3),t.qZA(),t.TgZ(5,"div",4)(6,"div",5)(7,"i",6),t.NdJ("click",function(){return n.goBack()}),t._uU(8,"keyboard_arrow_left"),t.qZA(),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"div",8),t._UZ(13,"appdashboard-settings-sidebar"),t.TgZ(14,"div",9)(15,"nav",10),t.YNc(16,M,3,7,"a",11),t.qZA(),t._UZ(17,"mat-tab-nav-panel",null,12),t.TgZ(19,"div",13)(20,"div",14)(21,"textarea",15),t.NdJ("ngModelChange",function(s){return n.emailTemplate=s})("ngModelChange",function(s){return n.onChangeEmailTempalte(s)}),t._uU(22,"            "),t.qZA(),t.TgZ(23,"button",16),t.NdJ("click",function(){return n.saveEmailNotificationTemplate()}),t._uU(24),t.ALo(25,"translate"),t.qZA()(),t.TgZ(26,"div",17),t.YNc(27,v,6,0,"div",18),t._UZ(28,"iframe",19),t.qZA()()()()()()),2&e){const l=t.MAs(18);t.Q6J("ngStyle",t.VKq(14,O,!0===n.isChromeVerGreaterThan100?"-64px":"6px"))("ngClass",t.WLB(16,C,n.IS_OPEN_SETTINGS_SIDEBAR,!n.IS_OPEN_SETTINGS_SIDEBAR)),t.xp6(4),t.Q6J("ngIf",n.IS_OPEN_SETTINGS_SIDEBAR),t.xp6(2),t.Q6J("ngClass",t.WLB(19,N,n.IS_OPEN_SETTINGS_SIDEBAR,!n.IS_OPEN_SETTINGS_SIDEBAR)),t.xp6(3),t.hij(" ",t.lcZ(10,10,"ProjectEditPage.CustomizeEmailTemplateBtn")," "),t.xp6(6),t.Q6J("tabPanel",l),t.xp6(1),t.Q6J("ngForOf",n.EMAIL_TEMPLATE_NAME),t.xp6(5),t.Q6J("ngModel",n.emailTemplate),t.xp6(3),t.hij(" ",t.lcZ(25,12,"Save")," "),t.xp6(3),t.Q6J("ngIf",n.showSpinner)}},dependencies:[r.mk,r.sg,r.O5,r.PC,c.Fj,c.JJ,c.On,m.BU,m.sW,m.Nj,u.S,p.X$],styles:[".nav-email-tmplt-li[_ngcontent-%COMP%] {\n  height: 40px;\n  border-radius: 0 20px 20px 0;\n  margin-right: 0px;\n  font-weight: 400;\n  cursor: pointer;\n  padding-left: 8px;\n  line-height: 1.2;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  font-size: 12px;\n}\n.nav-email-tmplt-li[_ngcontent-%COMP%]:hover {\n  background-color: rgba(0, 0, 0, 0.04);\n}\n.nav-email-tmplt-li-active[_ngcontent-%COMP%]:hover {\n  background-color: #3ea9f5;\n  color: #fff !important;\n}\n.nav-email-tmplt-li-active[_ngcontent-%COMP%] {\n  background-color: #3ea9f5;\n  color: #fff !important;\n}\n.nav-email-tmplt-li-active[_ngcontent-%COMP%]   i[_ngcontent-%COMP%] {\n  color: #fff !important;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%] {\n  margin: 100px auto;\n  width: 50px;\n  height: 40px;\n  text-align: center;\n  font-size: 10px;\n  position: absolute;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  background-color: var(--blue-20);\n  height: 100%;\n  width: 6px;\n  display: inline-block;\n  animation: sk-stretchdelay 1.2s infinite ease-in-out;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%] {\n  animation-delay: -1.1s;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%] {\n  animation-delay: -1s;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%] {\n  animation-delay: -0.9s;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%] {\n  animation-delay: -0.8s;\n}\n@keyframes sk-stretchdelay {\n  0%, 40%, 100% {\n    transform: scaleY(0.4);\n    -webkit-transform: scaleY(0.4);\n  }\n  20% {\n    transform: scaleY(1);\n    -webkit-transform: scaleY(1);\n  }\n}\n.hide-stretchspinner[_ngcontent-%COMP%] {\n  display: none;\n}\n.notification-email-left-sidebar-menu[_ngcontent-%COMP%] {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex: 1 0 auto;\n  width: 200px;\n  min-width: 200px;\n  max-width: 200px;\n  margin-left: -10px;\n  margin-right: 6px;\n}\n.tab-active-color[_ngcontent-%COMP%] {\n  color: var(--blue-20) !important;\n  opacity: 1 !important;\n  font-weight: 400;\n}\n  .mat-tab-nav-bar.mat-primary .mat-ink-bar {\n  background-color: var(--blue-20) !important;\n}\n  .mat-tab-links > a {\n  font-weight: 400;\n}\n  .mat-tab-links a:hover,   .mat-tab-links a:focus {\n  color: var(--blue-20) !important;\n  text-decoration: none;\n  opacity: 1 !important;\n}\n.template-html-code-row[_ngcontent-%COMP%]   .template-html-code-col[_ngcontent-%COMP%]   .template-html-code[_ngcontent-%COMP%] {\n  width: 100%;\n  border-radius: 12px;\n  border: solid 1px #ddd;\n  padding: 8px;\n  font-weight: 400;\n  resize: none;\n}\n.template-iframe-col[_ngcontent-%COMP%]    > iframe[_ngcontent-%COMP%] {\n  border: 1px solid #ddd;\n  border-radius: 12px;\n}"]}),i})();var P=a(54132),L=a(31449),S=a(69284);const x=[{path:"",component:b}];let y=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[P.Bz.forChild(x),r.ez,p.aw,L.m,c.u5,m.Nh,S.i]}),i})()}}]);