"use strict";(self.webpackChunkchat21=self.webpackChunkchat21||[]).push([[4469],{44469:(R,g,r)=>{r.r(g),r.d(g,{AppStoreInstallModule:()=>L});var p=r(69808),u=r(51062),d=r(31449),m=r(87341),f=r(25466),A=r(48616),t=r(5e3),h=r(54132),I=r(22313),T=r(39850);function S(n,o){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.AsE(" ",e.reason," ",e.app_title," ")}}function E(n,o){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.AsE(" ",e.app_title," ",e.reason," ")}}function H(n,o){1&n&&t._UZ(0,"loading-spinner",7)}const P=function(n){return{height:n}};function v(n,o){if(1&n&&t._UZ(0,"iframe",8),2&n){const e=t.oxw();t.Q6J("src",e.URL,t.uOi)("ngStyle",t.VKq(2,P,e.iframeHeight))}}const _=function(n){return{"margin-top":n}},C=[{path:"",component:(()=>{class n{constructor(e,i,s,a,c,l,y,O){this.route=e,this.sanitizer=i,this.location=s,this.appStoreService=a,this.auth=c,this.ngZone=l,this.router=y,this.logger=O,this.navbarAndFooterHeight=67,this.getRouteParams()}ngOnInit(){this.getCurrentProject(),this.onInitframeHeight(),this.getBrowserVersion()}getBrowserVersion(){this.auth.isChromeVerGreaterThan100.subscribe(e=>{this.isChromeVerGreaterThan100=e})}ngOnDestroy(){}getCurrentProject(){this.subscription=this.auth.project_bs.subscribe(e=>{e&&(this.project=e)})}getRouteParams(){this.showSpinner=!0,this.route.params.subscribe(e=>{this.projectId=e.projectid,this.logger.log("[APP-STORE-INSTALL] - GET ROUTE PARAMS ",e),e.calledby&&"h"===e.calledby&&(this.calledBy="home"),this.appStoreService.getAppDetail(e.appid).subscribe(i=>{if(this.logger.log("[APP-STORE-INSTALL] - GET APP DETAIL RESULT: ",i),i){if(this.result=i,this.app_title=this.result.title,"v1"===this.result.version)this.appurl=this.result.installActionURL,this.reason="Manage";else if("v2"===this.result.version&&"run"===e.reason)this.appurl=this.result.runURL,this.reason="Run";else if("v2"===this.result.version&&"configure"===e.reason)this.appurl=this.result.installActionURL,this.reason="Configure";else if(("v2"===this.result.version||"v1"===this.result.version)&&"detail"===e.reason&&this.result.learnMore){const s=JSON.parse(this.result.learnMore);this.appurl=s.url,this.reason="Detail"}this.auth.user_bs.subscribe(s=>{if(s&&void 0!==this.appurl){this.TOKEN=s.token;let a="";a=!1===this.hasQueryParams(this.appurl)?"?":"&",this.URL=this.sanitizer.bypassSecurityTrustResourceUrl(this.appurl+a+"project_id="+e.projectid+"&app_id="+e.appid+"&token="+this.TOKEN),this.URL&&setTimeout(()=>{this.getIframeHasLoaded(this.result)},0)}else this.logger.log("[APP-STORE-INSTALL] - GET USER TOKEN: FAILED"),this.showSpinner=!1})}else this.logger.error("Error getting app details")})})}hasQueryParams(e){return e.includes("?")}getIframeHasLoaded(e){var i=this,s=document.getElementById("i_frame");this.logger.log("[APP-STORE-INSTALL] GET iframe ",s),s&&s.addEventListener("load",function(){var l;i.logger.log("[APP-STORE-INSTALL] GET - Finish"),document.querySelector(".stretchspinner_in_app_install").classList.add("hide-stretchspinner"),"v2"===e.version&&!0===e.where.appsstore&&null!==(l=s)&&"IFRAME"===l.tagName&&s.contentWindow&&s.contentWindow.postMessage({appname:e.title,request:i.project,token:i.TOKEN},"*")})}onResize(e){return this.newInnerHeight=e.target.innerHeight,this.logger.log("[APP-STORE-INSTALL] NEW INNER HEIGHT ",this.newInnerHeight),this.iframeHeight=this.newInnerHeight-this.navbarAndFooterHeight,this.logger.log("[APP-STORE-INSTALL] ON RESIZE -> IFRAME HEIGHT (ACTUAL HEIGHT - NAVBAR HEIGHT) ",this.iframeHeight),{height:this.iframeHeight+="px"}}onInitframeHeight(){return this.actualHeight=window.innerHeight,this.logger.log("[APP-STORE-INSTALL] ACTUAL HEIGHT ",this.actualHeight),this.iframeHeight=this.actualHeight-this.navbarAndFooterHeight,this.logger.log("[APP-STORE-INSTALL] ON INIT -> IFRAME HEIGHT (ACTUAL HEIGHT - NAVBAR HEIGHT) ",this.iframeHeight),{height:this.iframeHeight+="px"}}goBack(){this.router.navigate("home"===this.calledBy?["project/"+this.projectId+"/home"]:["project/"+this.projectId+"/app-store"])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.gz),t.Y36(I.H7),t.Y36(p.Ye),t.Y36(f.I),t.Y36(m.e),t.Y36(t.R0b),t.Y36(h.F0),t.Y36(A.m))},n.\u0275cmp=t.Xpm({type:n,selectors:[["appdashboard-app-store-install"]],hostBindings:function(e,i){1&e&&t.NdJ("resize",function(a){return i.onResize(a)},!1,t.Jf7)},decls:9,vars:7,consts:[[1,"navbar-brand",2,"z-index","1050","position","relative","padding-left","30px",3,"ngStyle"],[1,"material-icons",2,"vertical-align","middle !important","cursor","pointer",3,"click"],[4,"ngIf"],[1,"main-content","app-install-main-content"],[1,"container-fluid",2,"padding-right","0px","padding-left","0px"],["class","stretchspinner_in_app_install",4,"ngIf"],["allow","camera; microphone","id","i_frame","style","width:100%;","frameBorder","0","allowfullscreen","",3,"src","ngStyle",4,"ngIf"],[1,"stretchspinner_in_app_install"],["allow","camera; microphone","id","i_frame","frameBorder","0","allowfullscreen","",2,"width","100%",3,"src","ngStyle"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"i",1),t.NdJ("click",function(){return i.goBack()}),t._uU(2,"keyboard_arrow_left"),t.qZA(),t.YNc(3,S,2,2,"span",2),t.YNc(4,E,2,2,"span",2),t.qZA(),t.TgZ(5,"div",3)(6,"div",4),t.YNc(7,H,1,0,"loading-spinner",5),t.YNc(8,v,1,4,"iframe",6),t.qZA()()),2&e&&(t.Q6J("ngStyle",t.VKq(5,_,!0===i.isChromeVerGreaterThan100?"-57px":"6px")),t.xp6(3),t.Q6J("ngIf","Detail"!==i.reason),t.xp6(1),t.Q6J("ngIf","Detail"===i.reason),t.xp6(3),t.Q6J("ngIf",i.showSpinner),t.xp6(1),t.Q6J("ngIf",i.URL))},dependencies:[p.O5,p.PC,T.g],styles:[".app-install-main-content[_ngcontent-%COMP%] {\n  padding-top: 0px;\n  margin-top: 61px;\n  padding-bottom: 0px;\n  padding-left: 0px;\n  padding-right: 0px;\n  margin-bottom: -6px;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%] {\n  margin: 100px auto;\n  width: 50px;\n  height: 40px;\n  text-align: center;\n  font-size: 10px;\n  position: absolute;\n  margin: auto;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n  background-color: #3ea9f5;\n  height: 100%;\n  width: 6px;\n  display: inline-block;\n  animation: sk-stretchdelay 1.2s infinite ease-in-out;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect2[_ngcontent-%COMP%] {\n  animation-delay: -1.1s;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect3[_ngcontent-%COMP%] {\n  animation-delay: -1s;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect4[_ngcontent-%COMP%] {\n  animation-delay: -0.9s;\n}\n.stretchspinner_in_app_install[_ngcontent-%COMP%]   .rect5[_ngcontent-%COMP%] {\n  animation-delay: -0.8s;\n}\n@keyframes sk-stretchdelay {\n  0%, 40%, 100% {\n    transform: scaleY(0.4);\n    -webkit-transform: scaleY(0.4);\n  }\n  20% {\n    transform: scaleY(1);\n    -webkit-transform: scaleY(1);\n  }\n}\n.hide-stretchspinner[_ngcontent-%COMP%] {\n  display: none;\n}"]}),n})()}];let L=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[h.Bz.forChild(C),p.ez,u.aw,d.m,h.Bz]}),n})()}}]);