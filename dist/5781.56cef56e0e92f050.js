"use strict";(self.webpackChunkchat21=self.webpackChunkchat21||[]).push([[5781],{18934:(P,T,s)=>{s.d(T,{E:()=>j});var h=s(82349),_=s(48616),O=s(15439),r=s.n(O),D=s(68332),E=s(94961),c=s(8929),l=s(7625),a=s(87341),g=s(65260),t=s(5e3),S=s(51062),v=s(54132),Z=s(47423),R=s(69808),x=s(93075),L=s(24376);function B(o,u){1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Analytics.Days")," "))}function Y(o,u){1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Analytics.Months"),""))}function U(o,u){1&o&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Analytics.Year")," "))}function k(o,u){if(1&o){const e=t.EpF();t.TgZ(0,"div",19),t.NdJ("click",function(){t.CHM(e);const d=t.oxw();return t.KtG(d.goToRequestsAnalytics())}),t.TgZ(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",20),t._uU(5," keyboard_arrow_right "),t.qZA()()}2&o&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"MoreFilterInAnalytics")," "))}function N(o,u){1&o&&(t.TgZ(0,"div",21),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"Processing")," "))}let j=(()=>{class o{constructor(e,i,d,p,A,f,C,y){this.data=e,this.dialogRef=i,this.logger=d,this.analyticsService=p,this.translate=A,this.usersService=f,this.auth=C,this.router=y,this.lastdays=7,this.showSpinner=!0,this.unsubscribe$=new c.xQ,this.logger.log("[MSGS-STATS-MODAL] data ",e),e&&e.agent&&(this.logger.log("[MSGS-STATS-MODAL] data  > hasOwnProperty email",e.agent.hasOwnProperty("email")),e.agent.hasOwnProperty("email")?(this.logger.log("[MSGS-STATS-MODAL] data  >  data.agent.lastname.length",e.agent.lastname.lenght),e.agent.firstname&&""!==e.agent.lastname?this.agentName=e.agent.firstname+" "+e.agent.lastname:e.agent.firstname&&""===e.agent.lastname&&(this.agentName=e.agent.firstname)):this.agentName=e.agent.name,this.logger.log("[MSGS-STATS-MODAL] data  > agentName",this.agentName),this.agentId=e.agent._id,this.logger.log("[MSGS-STATS-MODAL] data  > agentId",this.agentId))}ngOnInit(){this.lang=this.translate.getBrowserLang(),this.selected="day",this.selectedDaysId=7,this.switchMonthName(),this.initDay=r()().subtract(6,"d").format("D/M/YYYY"),this.endDay=r()().subtract(0,"d").format("D/M/YYYY"),this.logger.log("[consoCHATBOT-STATS-MODALl] INIT",this.initDay,"END",this.endDay),this.getMessagesByLastNDays(this.selectedDaysId,this.agentId),this.getUserRole(),this.getCurrentProject()}ngOnDestroy(){this.unsubscribe$.next(null),this.unsubscribe$.complete()}getUserRole(){this.usersService.project_user_role_bs.pipe((0,l.R)(this.unsubscribe$)).subscribe(e=>{this.USER_ROLE=e})}getCurrentProject(){this.subscription=this.auth.project_bs.subscribe(e=>{e&&(this.projectId=e._id,this.logger.log("[ActivitiesComponent] - projectId ",this.projectId))})}switchMonthName(){this.monthNames={1:r().monthsShort(0),2:r().monthsShort(1),3:r().monthsShort(2),4:r().monthsShort(3),5:r().monthsShort(4),6:r().monthsShort(5),7:r().monthsShort(6),8:r().monthsShort(7),9:r().monthsShort(8),10:r().monthsShort(9),11:r().monthsShort(10),12:r().monthsShort(11)}}onOkPresssed(){this.dialogRef.close(this.agentId),this.subscription.unsubscribe()}goToRequestsAnalytics(){this.router.navigate(["project/"+this.projectId+"/analytics/metrics"]),this.dialogRef.close(null)}daysSelect(e,i){this.logger.log("[CHATBOT-STATS-MODAL] daysSelect EVENT: ",i),this.selectedDaysId=e,e<=30?this.lastdays=e:90==e||180==e?this.lastdays=e/30:360==e&&(this.lastdays=1),this.lineChart.destroy(),this.getMessagesByLastNDays(e,this.agentId)}getMessagesByLastNDays(e,i){this.logger.log("[CHATBOT-STATS-MODALl] Lastdays: ",e),this.subscription=this.analyticsService.getMessagesByDay(e,i).subscribe(d=>{this.logger.log("[CHATBOT-STATS-MODALl] \xbb\xbb MESSAGES BY DAY RESULT: ",d);const p=[];for(let n=0;n<e;n++)p.push({count:0,day:r()().subtract(n,"d").format("D/M/YYYY")});p.reverse();const A=[],f=[],C=[];for(let n=0;n<d.length;n++)d[n]&&C.push({count:d[n].count,day:d[n]._id.day+"/"+d[n]._id.month+"/"+d[n]._id.year});const y=p.map(n=>C.find(m=>m.day===n.day)||n);this.logger.log("[CHATBOT-STATS-MODALl] - MESSGES BY DAY - FINAL ARRAY ",y),this.initDay=y[0].day,this.endDay=y[e-1].day,this.logger.log("[CHATBOT-STATS-MODALl] INIT",this.initDay,"END",this.endDay),y.forEach(n=>{A.push(n.count);const m=n.day.split("/");f.push(m[0]+" "+this.monthNames[m[1]])}),this.logger.log("[CHATBOT-STATS-MODALl] \xbb\xbb MESSAGES BY DAY - SERIES (+ NEW + ARRAY OF COUNT)",A),this.logger.log("[CHATBOT-STATS-MODALl] \xbb\xbb MESSAGES BY DAY - LABELS (+ NEW + ARRAY OF DAY)",f);const K=this.getMaxOfArray(A);this.lineChart=new D.Chart("lastdaysMessages",{type:"line",data:{labels:f,datasets:[{label:"Number of messages",data:A,fill:!0,lineTension:0,backgroundColor:"rgba(30, 136, 229, 0.6)",borderColor:"rgba(30, 136, 229, 1)",borderWidth:3,borderDash:[],borderDashOffset:0,pointBackgroundColor:"rgba(255, 255, 255, 0.8)",pointBorderColor:"#1e88e5"}]},options:{maintainAspectRatio:!1,title:{text:"TITLE",display:!1},legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0,display:!0,maxTicksLimit:this.selectedDaysId>60?10:this.selectedDaysId,fontColor:"black"},gridLines:{display:!0,borderDash:[8,4]}}],yAxes:[{gridLines:{display:!0,borderDash:[8,4]},ticks:{beginAtZero:!0,userCallback:function(n,m,M){if(Math.floor(n)===n)return n},display:!0,fontColor:"black",suggestedMax:K+2}}]},tooltips:{callbacks:{label:(n,m)=>{const M=n.yLabel;return this.translate.instant("RequestMsgsPage.Messages")+": "+M}}}},plugins:[{beforeDraw:function(n,m){var M=n.chart.ctx;M.height=128,M.font="Roboto"}}]})},d=>{this.logger.error("[CHATBOT-STATS-MODALl] \xbb\xbb MESSAGES BY DAY - ERROR ",d),this.showSpinner=!1},()=>{this.logger.log("[CHATBOT-STATS-MODALl] \xbb\xbb MESSAGES BY DAY - * COMPLETE * "),this.showSpinner=!1})}getMaxOfArray(e){return Math.max.apply(null,e)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(h.WI),t.Y36(h.so),t.Y36(_.m),t.Y36(g.y),t.Y36(S.sK),t.Y36(E.f),t.Y36(a.e),t.Y36(v.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["appdashboard-messages-stats-modal"]],decls:52,vars:61,consts:[["mat-dialog-title","",2,"text-align","center","margin-bottom","10px"],["mat-dialog-content",""],[1,"dialog--content"],[1,"dialog--content-first-row"],[1,"graph-filter-wpr"],[1,"graph-filter"],[1,"filter-label",2,"margin-bottom","0px"],[1,"ng-select-wpr",2,"text-align","left"],["name","days",1,"custom",3,"ngModel","clearable","searchable","ngModelChange","change"],[3,"value"],[1,"chart-header"],[1,"chart-header-subtitle"],[4,"ngIf"],["class","text--link",3,"click",4,"ngIf"],[1,"chart-container"],["class","processing",4,"ngIf"],["id","lastdaysMessages"],["mat-dialog-actions","",2,"justify-content","center","margin-bottom","0px"],["mat-button","",1,"mat-dialog-ok-btn",3,"click"],[1,"text--link",3,"click"],[1,"material-icons","m-i-arrow-on-black"],[1,"processing"]],template:function(e,i){1&e&&(t.TgZ(0,"h1",0),t._uU(1),t.qZA(),t._UZ(2,"div"),t.TgZ(3,"div",1)(4,"div",2)(5,"div",3)(6,"div",4)(7,"div",5)(8,"label",6),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"div",7)(12,"ng-select",8),t.NdJ("ngModelChange",function(p){return i.selectedDaysId=p})("change",function(p){return i.daysSelect(i.selectedDaysId,p)}),t.TgZ(13,"ng-option",9),t._uU(14),t.ALo(15,"translate"),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"ng-option",9),t._uU(18),t.ALo(19,"translate"),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"ng-option",9),t._uU(22),t.ALo(23,"translate"),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"ng-option",9),t._uU(26),t.ALo(27,"translate"),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"ng-option",9),t._uU(30),t.ALo(31,"translate"),t.ALo(32,"translate"),t.qZA(),t.TgZ(33,"ng-option",9),t._uU(34),t.ALo(35,"translate"),t.ALo(36,"translate"),t.qZA()()()(),t.TgZ(37,"div",10)(38,"div",11),t._uU(39),t.ALo(40,"translate"),t.YNc(41,B,3,3,"span",12),t.YNc(42,Y,3,3,"span",12),t.YNc(43,U,3,3,"span",12),t.qZA()()(),t.YNc(44,k,6,3,"div",13),t.TgZ(45,"div",14),t.YNc(46,N,3,3,"div",15),t._UZ(47,"canvas",16),t.qZA()()(),t.TgZ(48,"div",17)(49,"button",18),t.NdJ("click",function(){return i.onOkPresssed()}),t._uU(50),t.ALo(51,"translate"),t.qZA()()()),2&e&&(t.xp6(1),t.hij(" ",i.agentName,"\n"),t.xp6(8),t.hij(" ",t.lcZ(10,31,"Analytics.FilterReport")," "),t.xp6(3),t.Q6J("ngModel",i.selectedDaysId)("clearable",!1)("searchable",!1),t.xp6(1),t.Q6J("value",7),t.xp6(1),t.AsE("",t.lcZ(15,33,"Analytics.Last")," 7 ",t.lcZ(16,35,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",15),t.xp6(1),t.AsE("",t.lcZ(19,37,"Analytics.Last")," 15 ",t.lcZ(20,39,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",30),t.xp6(1),t.AsE("",t.lcZ(23,41,"Analytics.Last")," 30 ",t.lcZ(24,43,"Analytics.Days")," "),t.xp6(3),t.Q6J("value",90),t.xp6(1),t.AsE("",t.lcZ(27,45,"Analytics.Last")," 3 ",t.lcZ(28,47,"Analytics.Months")," "),t.xp6(3),t.Q6J("value",180),t.xp6(1),t.AsE("",t.lcZ(31,49,"Analytics.Last")," 6 ",t.lcZ(32,51,"Analytics.Months")," "),t.xp6(3),t.Q6J("value",360),t.xp6(1),t.AsE("",t.lcZ(35,53,"Analytics.Last")," 1 ",t.lcZ(36,55,"Analytics.Year")," "),t.xp6(5),t.AsE(" ",t.lcZ(40,57,"Analytics.Messages.MessagesChartTitle")," ",i.lastdays," "),t.xp6(2),t.Q6J("ngIf",i.selectedDaysId<=30),t.xp6(1),t.Q6J("ngIf",90===i.selectedDaysId||180===i.selectedDaysId),t.xp6(1),t.Q6J("ngIf",360===i.selectedDaysId),t.xp6(1),t.Q6J("ngIf","agent"!==i.USER_ROLE),t.xp6(2),t.Q6J("ngIf",i.showSpinner),t.xp6(4),t.hij(" ",t.lcZ(51,59,"Ok")," "))},dependencies:[Z.lW,h.uh,h.xY,h.H8,R.O5,x.JJ,x.On,L.w9,L.jq,S.X$],styles:['.chart-header[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n\n.chart-header-subtitle[_ngcontent-%COMP%] {\n  font-size: 18px;\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n}\n\n.range-selected[_ngcontent-%COMP%] {\n  margin: 8px !important;\n  color: rgba(0, 0, 0, 0.5);\n  font-family: "Poppins", "Roboto", "Arial", sans-serif;\n  font-size: 16px;\n  display: block;\n}\n\n.graph-filter[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  gap: 12px;\n}\n\n.filter-label[_ngcontent-%COMP%] {\n  text-align: left;\n  color: black;\n}\n\n.chart-container[_ngcontent-%COMP%] {\n  font-family: var(--header-font-family);\n}\n\n.chart-container[_ngcontent-%COMP%] {\n  position: relative;\n  margin: 12px 12px;\n  height: 35vh;\n}\n\n.processing[_ngcontent-%COMP%] {\n  color: var(--secondary-text-color);\n  height: 35vh;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.graph-filter-wpr[_ngcontent-%COMP%] {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 33px;\n}\n\n.text--link[_ngcontent-%COMP%] {\n  color: var(--blue-light);\n  font-weight: 400;\n  cursor: pointer;\n  margin-left: 33px;\n  margin-top: 6px;\n  width: -moz-fit-content;\n  width: fit-content;\n}\n\n.text--link[_ngcontent-%COMP%]   .m-i-arrow-on-black[_ngcontent-%COMP%] {\n  vertical-align: middle;\n  color: var(--blue-light);\n  margin-left: -6px;\n  transition: 0.1s ease-in;\n}\n\n.text--link[_ngcontent-%COMP%]:hover {\n  color: var(--vivid-blue);\n}\n\n.text--link[_ngcontent-%COMP%]:hover   .m-i-arrow-on-black[_ngcontent-%COMP%] {\n  transform: translateX(10%);\n  color: var(--vivid-blue);\n}']}),o})()},69287:(P,T,s)=>{s.d(T,{Iq:()=>E,TU:()=>r});var h=s(69808),_=s(5e3);class O{constructor(l,a){this._document=a;const g=this._textarea=this._document.createElement("textarea"),t=g.style;t.position="fixed",t.top=t.opacity="0",t.left="-999em",g.setAttribute("aria-hidden","true"),g.value=l,g.readOnly=!0,this._document.body.appendChild(g)}copy(){const l=this._textarea;let a=!1;try{if(l){const g=this._document.activeElement;l.select(),l.setSelectionRange(0,l.value.length),a=this._document.execCommand("copy"),g&&g.focus()}}catch(g){}return a}destroy(){const l=this._textarea;l&&(l.remove(),this._textarea=void 0)}}let r=(()=>{class c{constructor(a){this._document=a}copy(a){const g=this.beginCopy(a),t=g.copy();return g.destroy(),t}beginCopy(a){return new O(a,this._document)}}return c.\u0275fac=function(a){return new(a||c)(_.LFG(h.K0))},c.\u0275prov=_.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})(),E=(()=>{class c{}return c.\u0275fac=function(a){return new(a||c)},c.\u0275mod=_.oAB({type:c}),c.\u0275inj=_.cJS({}),c})()}}]);